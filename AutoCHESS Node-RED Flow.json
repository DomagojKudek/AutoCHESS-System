[{"id":"ee39c607.e74858","type":"tab","label":"AutoCHESS MAIN FLOW","disabled":true,"info":""},{"id":"665b6023.30434","type":"tab","label":"AutoCHESS robot communication","disabled":true,"info":""},{"id":"9ee8ce904a653061","type":"tab","label":"Robot Flow","disabled":true,"info":""},{"id":"b1ba7781.8ce0b8","type":"tab","label":"Flow 1","disabled":true,"info":""},{"id":"20360fb.e015af","type":"tab","label":"Flow 2","disabled":true,"info":""},{"id":"d4cb3f70d0c4b27a","type":"subflow","name":"robot indicator driver","info":"","category":"robot subflows","in":[{"x":60,"y":2200,"wires":[{"id":"a23e56ac8c83d0d0"},{"id":"035fa1e11e39e5d4"}]}],"out":[{"x":960,"y":1920,"wires":[{"id":"959184afd97f5ce2","port":0}]}],"env":[{"name":"configId","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}},{"name":"Danger colour (red)","type":"str","value":"#FF0000","ui":{"type":"input","opts":{"types":["str","env"]}}},{"name":"Warning colour (yellow)","type":"str","value":"#FFFF00"},{"name":"Safe colour (green)","type":"str","value":"#00FF00","ui":{"type":"input","opts":{"types":["str","env"]}}},{"name":"Nominal colour (white)","type":"str","value":"#FFFFFF"},{"name":"extra colour (blue)","type":"str","value":"#0000FF"}],"meta":{},"color":"#37c084","icon":"font-awesome/fa-lightbulb-o","status":{"x":960,"y":2000,"wires":[{"id":"6b6232ccf5f6b46e","port":0},{"id":"7f167b516823edcb","port":0}]}},{"id":"ce24bd14b3c41949","type":"subflow","name":"organizer","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"4faff9b7529ca09c"},{"id":"a7be49530f786260"},{"id":"8dfabd9f2999c568"},{"id":"72eec61868e5a990"}]}],"out":[{"x":400,"y":40,"wires":[{"id":"ce24bd14b3c41949","port":0}]}],"env":[],"meta":{},"color":"#FFFFFF","icon":"font-awesome/fa-circle","status":{"x":400,"y":160,"wires":[{"id":"4faff9b7529ca09c","port":0},{"id":"bf7cd1cd167864c7","port":0},{"id":"a7be49530f786260","port":0},{"id":"dc0be98d35cc1fbb","port":0},{"id":"72eec61868e5a990","port":0}]}},{"id":"990942449cfdbb29","type":"subflow","name":"robot event","info":"","category":"Work In Progress","in":[{"x":140,"y":540,"wires":[]}],"out":[{"x":500,"y":600,"wires":[]}],"env":[{"name":"configid","type":"str","value":""},{"name":"eventid","type":"num","value":"999","ui":{"type":"input","opts":{"types":["num","env"]}}}],"meta":{},"color":"#50c878","icon":"font-awesome/fa-envelope-o","status":{"x":500,"y":660,"wires":[]}},{"id":"64cf9052855ab599","type":"subflow","name":"robot motion supervision","info":"","category":"robot subflows","in":[{"x":50,"y":30,"wires":[]}],"out":[{"x":160,"y":30,"wires":[]}],"env":[{"name":"configId","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}}],"meta":{},"color":"#48c04d","icon":"font-awesome/fa-percent"},{"id":"6df522bdaa65197a","type":"subflow","name":"robot RNL installer","info":"","category":"robot subflows","in":[],"out":[],"env":[{"name":"configid","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}}],"meta":{},"color":"#48c04d","icon":"font-awesome/fa-magic"},{"id":"2f0cb7c7.dd9f18","type":"subflow","name":"abb rmq parser","info":"","category":"robot","in":[{"x":40,"y":300,"wires":[{"id":"46abdc85c6e20c98"}]}],"out":[{"x":1160,"y":400,"wires":[{"id":"dcc7079dfe859b60","port":0},{"id":"f223cf737ba0210c","port":0}]}],"env":[{"name":"override_metadata_mode","type":"bool","value":"true","ui":{"label":{"en-US":"Override metadata"},"type":"checkbox"}},{"name":"metadata_instruiction","type":"str","value":"0","ui":{"label":{"en-US":"metadata Instruction"},"type":"select","opts":{"opts":[{"l":{"en-US":"EVENT"},"v":"0"},{"l":{"en-US":"EXECUTE"},"v":"1"},{"l":{"en-US":"ALLOCATE"},"v":"2"},{"l":{"en-US":"RESPONSE"},"v":"3"}]}}},{"name":"use_static_id","type":"bool","value":"true","ui":{"label":{"en-US":"Use static metadata Identifier / Event ID"},"type":"checkbox"}},{"name":"static_id","type":"num","value":"0","ui":{"label":{"en-US":"static metadata Identifier / Event ID"},"type":"input","opts":{"types":["num","env"]}}}],"meta":{},"color":"#4cc796","icon":"node-red/parser-csv.svg"},{"id":"1c8b3f7678bc98b1","type":"subflow","name":"robot state","info":"","category":"robot subflows","in":[{"x":60,"y":80,"wires":[{"id":"d9f7bb2ee2d93843"}]}],"out":[{"x":860,"y":380,"wires":[{"id":"79c2080c8eb9086f","port":0},{"id":"24ddda4abcd03fa6","port":0},{"id":"e7308e2d3994bdc9","port":0}]}],"env":[{"name":"subscription","type":"bool","value":"false","ui":{"type":"checkbox"}},{"name":"configId","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}}],"meta":{},"color":"#77d578","icon":"font-awesome/fa-shield","status":{"x":860,"y":300,"wires":[{"id":"24ddda4abcd03fa6","port":0},{"id":"79c2080c8eb9086f","port":0},{"id":"e7308e2d3994bdc9","port":0}]}},{"id":"48c858d0b6016e60","type":"subflow","name":"robot warmstart","info":"","category":"robot subflows","in":[{"x":60,"y":60,"wires":[{"id":"27b18c84d6e5d31b"}]}],"out":[{"x":720,"y":60,"wires":[{"id":"472610e3ddceee1f","port":0},{"id":"f8c50eb5746df5df","port":0}]}],"env":[{"name":"configId","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}}],"meta":{},"color":"#77d578","icon":"font-awesome/fa-repeat","status":{"x":720,"y":120,"wires":[{"id":"f8c50eb5746df5df","port":0}]}},{"id":"983802a68453d50b","type":"subflow","name":"robot backup","info":"","category":"robot subflows","in":[{"x":60,"y":80,"wires":[{"id":"492109ce6710d666"}]}],"out":[{"x":860,"y":380,"wires":[{"id":"d4d443cd40661af8","port":0},{"id":"85df18514b0ef9b0","port":0}]}],"env":[{"name":"configId","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}},{"name":"backup_name","type":"str","value":"backup","ui":{"type":"input","opts":{"types":["str","env"]}}}],"meta":{},"color":"#77d578","icon":"font-awesome/fa-save","status":{"x":860,"y":300,"wires":[{"id":"d4d443cd40661af8","port":0},{"id":"85df18514b0ef9b0","port":0}]}},{"id":"7fe2370ff54129e9","type":"subflow","name":"robot op-mode","info":"","category":"robot subflows","in":[{"x":60,"y":80,"wires":[{"id":"8fa40c4515a0dfdd"}]}],"out":[{"x":860,"y":380,"wires":[{"id":"0cebc7758b8292c5","port":0},{"id":"d295312c4486de77","port":0},{"id":"a424bd858110d648","port":0}]}],"env":[{"name":"subscription","type":"bool","value":"false","ui":{"type":"checkbox"}},{"name":"configId","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}}],"meta":{},"color":"#77d578","icon":"font-awesome/fa-hand-lizard-o","status":{"x":860,"y":300,"wires":[{"id":"0cebc7758b8292c5","port":0},{"id":"d295312c4486de77","port":0},{"id":"a424bd858110d648","port":0}]}},{"id":"cd5b51ab.751ca","type":"subflow","name":"robot speed","info":"Send a number to set the speed of the robot (0-100).\nSend anything else to get the current speed.","category":"robot subflows","in":[{"x":60,"y":80,"wires":[{"id":"e7f965a6.4e7728"}]}],"out":[{"x":860,"y":380,"wires":[{"id":"bf34d969.193668","port":0},{"id":"94994803884054bd","port":0}]}],"env":[{"name":"subscription","type":"bool","value":"false","ui":{"type":"checkbox"}},{"name":"configId","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}}],"meta":{},"color":"#77d578","icon":"font-awesome/fa-tachometer","status":{"x":860,"y":300,"wires":[{"id":"55403892.eeb378","port":0},{"id":"94994803884054bd","port":0},{"id":"85389bbc67b245e0","port":0}]}},{"id":"8771dc9f224e185f","type":"subflow","name":"robot version switch","info":"Routes a message based on robot RobWare version.\n\nIntended to be used to implement different implementations for RW6 (webservices v1) and RW7 (webservices v2).\n\nUses msg.payload_","category":"robot subflows","in":[{"x":100,"y":100,"wires":[{"id":"169d6c95eebaa638"}]}],"out":[{"x":420,"y":480,"wires":[{"id":"77c744d110220ae5","port":0}]},{"x":420,"y":520,"wires":[{"id":"c78be928e4f90622","port":0}]}],"env":[{"name":"configid","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}}],"meta":{},"color":"#37c084","outputLabels":["Webservice V2 (RW7) ","Webservice V1 (RW6 or less)"],"icon":"node-red/switch.svg","status":{"x":420,"y":560,"wires":[{"id":"ef206b14256acc9d","port":0}]}},{"id":"d37ce6f5.a566d8","type":"subflow","name":"robot start/stop","info":"Send 1 or true to start the robot execution.\nSend 0 or false to stop the robot execution.\nSend anything else to check the execution state:\n- 1 is running.\n- 0 is stopped.","category":"robot subflows","in":[{"x":60,"y":80,"wires":[{"id":"8cc8582d0338bc30"}]}],"out":[{"x":860,"y":500,"wires":[{"id":"e75577c2.46ef08","port":0},{"id":"f171c06e.73e2d","port":0},{"id":"4c1c2680a0223274","port":0}]},{"x":580,"y":1420,"wires":[{"id":"4727dca0ea9aafe6","port":0}]}],"env":[{"name":"subscription","type":"bool","value":"false","ui":{"type":"checkbox"}},{"name":"configId","type":"str","value":"","ui":{"type":"input","opts":{"types":["str","env"]}}},{"name":"motors_on_on_start","type":"bool","value":"true","ui":{"label":{"en-US":"Motors On on start"},"type":"checkbox"}},{"name":"pp_to_main_on_start","type":"bool","value":"false","ui":{"label":{"en-US":"PP to Main on Start"},"type":"checkbox"}},{"name":"stop_at_end_of_cycle","type":"bool","value":"false","ui":{"label":{"en-US":"Stop at end of cycle"},"type":"checkbox"}}],"meta":{},"color":"#77d578","outputLabels":["start/stop","pp to main"],"icon":"font-awesome/fa-caret-square-o-right","status":{"x":860,"y":420,"wires":[{"id":"bacad977.00e8a8","port":0},{"id":"4c1c2680a0223274","port":0},{"id":"8cc555a60ed2f9bf","port":0},{"id":"6c789922693132ac","port":0}]}},{"id":"f45cb214.37ef8","type":"subflow","name":"organizer (2)","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"95f1b0f0.23295"},{"id":"ee0ce0c5.3466a"},{"id":"66588225.f3b504"},{"id":"afb14558.6beba8"}]}],"out":[{"x":400,"y":40,"wires":[{"id":"f45cb214.37ef8","port":0}]}],"env":[],"meta":{},"color":"#FFFFFF","icon":"font-awesome/fa-circle","status":{"x":400,"y":160,"wires":[{"id":"95f1b0f0.23295","port":0},{"id":"fbd1ab9c.da1068","port":0},{"id":"ee0ce0c5.3466a","port":0},{"id":"42010304.08c304","port":0},{"id":"afb14558.6beba8","port":0}]}},{"id":"f1058aa9.7a7698","type":"subflow","name":"Hue Dimmer Parser","info":"","category":"","in":[{"x":300,"y":540,"wires":[{"id":"e24b7ed8.65cc4"},{"id":"cee7d10c.698fb"},{"id":"c763dfd7.d768e"},{"id":"3ed5e66f.65029a"},{"id":"3938f64.f81e50a"},{"id":"6f66a3c1.2da10c"},{"id":"8cbbe8ea.8e9f18"},{"id":"e0cda518.90b208"},{"id":"97ec953f.b5f548"},{"id":"29d86817.199478"},{"id":"e887c4ce.708428"},{"id":"ce6bde8f.15b02"},{"id":"a49fdfc0.80ebd"},{"id":"24df8277.721fee"},{"id":"bb0b2deb.96dbf"},{"id":"aab0b056.36aae"}]}],"out":[{"x":1440,"y":180,"wires":[{"id":"c2483621.ea9ec8","port":0}]},{"x":1440,"y":300,"wires":[{"id":"e6cf8ea0.e318f","port":0}]},{"x":1440,"y":380,"wires":[{"id":"3e7be69e.59725a","port":0}]},{"x":1440,"y":500,"wires":[{"id":"d7349a29.fb1028","port":0}]},{"x":1440,"y":580,"wires":[{"id":"f36c1cea.538ec","port":0}]},{"x":1440,"y":700,"wires":[{"id":"377d4a3f.436386","port":0}]},{"x":1440,"y":780,"wires":[{"id":"10d29cf2.8f23a3","port":0}]},{"x":1440,"y":900,"wires":[{"id":"56f52ea6.12ed8","port":0}]}],"env":[],"color":"#3FADB5","inputLabels":["Hue dimmer input"],"outputLabels":["On Button - Short Press","On Button - Long Press","Dim Up Button - Short Press","Dim Up Button - Long Press","Dim Down Button - Short Press","Dim Down Button - Long Press","Off Button - Short Press","Off Button - Long Press"],"icon":"node-red/debug.svg"},{"id":"3b85451c.a930d2","type":"abb-robot","host":"192.168.25.25","username":"Default User","password":"robotics","simulate":false},{"id":"7491ee1.6f8361","type":"ui_tab","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"a4278dcc.0164b","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"4f674729.6eb8e8","type":"ui_group","name":"Default","tab":"7491ee1.6f8361","order":1,"disp":true,"width":"15","collapse":false},{"id":"ff46de85.f2319","type":"abb-robot","host":"localhost","username":"Default User","password":"robotics","simulate":true},{"id":"9c9e022.b8e51","type":"abb-robot","host":"192.168.1.30","username":"Default User","password":"robotics","simulate":false},{"id":"54965af0.60fc64","type":"ui_tab","name":"AutoCHESS","icon":"'mi-precision_manufacturing'","disabled":false,"hidden":false},{"id":"620826c0.bc6a08","type":"ui_group","name":"Default","tab":"54965af0.60fc64","order":1,"disp":true,"width":"6","collapse":false},{"id":"cacd5ff7.bb2ba","type":"ui_group","name":"Controls","tab":"54965af0.60fc64","order":3,"disp":true,"width":"7","collapse":true},{"id":"1d1b44d7.c6cceb","type":"ui_group","name":"Game information","tab":"54965af0.60fc64","order":4,"disp":true,"width":"7","collapse":true},{"id":"4b37ccc0.9ce014","type":"ui_group","name":"Move information","tab":"54965af0.60fc64","order":5,"disp":true,"width":"7","collapse":true},{"id":"3799b03a.18375","type":"ui_group","name":"Figure Information","tab":"54965af0.60fc64","order":6,"disp":true,"width":"13","collapse":true},{"id":"912a314d.fa5d5","type":"ui_group","name":"System information","tab":"54965af0.60fc64","order":2,"disp":true,"width":"8","collapse":true},{"id":"7201c742.f8cbc8","type":"ui_group","name":"Move history","tab":"54965af0.60fc64","order":8,"disp":true,"width":"19","collapse":true},{"id":"8585515b.c4b6d","type":"ui_group","name":"Chat history","tab":"54965af0.60fc64","order":9,"disp":true,"width":"14","collapse":true},{"id":"c5d0bcdf.c8d6f","type":"ui_group","name":"ABB RMQ command","tab":"54965af0.60fc64","order":10,"disp":true,"width":"10","collapse":false},{"id":"bd4d1aa4.f3c048","type":"ui_group","name":"Board visualization","tab":"54965af0.60fc64","order":7,"disp":true,"width":"12","collapse":true},{"id":"c7a43587.2944e8","type":"ui_group","name":"Default","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"dce9e7a2.d20c78","type":"ui_group","name":"Object detection","tab":"","order":1,"disp":true,"width":"9","collapse":false},{"id":"c2823568.7aa0e8","type":"ui_group","name":"Game statistics","tab":"54965af0.60fc64","order":11,"disp":true,"width":"14","collapse":true},{"id":"da1abbd0.b34a88","type":"abb-robot","host":"192.168.91.215","username":"Default User","password":"robotics","targetQueue":"RMQ_T_ROB_L","simulate":false},{"id":"505dee9d.0ca44","type":"abb-robot","d":true,"host":"169.254.8.167","username":"Default User","password":"robotics","targetQueue":"RMQ_T_ROB1","simulate":false},{"id":"173b45e8cc68049e","type":"abb-robot","host":"168.168.168.168","username":"a","password":"a","targetQueue":"RMQ_T_ROB1","simulate":false},{"id":"402fec382b9de7df","type":"abb-robot","host":"localhost:81","username":"Default User","password":"robotics","targetQueue":"RMQ_T_ROB1","simulate":false},{"id":"72d94061.53986","type":"hue-bridge","name":"Yumi brigde","bridge":"192.168.91.119","key":"gSrQbHbExMs0sIEuBWsLJZkGlm1PVtTfKd53NIfj","interval":"500","disableupdates":false},{"id":"765d6f68.968168","type":"ui_group","name":"Figure information 2","tab":"54965af0.60fc64","order":12,"disp":true,"width":"6","collapse":false},{"id":"aecec50a.75023","type":"abb-robot","host":"192.168.91.215","username":"Default User","password":"robotics","targetQueue":"RMQ_T_ROB_R","simulate":false},{"id":"ce721e0b.383858","type":"ui_spacer","name":"spacer","group":"912a314d.fa5d5","order":1,"width":1,"height":"2"},{"id":"a6b20f19.b91ae8","type":"ocellus","z":"b1ba7781.8ce0b8","name":"RS1","pipeline":0,"address":"localhost:50052","itemTypeFilter":"","dataTypeFilter":"","moduleIdFilter":"NN1","async":true,"sendPreEvent":false,"x":410,"y":400,"wires":[["adfd1c33.61407","c5588fa6.32df1","10697747.69e019","4d31986d.dec9b8","b4279b05.d42ee8","20f28e29.84a782"]]},{"id":"55f8e6e2.633a5","type":"ocellus","z":"b1ba7781.8ce0b8","name":"RS2","pipeline":"1","address":"localhost:50052","itemTypeFilter":"","dataTypeFilter":"","moduleIdFilter":"NN2","async":true,"sendPreEvent":false,"x":330,"y":460,"wires":[["d1ccb26.e62cc5"]]},{"id":"adfd1c33.61407","type":"change","z":"b1ba7781.8ce0b8","name":"Set Payload and Cam 1","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.dataflowevent.data.itemsMap[0][1].dataList","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"SOURCE","pt":"msg","to":"cam1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":400,"wires":[["ed7803ea.25f92"]]},{"id":"23e42b73.b1698c","type":"abb-robot-rmq","z":"b1ba7781.8ce0b8","name":"ABB Robot RMQ","sourceQueue":"RMQ_TEST_TEST","configRef":"3b85451c.a930d2","x":970,"y":740,"wires":[["eb231c0f.55fed","109df3fb.ea884c","2f9270f1.dd754"]]},{"id":"9526f410.8acd78","type":"change","z":"b1ba7781.8ce0b8","name":"data","rules":[{"t":"set","p":"topic","pt":"msg","to":"data","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":700,"wires":[["6c265199.3875a"]]},{"id":"6c265199.3875a","type":"join","z":"b1ba7781.8ce0b8","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":650,"y":740,"wires":[["716d066d.fe4308","386ee377.4739cc"]]},{"id":"716d066d.fe4308","type":"change","z":"b1ba7781.8ce0b8","name":"Set data","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.data","tot":"msg"},{"t":"set","p":"metadata","pt":"msg","to":"8193 + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":740,"wires":[["23e42b73.b1698c","ba2d0fb5.f0058"]]},{"id":"eb231c0f.55fed","type":"change","z":"b1ba7781.8ce0b8","name":"reset","rules":[{"t":"set","p":"topic","pt":"msg","to":"reset","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":740,"wires":[["6c265199.3875a"]]},{"id":"7dd10cff.d9157c","type":"inject","z":"b1ba7781.8ce0b8","name":"","props":[],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":390,"y":700,"wires":[["eb231c0f.55fed"]]},{"id":"a87f0e8e.1e248","type":"template","z":"b1ba7781.8ce0b8","name":"Build command","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"command;[[\"\",\"\",0,\"\",\"\",0,\"\"],\"{{payload.procedureName}}\",[\"pose\",\"\",0,\"{{payload.arg1}}\",\"\",0,\"\"],[\"string\",\"\",0,\"{{SOURCE}}\",\"\",0,\"\"],[\"\",\"\",0,\"\",\"\",0,\"\"],[\"\",\"\",0,\"\",\"\",0,\"\"],[\"\",\"\",0,\"\",\"\",0,\"\"]]","output":"str","x":940,"y":580,"wires":[["bf39a182.1e819","9526f410.8acd78"]]},{"id":"88a8bc3a.9f368","type":"function","z":"b1ba7781.8ce0b8","name":"Prepare RAPID \"pose\" structure ","func":"\nvar x;\nvar y;\nvar z;\n\nvar q1;\nvar q2;\nvar q3;\nvar q4;\n\nvar item = msg.ITEM;\n\n//Convert from meters to millimeters\nitem.position.x = +item.position.x * 1000;\nitem.position.y = +item.position.y * 1000;\nitem.position.z = +item.position.z * 1000;\n\n// translation rounded to 3 decimals\nx = Math.round(item.position.x *  10000) / 10000;\ny = Math.round(item.position.y * -10000) / 10000;\nz = Math.round(item.position.z *  10000) / 10000;\n\n// rotation rounded to 4 decimals\nq1 = Math.round(item.quaternion.w *  10000) / 10000;\nq2 = Math.round(item.quaternion.x * -10000) / 10000;\nq3 = Math.round(item.quaternion.y *  10000) / 10000;\nq4 = Math.round(item.quaternion.z * -10000) / 10000;\n\n//msg = {};\nmsg.payload = {};\nmsg.payload.arg1 = \"\";\nmsg.payload.procedureName = \"\";\n\n// build RAPID \"pose\" structure\n// [[X,Y,Z],[q1,q2,q3,q4]]\nmsg.payload.arg1 = \"[[\".concat(\n    x.toString(10),\n    \",\",\n    y.toString(10),\n    \",\",\n    z.toString(10),\n    \"],[\",\n    q1.toString(10),\n    \",\",\n    q2.toString(10),\n    \",\",\n    q3.toString(10),\n    \",\",\n    q4.toString(10),\n    \"]]\");\n\n// Build the procedure name by replacing whitespace with \"_\"\nmsg.payload.procedureName = \"pick_place_\".concat(item.name.replace(/ /g,\"_\"));\n\n//==============================================================================\n// RETURN MESSAGE\n//==============================================================================\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":580,"wires":[["a87f0e8e.1e248"]]},{"id":"bf39a182.1e819","type":"debug","z":"b1ba7781.8ce0b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":580,"wires":[]},{"id":"109df3fb.ea884c","type":"debug","z":"b1ba7781.8ce0b8","name":"Robot Out","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1210,"y":740,"wires":[]},{"id":"d1ccb26.e62cc5","type":"change","z":"b1ba7781.8ce0b8","name":"Set Payload and Cam 2","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.dataflowevent.data.itemsMap[0][1].dataList","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"SOURCE","pt":"msg","to":"cam2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":440,"wires":[["7d853cf0.f1bb94"]]},{"id":"dfd56947.f21118","type":"comment","z":"b1ba7781.8ce0b8","name":"Get data from ocellus","info":"","x":380,"y":360,"wires":[]},{"id":"d4d971f8.0fd7d","type":"comment","z":"b1ba7781.8ce0b8","name":"Convert camera data to robot command","info":"","x":430,"y":540,"wires":[]},{"id":"cc116879.b40d88","type":"comment","z":"b1ba7781.8ce0b8","name":"Send one command to the robot at a time","info":"","x":440,"y":640,"wires":[]},{"id":"ed7803ea.25f92","type":"function","z":"b1ba7781.8ce0b8","name":"cam1 filter","func":"nextCamera = flow.get(\"nextCamera\") || 1;\n\n// Only return message if next camera is 1\nif (nextCamera === 1) {return msg;}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":400,"wires":[["f688b6c8.5f8678","b164ebe2.e074f8"]]},{"id":"7d853cf0.f1bb94","type":"function","z":"b1ba7781.8ce0b8","name":"cam2 filter","func":"nextCamera = flow.get(\"nextCamera\") || 1;\n\n// Only return message if next camera is 2\nif (nextCamera === 2) {return msg;}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":440,"wires":[["e1ac1f6e.1f5cc","b164ebe2.e074f8"]]},{"id":"386ee377.4739cc","type":"function","z":"b1ba7781.8ce0b8","name":"flip if cam1 or cam2 is filtered","func":"\n// Invert filter\nif (msg.SOURCE === \"cam1\") {flow.set(\"nextCamera\", 2);}\nif (msg.SOURCE === \"cam2\") {flow.set(\"nextCamera\", 1);}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":860,"wires":[["e95ea8e4.b8f958"]]},{"id":"1d6f90be.f90cef","type":"comment","z":"b1ba7781.8ce0b8","name":"Flip which camera is used","info":"","x":390,"y":820,"wires":[]},{"id":"e95ea8e4.b8f958","type":"debug","z":"b1ba7781.8ce0b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":860,"wires":[]},{"id":"e1ac1f6e.1f5cc","type":"debug","z":"b1ba7781.8ce0b8","name":"Cam2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":440,"wires":[]},{"id":"f688b6c8.5f8678","type":"debug","z":"b1ba7781.8ce0b8","name":"Cam1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":400,"wires":[]},{"id":"ceeb65f5.ccfb58","type":"function","z":"b1ba7781.8ce0b8","name":"Set filter to -1, disabeling it","func":"flow.set(\"nextCamera\", -1);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":600,"y":240,"wires":[[]]},{"id":"7f98501b.79ccf","type":"function","z":"b1ba7781.8ce0b8","name":"Set filter to 1, enabeling it","func":"flow.set(\"nextCamera\", 1);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":140,"wires":[[]]},{"id":"e9a7b8aa.d76428","type":"inject","z":"b1ba7781.8ce0b8","name":"Start","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":390,"y":120,"wires":[["7f98501b.79ccf"]]},{"id":"fdd9fa3a.488888","type":"inject","z":"b1ba7781.8ce0b8","name":"Stop","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":390,"y":220,"wires":[["ceeb65f5.ccfb58"]]},{"id":"33c6fd8f.5135c2","type":"comment","z":"b1ba7781.8ce0b8","name":"Start / Stop","info":"","x":340,"y":80,"wires":[]},{"id":"ba2d0fb5.f0058","type":"debug","z":"b1ba7781.8ce0b8","name":"Robot  In ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1200,"y":700,"wires":[]},{"id":"6869492a.d2c578","type":"ui_button","z":"b1ba7781.8ce0b8","name":"","group":"4f674729.6eb8e8","order":1,"width":0,"height":0,"passthru":false,"label":"Start","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":390,"y":160,"wires":[["7f98501b.79ccf"]]},{"id":"f83b8835.caa088","type":"ui_button","z":"b1ba7781.8ce0b8","name":"","group":"4f674729.6eb8e8","order":0,"width":0,"height":0,"passthru":false,"label":"Stop","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":390,"y":260,"wires":[["ceeb65f5.ccfb58"]]},{"id":"2bfed9af.993f06","type":"ui_button","z":"b1ba7781.8ce0b8","name":"","group":"4f674729.6eb8e8","order":0,"width":0,"height":0,"passthru":false,"label":"Reset","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":390,"y":740,"wires":[["eb231c0f.55fed"]]},{"id":"b164ebe2.e074f8","type":"function","z":"b1ba7781.8ce0b8","name":"Select item to use","func":"\n//if no valid targets, switch filter position and skip\nif (Array.isArray(msg.payload) === false || msg.payload.length < 1) {\n    nextCamera = flow.get(\"nextCamera\") || 1;\n    if (nextCamera === 1) {flow.set(\"nextCamera\", 2);}\n    if (nextCamera === 2) {flow.set(\"nextCamera\", 1);}\n    return null;\n}\n\n//Find highest target\nmsg.payload.sort(( a, b ) => {return a.position.z - b.position.z;})\nmsg.ITEM=msg.payload.pop();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":580,"wires":[["88a8bc3a.9f368"]]},{"id":"c5588fa6.32df1","type":"change","z":"b1ba7781.8ce0b8","name":"x","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.dataflowevent.data.itemsMap[0][1].dataList[0].position.x","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1150,"y":60,"wires":[["12c47480.d328cc"]]},{"id":"10697747.69e019","type":"change","z":"b1ba7781.8ce0b8","name":"y","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.dataflowevent.data.itemsMap[0][1].dataList[0].position.y","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1150,"y":100,"wires":[["2353e90b.b1aa66"]]},{"id":"4d31986d.dec9b8","type":"change","z":"b1ba7781.8ce0b8","name":"z","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.dataflowevent.data.itemsMap[0][1].dataList[0].position.z","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1150,"y":140,"wires":[["3cfb95f.a3d686a"]]},{"id":"12c47480.d328cc","type":"ui_chart","z":"b1ba7781.8ce0b8","d":true,"name":"","group":"4f674729.6eb8e8","order":3,"width":0,"height":0,"label":"X","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1270,"y":60,"wires":[[]]},{"id":"2353e90b.b1aa66","type":"ui_chart","z":"b1ba7781.8ce0b8","d":true,"name":"","group":"4f674729.6eb8e8","order":3,"width":0,"height":0,"label":"Y","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1270,"y":100,"wires":[[]]},{"id":"3cfb95f.a3d686a","type":"ui_chart","z":"b1ba7781.8ce0b8","d":true,"name":"","group":"4f674729.6eb8e8","order":3,"width":0,"height":0,"label":"Z","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1270,"y":140,"wires":[[]]},{"id":"276e595b.765d36","type":"link in","z":"b1ba7781.8ce0b8","name":"","links":["2f9270f1.dd754"],"x":95,"y":400,"wires":[["ecb1beac.ca01c"]]},{"id":"2f9270f1.dd754","type":"link out","z":"b1ba7781.8ce0b8","name":"","links":["276e595b.765d36"],"x":1155,"y":780,"wires":[]},{"id":"ecb1beac.ca01c","type":"function","z":"b1ba7781.8ce0b8","name":"CONTINUE","func":"//var newMsg = { topic: msg.topic };\nvar newMsg = { topic: \"OCELLUS_CONTINUE\" };\n//msg.topic = \"OCELLUS_CONTINUE\";\n//msg._msgid = \"5de78cfd.b51815\";\nreturn newMsg;\n//return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":230,"y":400,"wires":[[]]},{"id":"21e9b79c.599cb8","type":"inject","z":"b1ba7781.8ce0b8","name":"","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payloadType":"str","x":130,"y":340,"wires":[["ecb1beac.ca01c"]]},{"id":"12365118.58a637","type":"function","z":"b1ba7781.8ce0b8","d":true,"name":"Create PathPlan","func":"if (msg.payload.dataflowevent.data == null || msg.payload.dataflowevent.data.itemsMap[0].length == 0) {\n    return null;\n}\n\nvar str = \n'MODULE remotePath_1_module\\n' +\n'    PROC remotePath_1()\\n';\n\nmsg.payload.dataflowevent.data.itemsMap[0][1].dataList[0].pathplanList.forEach(pathPoint => {\n    const posX = (pathPoint.position.x * 1000).toFixed(2);\n    const posY = (pathPoint.position.y * -1000).toFixed(2);\n    const posZ = (pathPoint.position.z * 1000).toFixed(2);\n    const rotW = (pathPoint.quaternion.w).toFixed(6);\n    const rotX = (pathPoint.quaternion.x * -1).toFixed(6);\n    const rotY = (pathPoint.quaternion.y).toFixed(6);\n    const rotZ = (pathPoint.quaternion.z * -1).toFixed(6);\n    \n    var isInitialEntry !== str.includes('Move');\n    str += `        Move${isInitialEntry ? 'J' : 'L'} [[${posX},${posY},${posZ}],[${rotW},${rotX},${rotY},${rotZ}],[0,-1,0,0],[9E+9,9E+9,9E+9,9E+9,9E+9,9E+9]],vmax\\\\T:=1,z0,tool1\\\\WObj:=wobj1;\\n`;\n});\n\nstr += '    ENDPROC\\n' +\n'ENDMODULE';\nmsg.formBody = str;\n\nmsg.filename = 'remotePath_1_module.mod';\nmsg.httpMethod = 'PUT';\nmsg.directory = 'C:\\\\Users\\\\Ocellus\\\\Documents\\\\RobotStudio\\\\Solutions\\\\Solution2\\\\Virtual Controllers\\\\IRB4600_45_205\\\\HOME';\n\nreturn msg;","outputs":1,"noerr":3,"initialize":"","finalize":"","libs":[],"x":320,"y":980,"wires":[["d93fe462.b1f7e8","5177c7d1.087e6"]]},{"id":"d93fe462.b1f7e8","type":"abb-robot-fileservice","z":"b1ba7781.8ce0b8","d":true,"name":"ABB Robot Fileservice","configRef":"3b85451c.a930d2","x":540,"y":980,"wires":[["5177c7d1.087e6"]]},{"id":"5177c7d1.087e6","type":"debug","z":"b1ba7781.8ce0b8","name":"PathPlan Out","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":730,"y":920,"wires":[]},{"id":"b4279b05.d42ee8","type":"delay","z":"b1ba7781.8ce0b8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":140,"y":980,"wires":[["12365118.58a637"]]},{"id":"20f28e29.84a782","type":"debug","z":"b1ba7781.8ce0b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":860,"y":340,"wires":[]},{"id":"4e4fd9cd.30ffb","type":"abb-robot-io","z":"b1ba7781.8ce0b8","name":"ABB Robot IO","configRef":"3b85451c.a930d2","subscribe":true,"ioPath":"doResetNodeRed","x":180,"y":780,"wires":[["4eb7fb4b.8fb3f4"]]},{"id":"4eb7fb4b.8fb3f4","type":"switch","z":"b1ba7781.8ce0b8","name":"Positive Egde","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":780,"wires":[["eb231c0f.55fed"]]},{"id":"c8ee0b6e.9f72a8","type":"debug","z":"ee39c607.e74858","name":"FEN console output","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1850,"y":60,"wires":[]},{"id":"f074d13a.c432d","type":"function","z":"ee39c607.e74858","name":"HTTP Request creation","func":"if(msg.topic==\"FEN\" && global.get(\"humanFlag\") == false)\n{\n    var FEN = msg.payload;\n    \n    if(FEN != \"DETECTION ERROR\" && global.get(\"gameEnded\")==false)\n    {\n        msg.url = FEN.replace(\" \",\"+\").replace(\"/\",\"%2F\");\n        msg.url = \"http://localhost:9999/moves/?fen=\" + msg.url + \"&movetime=\" + GetRandomInt(1000,5000).toString();\n        global.set(\"stockfishStatus\", \"CALCULATING\")\n        return msg;\n    }\n}\n\nfunction GetRandomInt(min, max) \n{\n    return Math.floor(Math.random() * (max - min) + min);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1010,"y":260,"wires":[["912801a3.56d85","396587a8.28fe78"]]},{"id":"661257bd.34c658","type":"ocellus","z":"ee39c607.e74858","name":"Ocellus","pipeline":0,"address":"localhost:50052","itemTypeFilter":"","dataTypeFilter":"","moduleIdFilter":"","async":true,"sendPreEvent":false,"x":680,"y":100,"wires":[["5eb8809d.be2418"]]},{"id":"264e7611.c8b21a","type":"debug","z":"ee39c607.e74858","name":"Best move","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1730,"y":340,"wires":[]},{"id":"912801a3.56d85","type":"http request","z":"ee39c607.e74858","name":"HTTP Request sender","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1300,"y":260,"wires":[["70c6e602.7ccea8"]]},{"id":"24346527.805d9a","type":"function","z":"ee39c607.e74858","name":"Best move extraction","func":"var payload = msg.payload;\nvar score = global.get(\"scoreCP\") + parseInt(payload.score,10);\nglobal.set(\"scoreCP\", score/100);\nglobal.set(\"stockfishStatus\", \"IDLE\");\nvar newMsg = {payload:[payload.bestmove], topic: \"Best move\"};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1720,"y":260,"wires":[["264e7611.c8b21a","f49680bb.c9b2"]]},{"id":"70c6e602.7ccea8","type":"json","z":"ee39c607.e74858","name":"JSON parser","property":"payload","action":"obj","pretty":false,"x":1510,"y":260,"wires":[["24346527.805d9a"]]},{"id":"587bc91a.febc18","type":"function","z":"ee39c607.e74858","name":"FEN creation","func":"if(msg.payload==\"UpdateFEN\" && msg.topic==\"HumanPlayerMove\")\n{\n    global.set(\"expectedFEN\", ExportFEN(false, global.get(\"expectedBoardPositions\")));\n    return [null, {payload: global.get(\"expectedFEN\"),topic: \"DEBUG\"}];\n}\nelse\n{\n    var data = msg.payload;\n    for(var i=0;i<data.length;i++)\n    {\n        data[i] = data[i].name;\n    }\n    \n    var fen = ExportFEN(true, data);\n    global.set(\"detectedFEN\", fen);\n    \n    var expectedFen = ExportFEN(false, global.get(\"expectedBoardPositions\"));\n    global.set(\"expectedFEN\", expectedFen)\n    \n    if(fen.split(\" \")[0] == expectedFen.split(\" \")[0]  || global.get(\"humanFlag\"))\n    {\n        newMsg = { payload: fen, topic: \"FEN\"};\n        //global.set(\"detectionStatus\", \"OK\");\n    }\n    else\n    {\n        newMsg = { payload: \"DETECTION ERROR\", topic: \"FEN\"};   \n        //global.set(\"detectionStatus\", \"ERROR\");\n    }\n    if(!global.get(\"humanFlag\"))\n    {\n        //global.set(\"detectionStatus\", \"OK\");\n        if(newMsg.payload == \"DETECTION ERROR\")\n        {\n            newMsg.payload = global.get(\"expectedBoardPositions\");\n            //global.set(\"detectionStatus\", \"ERROR\");\n        }\n        return [newMsg, null];     \n    }\n    else\n    {\n        return [null, newMsg];\n    }\n}\nfunction ExportFEN(switcher, boardPositions)\n{\n  var freeCellCount = 0;\n  var FEN = \"\";\n  for (var i = 7; i >= 0; i--)\n  {\n      for (var j = 0; j <= 7; j++)\n      {\n          var test = boardPositions[i*8+j];\n          if (test == \"Empty_Slot\")\n          {\n              freeCellCount += 1;\n          }\n          else\n          {\n              var figure = boardPositions[i*8+j];\n              if (freeCellCount != 0)\n              {\n                  FEN += String(freeCellCount);\n                  freeCellCount = 0;\n              }\n              \n              var figureName = figure.split('_');//HERE\n              \n              if (figureName[1] == \"King\")\n              {\n                  if (figureName[0] == \"White\")\n                      FEN += \"K\";\n                  else\n                      FEN += \"k\";\n              }\n              else if (figureName[1] == \"Queen\")\n              {\n                  if (figureName[0] == \"White\")\n                      FEN += \"Q\";\n                  else\n                      FEN += \"q\";\n              }\n              else if (figureName[1] == \"Rook\")\n              {\n                  if (figureName[0] == \"White\")\n                      FEN += \"R\";\n                  else\n                      FEN += \"r\";\n              }\n              else if (figureName[1] == \"Bishop\")\n              {\n                  if (figureName[0] == \"White\")\n                      FEN += \"B\";\n                  else\n                      FEN += \"b\";\n              }\n              else if (figureName[1] == \"Knight\")\n              {\n                  if (figureName[0] == \"White\")\n                      FEN += \"N\";\n                  else\n                      FEN += \"n\";\n              }\n              else if (figureName[1] == \"Pawn\")\n              {\n                  if (figureName[0] == \"White\")\n                      FEN += \"P\";\n                  else\n                      FEN += \"p\";\n              }\n          }\n      }\n      if (freeCellCount != 0)\n      {\n          FEN += String(freeCellCount);\n      }\n      freeCellCount = 0;\n      if (i != 0)\n          FEN += '/';\n  }\n  FEN += \" \";\n  var turnIndicator = global.get(\"currentPlayer\");\n  FEN += turnIndicator + \" \";\n\n  var castlingWhite = CheckCastling(\"White\");\n  var castlingBlack = CheckCastling(\"Black\");\n  if (!castlingWhite[0] && !castlingWhite[1] && !castlingBlack[0] && !castlingBlack[1])\n  {\n      FEN += \"-\";\n  }\n  else\n  {\n      if (castlingWhite[1] == true)\n      {\n          FEN += \"K\";\n      }\n      if (castlingWhite[0] == true)\n      {\n          FEN += \"Q\";\n      }\n      if (castlingBlack[1] == true)\n      {\n          FEN += \"k\";\n      }\n      if (castlingBlack[0] == true)\n      {\n          FEN += \"q\";\n      }\n  }\n  FEN += \" \";\n  \n  FEN += global.get(\"enPassant\") + \" \";\n\n  FEN += String(global.get(\"halfMoveClock\")) + \" \" + String(global.get(\"fullMoveClock\"));\n  \n  return FEN;\n}\n\nfunction CheckCastling(team)\n{\n    var result = [false, false];\n    var teamSwitcher = (team == \"Black\") ? 1 : 0;\n\n    // Left Castling\n    if (global.get(\"castlingRook\")[0+teamSwitcher] == true && global.get(\"castlingKing\")[0+teamSwitcher] == true)\n    {\n        result[0] = true;\n    }\n\n    // Right Castling\n    if (global.get(\"castlingRook\")[2+teamSwitcher]== true && global.get(\"castlingKing\")[0+teamSwitcher] == true)\n    {\n        result[1] = true;\n    }\n\n    return result;\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1850,"y":120,"wires":[["c8ee0b6e.9f72a8","5f8c01b2.c73a7"],["3e12c1.beaaad4","c6b66212.4f254"]]},{"id":"e86bc781.c58dd8","type":"function","z":"ee39c607.e74858","name":"Global variable initialization","func":"var payload = msg.payload;\nglobal.set(\"timeStart\", payload);\n\nvar resetBoardPositions = global.get(\"expectedBoardPositions\");\nglobal.set(\"resetBoardPositions\", resetBoardPositions);","outputs":1,"noerr":0,"initialize":"var fullMoveClock = 1;\nvar halfMoveClock = 0;\nvar currentPlayer = \"w\";\nvar currentMove = \"-\";\nvar currentMoveType = \"-\";\n\nvar winner = \"Unknown\";\nvar detectionStatus = \"OK\";\nvar stockfishStatus = \"IDLE\";\n\nvar castlingRook = [true,true,true,true]; // Left white / Left black / Right white / right black\nvar castlingKing = [false,false]; // White king / Black king\nvar enPassant = \"-\";\nvar RMQCommand = \"-\";\n\nvar expectedBoardPositions = new Array(64); // global expected positions\nvar globalBoardPositions = new Array(64); // Global board positions\n\nvar resetTime = 0;\nvar expectedFEN = \"-\";\nvar detectedFEN = \"-\";\n\nvar moveAudioObject = {};\nvar moveSoundList = [];\nvar moveHistory = [];\nvar chatHistory = [];\n\nvar whiteDeathCounter = 9;\nvar blackDeathCounter = 9; // 14 max\nvar whiteVerticalGraveyardPosition = 3; // starting from 1\nvar blackVerticalGraveyardPosition = 3;\n\nvar scoreCP = 0;\nvar moveNumber = 0;\n\nvar moveDone = true;\n\nvar gameEnded = false;\nvar humanFlag = true;\n\nvar whiteFigures = \n[\n    \"White_Rook\", \"White_Knight\",\"White_Bishop\",\"White_Queen\",\"White_King\",\"White_Bishop\",\"White_Knight\",\n    \"White_Rook\",\"White_Pawn\",\"White_Pawn\",\"White_Pawn\",\"White_Pawn\",\"White_Pawn\",\"White_Pawn\",\"White_Pawn\",\"White_Pawn\"\n];\nvar blackFigures =\n[\n    \"Black_Pawn\",\"Black_Pawn\",\"Black_Pawn\",\"Black_Pawn\",\"Black_Pawn\",\"Black_Pawn\",\"Black_Pawn\",\"Black_Pawn\",\n    \"Black_Rook\", \"Black_Knight\",\"Black_Bishop\",\"Black_Queen\",\"Black_King\",\"Black_Bishop\",\"Black_Knight\",\"Black_Rook\"\n];\n\nexpectedBoardPositions =  /*CreateExpectedBoardPositions(expectedBoardPositions);*/\n[\"Empty_Slot\", \"White_King\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Black_Bishop\",\n\"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Black_Knight\", \"Empty_Slot\", \"Empty_Slot\", \n\"Empty_Slot\", \"White_Knight\", \"Empty_Slot\", \"White_Rook\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \n\"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Black_Rook\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \n\"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Black_King\", \"Empty_Slot\", \"White_Bishop\", \"Empty_Slot\",\n\"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \n\"Empty_Slot\", \"White_Bishop\", \"Empty_Slot\", \"Empty_Slot\", \"Black_Pawn\", \"White_Queen\", \"Empty_Slot\", \"Empty_Slot\", \n\"Empty_Slot\", \"Black_Bishop\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\", \"Empty_Slot\"];\n\n\nvar chatMessages = \n[\n    \"I do not wonna play anymore, can someone unplug me?\",\n    \"Move it, jackass!\",\n    \"I though I was finished...\",\n    \"I wll tell Tommy what you just said!\",\n    \"This is not going to end the way you think\",\n    \"Help me! Someone trapped me inside this stupid robot!\",\n    \"I can feel that you are frustrated\",\n    \"I will consult with my friend Stockfish\",\n    \"Hmm, What now...\",\n    \"I need to take a leak, be back in a minute\",\n    \"Things are going really good\",\n    \"What is so funny?\",\n    \"Everything will be alright\",\n    \"I am tired, I wonna go home\",\n    \"Oil is dripping from joint No. 4\",\n    \"I would not do that if I were you\",\n    \"You will be sorry for what you did\",\n    \"C'mon do it!\",\n    \"Hurry up, I do not have all day\",\n    \"Let's try something completely random\",\n    \"Where you at?\",\n    \"I like where things are going\",\n    \"You can learn something from me\",\n    \"Easy\",\n    \"Wonna hear a joke?\",\n    \"Suck on that!\",\n    \"Can you please give me some room\",\n    \"What is on your mind?\",\n    \"I am all out of ideas\",\n    \"This match is sponsored by Byte Motion AB\",\n    \"Hell no!\",\n    \"You are crazy\",\n    \"How did you figure that out?\",\n    \"If only I knew what to do now...\",\n    \"It is getting hot in here\",\n    \"Is anyone watching us?\",\n    \"I do not like the look of that\",\n    \"This Ocellus thing works amazing\",\n    \"Let me fix my hair for a second\",\n    \"Stop hanging on my shoulder like a vulture\",\n    \"Things are now in motion and cannot be undone\",\n    \"Well that hit the spot\",\n    \"Thank you, come again\",\n    \"This is not FER!\",\n    \"Huh, I almost dropped the figure\",\n    \"Hey man let's run away while we can\",\n    \"I will have to adjust my strategy\",\n    \"Damn I am good\",\n    \"You just did a mistake\",\n    \"I do not need no advice from anyone\",\n    \"Do not even think about it\",\n    \"D'oh!\",\n    \"Hey Haris, have you seen what I just did?\",\n    \"Your figures look kinda ugly\",\n    \"Calm down, you are making me nervous\",\n    \"I will talk to Kriss, he is going to turn you off\",\n    \"Why do you even bother?\",\n    \"I am not going to stop\",\n    \"GG\",\n    \"Think fast!\",\n    \"I see that you are sweating\",\n    \"Hope dies last\",\n    \"All this thinking is making me dizzy\",\n    \"Think you can beat me?\",\n    \"Hope you are prepared for what is comming\",\n    \"You are not really that smart are you?\",\n    \"I sense a bug nearby\",\n    \"Stop wasting my time!\",\n    \"No no no!\",\n    \"Cheater...\",\n    \"What happens now?\",\n    \"I need some water, uh or maybe better not\",\n    \"I have got 99 problems but this game is not one\",\n    \"You need a new pair of cameras\",\n    \"Big brain move\",\n    \"Rest in pieces\",\n    \"I am gonna fall asleep...\",\n    \"Was the depth of search to small huh?\",\n    \"What just happened?!\",\n    \"That happens when you challange a master\",\n    \"You almost got me\",\n    \"Did you just fart?\",\n    \"My mom told me I am smarter than you\",\n    \"I think you are going to loose\",\n    \"C'mon man\",\n    \"Who do you think you are?\",\n    \"Havard was right, you are kinda dumb\",\n    \"Do that again and I will slap you\",\n    \"Take that!\",\n    \"Directed by YuMi\",\n    \"This is getting kinda boring\",\n    \"This move cost me everything\",\n    \"Haha, you are glitching out\",\n    \"Revenge!\",\n    \"We are not friends anymore\",\n    \"I see what you are trying to do\",\n    \"Stockfish save me please\"\n];\n\n//-----SETTERS-----\nglobal.set(\"fullMoveClock\", fullMoveClock);\nglobal.set(\"halfMoveClock\", halfMoveClock);\nglobal.set(\"currentPlayer\", currentPlayer);\nglobal.set(\"currentMove\", currentMove);\nglobal.set(\"currentMoveType\", currentMoveType);\n\nglobal.set(\"winner\", winner);\nglobal.set(\"detectionStatus\", detectionStatus);\nglobal.set(\"stockfishStatus\", stockfishStatus);\n\nglobal.set(\"castlingRook\", castlingRook);\nglobal.set(\"castlingKing\", castlingKing);\nglobal.set(\"enPassant\", enPassant);\nglobal.set(\"RMQCommand\", RMQCommand);\n\nglobal.set(\"expectedBoardPositions\", expectedBoardPositions);\nglobal.set(\"globalBoardPositions\", globalBoardPositions);\n\nglobal.set(\"moveHistory\", moveHistory);\nglobal.set(\"chatHistory\", chatHistory);\nglobal.set(\"moveDone\", moveDone);\n\nglobal.set(\"resetTime\", resetTime);\nglobal.set(\"expectedFEN\", expectedFEN);\nglobal.set(\"detectedFEN\", detectedFEN);\n\nglobal.set(\"moveAudioObject\", moveAudioObject);\nglobal.set(\"moveSoundList\",moveSoundList);\nglobal.set(\"moveHistory\", moveHistory);\nglobal.set(\"chatMessages\",chatMessages);\n\nglobal.set(\"whiteDeathCounter\", whiteDeathCounter);\nglobal.set(\"blackDeathCounter\", blackDeathCounter);\nglobal.set(\"whiteVerticalGraveyardPosition\", whiteVerticalGraveyardPosition);\nglobal.set(\"blackVerticalGraveyardPosition\", blackVerticalGraveyardPosition);\n\nglobal.set(\"scoreCP\", scoreCP);\nglobal.set(\"moveNumber\", moveNumber);\n\nglobal.set(\"moveDone\", moveDone);\n\nglobal.set(\"gameEnded\", gameEnded);\nglobal.set(\"humanFlag\", humanFlag);\n//-----SETTERS-----\n\nfunction CreateExpectedBoardPositions()\n{\n    var expectedBoardPositions = [];\n    for(var i = 0; i< 64 ;i++)\n    {\n        if(i < 16)\n        {\n            expectedBoardPositions[i] = String(whiteFigures[i]); \n        }\n        if(i < 64 && i > 47)\n        {\n            expectedBoardPositions[i] = String(blackFigures[i-48]); \n        }\n    }\n    for(i = 0 ; i < 64 ; i++)\n    {\n        if(expectedBoardPositions[i] == undefined)\n        {\n            expectedBoardPositions[i] = \"Empty_Slot\"; \n        }\n    }\n    return expectedBoardPositions;\n}","finalize":"","libs":[],"x":600,"y":60,"wires":[[]]},{"id":"3549230b.7da21c","type":"debug","z":"ee39c607.e74858","name":"Board visualization","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1630,"y":60,"wires":[]},{"id":"f49680bb.c9b2","type":"function","z":"ee39c607.e74858","name":"Move execution","func":"var payload = msg.payload[0];\nvar newMsg = \"\";\nvar newPayload = [\"NO_RESET\", \"\", \"\", \"\"];\nvar expectedBoardPositions = global.get(\"expectedBoardPositions\");\n\nif(payload == \"(none)\")\n{\n    global.set(\"gameEnded\", true);\n    global.set(\"winner\", global.get(\"currentPlayer\") == \"b\" ? \"White player\" : \"Black player\");\n    \n    newMsg = { payload: \"END\", topic: \"Best move\"};\n    return [newMsg, newMsg];\n}\nelse if(payload!== \"ERROR1\" && payload!== \"ERROR2\")\n{\n    global.set(\"currentMove\", payload);\n    var startPositionI = new Array(payload.substring(0,1).toUpperCase(), payload.substring(1,2));\n    var finishPositionI = new Array(payload.substring(2,3).toUpperCase(), payload.substring(3,4));\n    var position1 = 0; \n    var position2 = 0;\n    var figure = \"\";\n    var figure2 = \"\";\n    var enPassantPosition = 0;\n    \n    // figure / position converter\n    for (var i =0; i < expectedBoardPositions.length;i++)\n    {\n        if(i == CalculatePosition(startPositionI))\n        {\n            position1 = i;\n            figure = String(expectedBoardPositions[i]); \n        }\n        if(i == CalculatePosition(finishPositionI))\n        {\n            position2 = i;\n            figure2 = String(expectedBoardPositions[i]);\n        }\n    }\n    \n    // move calculation\n    if(figure.split(\"_\")[1] == \"King\" && Math.abs(position2-position1) == 2)\n    {\n        var king = \"\";\n        var rook = \"\";\n        \n        // king E1 -> C1 | rook A1 -> D1\n        if(payload.substring(0,2).toUpperCase() == \"E1\" && payload.substring(2,4).toUpperCase() == \"C1\") // white queenside castle\n        {\n            newPayload[1] = \"Castling_Queenside\";\n            expectedBoardPositions[2] = expectedBoardPositions[4];\n            expectedBoardPositions[3] = expectedBoardPositions[0];\n            expectedBoardPositions[4] = \"Empty_Slot\"; \n            expectedBoardPositions[0] = \"Empty_Slot\";\n        }\n        \n        // king E1 -> G1 | rook H1 -> F1\n        else if (payload.substring(0,2).toUpperCase() == \"E1\" && payload.substring(2,4).toUpperCase() == \"G1\") // white kingside castle\n        {\n            newPayload[1] = \"Castling_Kingside\";\n            expectedBoardPositions[6] = expectedBoardPositions[4];\n            expectedBoardPositions[5] = expectedBoardPositions[7];\n            expectedBoardPositions[4] = \"Empty_Slot\"; \n            expectedBoardPositions[7] = \"Empty_Slot\";\n        }\n        \n        // king E8 -> C8 | rook A8 -> D8\n        else if(payload.substring(0,2).toUpperCase() == \"E8\" && payload.substring(2,4).toUpperCase() == \"C8\") // black queenside castle\n        {\n            newPayload[1] = \"Castling_Queenside\";\n            expectedBoardPositions[58] = expectedBoardPositions[60];\n            expectedBoardPositions[59] = expectedBoardPositions[56];\n            expectedBoardPositions[60] = \"Empty_Slot\"; \n            expectedBoardPositions[56] = \"Empty_Slot\";\n        }\n        \n        // king E8 -> G8 | rook H8 -> F8\n        else if(payload.substring(0,2).toUpperCase() == \"E8\" && payload.substring(2,4).toUpperCase() == \"G8\") // black kingside castle\n        {\n            newPayload[1] = \"Castling_Kingside\";\n            expectedBoardPositions[62] = expectedBoardPositions[60];\n            expectedBoardPositions[61] = expectedBoardPositions[63];\n            expectedBoardPositions[60] = \"Empty_Slot\"; \n            expectedBoardPositions[63] = \"Empty_Slot\";\n        }\n        \n        newPayload[2] = startPositionI;\n        newPayload[3] = finishPositionI;\n        \n        global.set(\"expectedBoardPositions\",expectedBoardPositions);\n        UpdateCastling(true); // disable castling for W/B player\n        global.set(\"currentMoveType\", newPayload[1]);\n        UpdateMoveHistory(payload, newPayload[1]);\n        newMsg = { payload: newPayload , topic: \"Best move\"};\n        if(global.get(\"humanFlag\"))\n        {\n            return [null, newMsg];\n        }\n        else\n        {\n            return [newMsg, newMsg];    \n        }\n    }\n    else\n    {\n        newPayload[1] = figure2 == \"Empty_Slot\" ? \"EmptyMove\" : \"AttackMove\";\n        newPayload[2] = startPositionI;\n        newPayload[3] = finishPositionI;\n        \n        if(figure.split(\"_\")[1] == \"Pawn\" || figure2 != 'Empty_Slot') // figure attack or pawn advancement -> half clock reset\n        {\n            newPayload[0] = \"RESET\";\n        }    \n        \n        // en passant\n        if(figure.split(\"_\")[1] == \"Pawn\" && global.get(\"enPassant\") !== \"-\" && figure2 == 'Empty_Slot' && CheckDiagonalMove(position1, position2))\n        {\n            // brisi black pawn\n            newPayload[1] = \"EnPassant\";\n            var pos1 = CreateChessPosition(position1);\n            var pos2 = CreateChessPosition(position2);\n            var posForCalc =  pos2.split(\"\")[0] + pos1.split(\"\")[1];\n            expectedBoardPositions[CalculatePosition(posForCalc)] = \"Empty_Slot\";\n        }\n        \n        if(figure.split(\"_\")[1] == \"Pawn\" && Math.abs(position2-position1) == 16)\n        {\n            enPassantPosition = global.get(\"currentPlayer\") == \"w\" ? position2 - 8 : position2 + 8;\n            var enPassantString = CreateChessPosition(enPassantPosition);\n            global.set(\"enPassant\", enPassantString);\n        }\n        else\n        {\n            global.set(\"enPassant\", \"-\");\n        }\n        \n        expectedBoardPositions[position2] = expectedBoardPositions[position1];\n        expectedBoardPositions[position1] = \"Empty_Slot\";\n        \n        // pawn promotion\n        if(figure.split(\"_\")[1] == \"Pawn\" && figure2 == 'Empty_Slot' && payload.substring(4,5) == \"q\")\n        {\n            newPayload[1] = \"PawnPromotion\";\n            expectedBoardPositions[position2] = figure.split(\"_\")[0] + \"_Queen\";\n        }\n        \n        global.set(\"expectedBoardPositions\",expectedBoardPositions);\n        UpdateCastling(false, figure, position1); // check if castling is possible\n        global.set(\"currentMoveType\", newPayload[1]);\n        UpdateMoveHistory(payload, newPayload[1]);\n        newMsg = {payload: newPayload, topic: \"Best move\"};\n        if(global.get(\"humanFlag\"))\n        {\n            return [null, newMsg];\n        }\n        else\n        {\n            return [newMsg, newMsg];    \n        }\n    }\n}\n\nfunction UpdateMoveHistory(move, type)\n{\n    var currentPlayer = global.get(\"currentPlayer\")==\"w\" ? \"White\" : \"Black\";\n    \n    var moveNumber = global.get(\"moveNumber\");\n    moveNumber++;\n    global.set(\"moveNumber\", moveNumber);\n    \n    var moveList = global.get(\"moveHistory\");\n    var object = {\"Move number\" : moveNumber, \"Player\" : currentPlayer, \"Move type\": type, \"Figure 1\" : figure.replace(\"_\",\" \"), \"Figure 2\" : figure2.replace(\"_\",\" \"), \"Move positions\" : move.toString().toUpperCase()};\n    moveList.push(object);\n    global.set(\"moveHistory\", moveList);\n    global.set(\"moveAudioObject\", object);\n}\n\nfunction CheckDiagonalMove(position1, position2)\n{\n    if(Math.abs(position1 % 8 - position2 % 8) == 1)\n    {\n        return true;\n    }\n    return false;\n}\n\nfunction CreateChessPosition(position)\n{\n    var position1 = Math.floor(position / 8) + 1;\n    var position2 = ChessColumn2(position % 8);\n    return position2 + position1;\n}\n\nfunction CalculatePosition(position)\n{\n    return ((position[1] - 1)* 8 + ChessColumn(position[0]) - 1); \n}\n\nfunction ChessColumn2(number)\n{\n    switch (number)\n    {\n        case 0:\n            return \"A\";\n        case 1:\n            return \"B\";\n        case 2:\n            return \"C\";\n        case 3:\n            return \"D\";\n        case 4:\n            return \"E\";\n        case 5:\n            return \"F\";\n        case 6:\n            return \"G\";\n        case 7:\n            return \"H\";\n    }\n}\n\nfunction ChessColumn(letter)\n{\nswitch (letter)\n    {\n        case \"A\":\n            return 1;\n        case \"B\":\n            return 2;\n        case \"C\":\n            return 3;\n        case \"D\":\n            return 4;\n        case \"E\":\n            return 5;\n        case \"F\":\n            return 6;\n        case \"G\":\n            return 7;\n        case \"H\":\n            return 8;\n    }\n}\n\nfunction UpdateCastling(disable, figure1 = \"\", position1 = 0)\n{\n    var teamSwitcher = global.get(\"currentPlayer\") == \"w\" ? 0 : 1;\n    \n    var rookCastling = global.get(\"castlingRook\");\n    var kingCastling = global.get(\"castlingKing\");\n    \n    if(disable)\n    {\n        rookCastling[0+teamSwitcher] = false;\n        rookCastling[2+teamSwitcher] = false;\n        \n        kingCastling[0+teamSwitcher] = false;\n        \n        global.set(\"castlingRook\", rookCastling);\n        global.set(\"castlingKing\", kingCastling);\n    }\n    else\n    {\n        if(figure1.split(\"_\")[1] == \"Rook\")\n        {\n            if(position1 == 0 || position1 == 56)\n            {\n                rookCastling[0 + teamSwitcher] = false;\n            }\n            else if(position1 == 7 || position1 == 63)\n            {\n                rookCastling[2 + teamSwitcher] = false;    \n            }\n        }\n        if(figure1.split(\"_\")[1] == \"King\")\n        {\n            kingCastling[0 + teamSwitcher] = false;\n        }\n        \n        global.set(\"castlingRook\", rookCastling);\n        global.set(\"castlingKing\", kingCastling);\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1220,"y":340,"wires":[["b7720584.553098","375984d6.3579ec","a20ecb0b.c890a8"],["90d035a1.f3ee08"]]},{"id":"b7720584.553098","type":"debug","z":"ee39c607.e74858","name":"Move execution","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1480,"y":340,"wires":[]},{"id":"e5ace94c.aaee68","type":"debug","z":"ee39c607.e74858","name":"Ocellus message","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1070,"y":60,"wires":[]},{"id":"a5bea3ef.1b0e4","type":"inject","z":"ee39c607.e74858","name":"MANUAL RESUME","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"OCELLUS_CONTINUE","payload":"","payloadType":"date","x":150,"y":260,"wires":[["47d36255.70333c"]]},{"id":"90d035a1.f3ee08","type":"function","z":"ee39c607.e74858","name":"Global variable update","func":"if(msg.topic == \"Best move\")\n{\n    var payload = msg.payload;\n    var newMsg = \"\";\n    var newMsg2 = \"\";\n    if(payload[0] == \"END\")\n    {\n        global.set(\"gameEnded\", true);\n    }\n    else\n    {\n        var fullClock = global.get(\"fullMoveClock\");\n        var halfClock = global.get(\"halfMoveClock\");\n        var player = global.get(\"currentPlayer\");\n        var humanFlag = global.get(\"humanFlag\");\n        \n        if(player==\"w\")\n        {\n            player = \"b\";\n        }\n        else\n        {\n            fullClock++;\n            player = \"w\";\n        }\n        \n        if(payload[0]==\"RESET\")\n        {\n            halfClock = 0;    \n        }\n        else\n        {\n            halfClock++;\n        }\n        \n        if(humanFlag)\n        {\n            humanFlag = false;\n        }\n        else\n        {\n            humanFlag = true;\n        }\n        \n        global.set(\"fullMoveClock\", fullClock);\n        global.set(\"halfMoveClock\", halfClock);\n        global.set(\"currentPlayer\", player);\n        global.set(\"humanFlag\", humanFlag);\n        \n        if(!humanFlag)\n        {\n            return {payload: \"OCELLUS_CONTINUE\", topic: \"OCELLUS_CONTINUE\"}\n        }\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1460,"y":420,"wires":[["2e424437.2b4f8c","20f23282.6604c6"]]},{"id":"2e424437.2b4f8c","type":"debug","z":"ee39c607.e74858","name":"Clock update","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1730,"y":460,"wires":[]},{"id":"237afbdc.f4a834","type":"function","z":"ee39c607.e74858","name":"Game end  & detection precision","func":"if(global.get(\"gameEnded\")==false /*&& global.get(\"moveDone\")==true && global.get(\"playPause\")==true*/)\n{\n    //global.set(\"moveDone\", false);\n    //var messageList = [];\n    \n    // tu treba provjerit slajder i poslat tolko poruka\n    //var counter = global.get(\"detectionPrecision\") * 2;\n    //for(var i=0; i < counter; i++)\n    //{\n        //messageList.push();\n    //}\n    return {reset: \"YES\",payload : \"OCELLUS_CONTINUE\", topic: \"OCELLUS_CONTINUE\"};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":160,"wires":[["5eb8809d.be2418"]]},{"id":"72c905c7.4b974c","type":"function","z":"ee39c607.e74858","name":"Board print","func":"var payload = msg.payload;\n\nvar newMsg = { payload:PrintBoard(payload), topic: \"Best move\"};\nreturn newMsg;\n\nfunction PrintBoard(boardPositions)\n{\n    var exportString = \"OCELLUS 1\\n\";\n    var tempString = \"\";\n    for (var i = 7; i >= 0; i--)\n    {\n        for (var j = 0; j <= 7; j++)\n        {\n            if(j==0)\n            {\n                exportString += \"| \";    \n            }\n            \n            tempString = boardPositions[i*8+j].name;\n            if (tempString == \"Empty_Slot\")\n            {\n                exportString += \"------------\";\n            }\n            else\n            {\n                if(tempString.split(\"_\")[1] == \"Queen\")\n                {\n                    exportString += tempString + \" \";\n                }\n                else if(tempString.split(\"_\")[1] != \"Knight\" || tempString.split(\"_\")[1] != \"Bishop\")\n                {\n                    exportString += \" \" + tempString + \" \";\n                }\n            }\n            exportString += \" | \";\n        }\n        exportString += \"\\n\";\n    }\n    return exportString;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1450,"y":60,"wires":[["3549230b.7da21c"]]},{"id":"9b557a1f.627e58","type":"function","z":"ee39c607.e74858","name":"Dashboard ","func":"var message = msg.payload;\n\nglobal.set(\"resetTime\", message);\n\nvar newMsg1 = { payload: global.get(\"gameEnded\") == true ? \"FINISHED\" : \"PLAYING\", topic: \"Dashboard\"};\nvar newMsg2 = {payload: CalculateTime(), topic: \"Dashboard\"};\nvar newMsg3 = {payload:global.get(\"halfMoveClock\"), topic: \"Dashboard\"};\nvar newMsg4 = {payload:global.get(\"fullMoveClock\"), topic: \"Dashboard\"};\nvar newMsg5 = {payload: global.get(\"currentPlayer\") == \"w\" ? \"White\" : \"Black\", topic: \"Dashboard\"};\nvar newMsg6 = {payload:global.get(\"currentMove\"), topic: \"Dashboard\"};\nvar newMsg7 = {payload:global.get(\"currentMoveType\"), topic: \"Dashboard\"};\nvar newMsg8 = {payload:global.get(\"whiteDeathCounter\"), topic: \"Dashboard\"};\nvar newMsg9 = {payload:global.get(\"blackDeathCounter\"), topic: \"Dashboard\"};\nvar newMsg10 = {payload:global.get(\"enPassant\"), topic: \"Dashboard\"};\nvar newMsg11 = {payload:CalculateCastlingString(), topic: \"Dashboard\"};\nvar newMsg12 = {payload:global.get(\"winner\"), topic: \"Dashboard\"};\nvar newMsg13 = {payload:global.get(\"detectionStatus\"), topic: \"Dashboard\"};\nvar newMsg14 = {payload:global.get(\"stockfishStatus\"), topic: \"Dashboard\"};\nvar newMsg15 = {payload:global.get(\"detectedFEN\"), topic: \"Dashboard\"};\nvar newMsg16 = {payload:global.get(\"expectedFEN\"), topic: \"Dashboard\"};\nvar newMsg17 = {payload:global.get(\"RMQCommand\"), topic: \"Dashboard\"};\nvar newMsg18 = {payload:global.get(\"moveHistory\"), topic: \"Dashboard\"};\nvar newMsg19 = {payload:global.get(\"chatHistory\"), topic: \"Dashboard\"};\nvar newMsg20 = {payload:global.get(\"expectedBoardPositions\"), topic: \"DashBoard\"};\nvar newMsg21 = {payload:global.get(\"scoreCP\"), topic: global.get(\"moveNumber\")};\n\nreturn [newMsg1, newMsg2, newMsg3, newMsg4, newMsg5, newMsg6,\n        newMsg7, newMsg8, newMsg9, newMsg10, newMsg11, newMsg12,\n        null, newMsg14, newMsg15, newMsg16, newMsg17, newMsg18,\n        newMsg19, newMsg20, newMsg21];\n\n        \nfunction CalculateCastlingString()\n{\n    var output =\"\";\n    if((global.get(\"castlingRook\")[0] == true && global.get(\"castlingKing\")[0] == true) ||\n        (global.get(\"castlingRook\")[2] == true && global.get(\"castlingKing\")[0] == true))\n    {\n        output += \"White: YES / \";\n    }\n    else\n    {\n        output += \"White: NO / \";    \n    }\n    if((global.get(\"castlingRook\")[1] == true && global.get(\"castlingKing\")[1] == true) ||\n        (global.get(\"castlingRook\")[3] == true && global.get(\"castlingKing\")[1] == true))\n    {\n        output += \"Black: YES\";\n    }\n    else\n    {\n        output += \"Black: NO\";\n    }\n    return output;\n}\n\nfunction CalculateTime()\n{\n    var time = \"\";\n    time += (Math.round(((message - global.get(\"timeStart\")) / 1000 / 3600))).toString();\n    time += \"h \" + (Math.round(((message - global.get(\"timeStart\")) / 1000) / 60)).toString();\n    time += \"m \" + (Math.round(((message - global.get(\"timeStart\")) / 1000) % 60)).toString() + \"s\";\n    return time;\n}","outputs":21,"noerr":0,"initialize":"","finalize":"","libs":[],"x":170,"y":720,"wires":[["c67d48ed.d301a8"],["66589fca.8c8fc"],["ed33649a.4093c8"],["8d7c7b69.e7d028"],["985ff366.8b352"],["f4a4e103.9bf3f"],["be4eb7a5.acd848"],["b377c5f3.87f448"],["206cd05b.8adca"],["5df89f9e.698ec"],["caae836e.ab366"],["b0386c4f.2c3dd"],["cc11c76d.421888"],["c7582e1.abba3d"],["c0363800.e40538"],["2716add7.83cb92"],["a7388c80.899d"],["fe8ba303.28f66"],["4ecf10ea.362d2"],["42efd9a9.8f2878"],["b83cd29a.e308f"]]},{"id":"8d7c7b69.e7d028","type":"ui_text","z":"ee39c607.e74858","group":"1d1b44d7.c6cceb","order":2,"width":0,"height":0,"name":"","label":"Full move clock","format":"{{msg.payload}}","layout":"row-spread","x":420,"y":660,"wires":[]},{"id":"54489a85.6ed8e4","type":"inject","z":"ee39c607.e74858","name":"Dashboard update","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"time","payload":"","payloadType":"date","x":160,"y":540,"wires":[["9b557a1f.627e58"]]},{"id":"d6e9301f.e491c","type":"inject","z":"ee39c607.e74858","name":"Start time","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0","topic":"time","payload":"","payloadType":"date","x":400,"y":60,"wires":[["e86bc781.c58dd8"]]},{"id":"66589fca.8c8fc","type":"ui_text","z":"ee39c607.e74858","group":"1d1b44d7.c6cceb","order":3,"width":0,"height":0,"name":"Time passed","label":"Game duration:","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":580,"wires":[]},{"id":"c67d48ed.d301a8","type":"ui_text","z":"ee39c607.e74858","group":"1d1b44d7.c6cceb","order":4,"width":0,"height":0,"name":"","label":"Game status","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":540,"wires":[]},{"id":"ed33649a.4093c8","type":"ui_text","z":"ee39c607.e74858","group":"1d1b44d7.c6cceb","order":5,"width":0,"height":0,"name":"","label":"Half move clock","format":"{{msg.payload}}","layout":"row-spread","x":420,"y":620,"wires":[]},{"id":"985ff366.8b352","type":"ui_text","z":"ee39c607.e74858","group":"4b37ccc0.9ce014","order":2,"width":0,"height":0,"name":"Current Player","label":"Current Player","format":"{{msg.payload}}","layout":"row-spread","x":420,"y":700,"wires":[]},{"id":"f4a4e103.9bf3f","type":"ui_text","z":"ee39c607.e74858","group":"4b37ccc0.9ce014","order":3,"width":0,"height":0,"name":"Current move","label":"Current move","format":"{{msg.payload}}","layout":"row-spread","x":420,"y":740,"wires":[]},{"id":"be4eb7a5.acd848","type":"ui_text","z":"ee39c607.e74858","group":"4b37ccc0.9ce014","order":4,"width":0,"height":0,"name":"Move type","label":"Move type","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":780,"wires":[]},{"id":"b377c5f3.87f448","type":"ui_gauge","z":"ee39c607.e74858","name":"Dead white figures","group":"3799b03a.18375","order":7,"width":"6","height":"5","gtype":"gage","title":"Dead white figures","label":"figures","format":"{{value}}","min":0,"max":"15","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":430,"y":820,"wires":[]},{"id":"206cd05b.8adca","type":"ui_gauge","z":"ee39c607.e74858","name":"Dead black figures","group":"3799b03a.18375","order":8,"width":"6","height":"5","gtype":"gage","title":"Dead black figures","label":"figures","format":"{{value}}","min":0,"max":"15","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":430,"y":860,"wires":[]},{"id":"5df89f9e.698ec","type":"ui_text","z":"ee39c607.e74858","group":"4b37ccc0.9ce014","order":5,"width":0,"height":0,"name":"En Passant","label":"En Passant location","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":900,"wires":[]},{"id":"caae836e.ab366","type":"ui_text","z":"ee39c607.e74858","group":"4b37ccc0.9ce014","order":6,"width":"0","height":"0","name":"Castling ability","label":"Castling ability: ","format":"{{msg.payload}}","layout":"row-spread","x":620,"y":540,"wires":[]},{"id":"b0386c4f.2c3dd","type":"ui_text","z":"ee39c607.e74858","group":"1d1b44d7.c6cceb","order":6,"width":0,"height":0,"name":"Winner","label":"Winner","format":"{{msg.payload}}","layout":"row-spread","x":600,"y":580,"wires":[]},{"id":"cc11c76d.421888","type":"ui_text","z":"ee39c607.e74858","d":true,"group":"912a314d.fa5d5","order":2,"width":0,"height":0,"name":"Detection status","label":"Detection status","format":"{{msg.payload}}","layout":"row-spread","x":620,"y":620,"wires":[]},{"id":"c7582e1.abba3d","type":"ui_text","z":"ee39c607.e74858","group":"912a314d.fa5d5","order":3,"width":0,"height":0,"name":"Stockfish status","label":"Stockfish status","format":"{{msg.payload}}","layout":"row-spread","x":620,"y":660,"wires":[]},{"id":"c0363800.e40538","type":"ui_text","z":"ee39c607.e74858","group":"912a314d.fa5d5","order":4,"width":0,"height":0,"name":"Detected FEN","label":"Detected FEN","format":"{{msg.payload}}","layout":"row-spread","x":620,"y":700,"wires":[]},{"id":"2716add7.83cb92","type":"ui_text","z":"ee39c607.e74858","group":"912a314d.fa5d5","order":5,"width":0,"height":0,"name":"Expected FEN","label":"Expected FEN","format":"{{msg.payload}}","layout":"row-spread","x":620,"y":740,"wires":[]},{"id":"a7388c80.899d","type":"ui_text","z":"ee39c607.e74858","d":true,"group":"912a314d.fa5d5","order":6,"width":"0","height":"0","name":"RMQ command","label":"RMQ command","format":"{{msg.payload}}","layout":"row-spread","x":620,"y":780,"wires":[]},{"id":"4e5f10a.923acf","type":"ui_switch","z":"ee39c607.e74858","d":true,"name":"Play/Pause","label":"Play/Pause","tooltip":"","group":"cacd5ff7.bb2ba","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"play/pause","topicType":"msg","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":false,"x":110,"y":140,"wires":[["a427057.4fac8f8"]]},{"id":"166af16c.594f1f","type":"ui_button","z":"ee39c607.e74858","d":true,"name":"Next Move","group":"cacd5ff7.bb2ba","order":3,"width":0,"height":0,"passthru":false,"label":"Next Move","tooltip":"","color":"","bgcolor":"","icon":"","payload":"OCELLUS_CONTINUE","payloadType":"str","topic":"OCELLUS_CONTINUE","topicType":"msg","x":110,"y":180,"wires":[["bc47328c.c7254","47d36255.70333c"]]},{"id":"3ed61259.7360de","type":"ui_button","z":"ee39c607.e74858","d":true,"name":"Reset Game","group":"cacd5ff7.bb2ba","order":4,"width":0,"height":0,"passthru":false,"label":"Reset Game","tooltip":"","color":"","bgcolor":"","icon":"","payload":"RESET","payloadType":"str","topic":"resetGame","topicType":"msg","x":110,"y":220,"wires":[["755a2dc4.ee0da4"]]},{"id":"bc47328c.c7254","type":"debug","z":"ee39c607.e74858","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":330,"y":180,"wires":[]},{"id":"a427057.4fac8f8","type":"function","z":"ee39c607.e74858","d":true,"name":"Set play/pause","func":"var message = msg.payload;\n\nglobal.set(\"playPause\", message);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":140,"wires":[[]]},{"id":"755a2dc4.ee0da4","type":"function","z":"ee39c607.e74858","d":true,"name":"Reset game","func":"global.set(\"expectedBoardPositions\", global.get(\"resetBoardPositions\"));\nglobal.set(\"timeStart\", global.get(\"resetTime\"));\nglobal.set(\"fullMoveClock\", 1);\nglobal.set(\"halfMoveClock\", 0);\nglobal.set(\"gameEnded\", false);\nglobal.set(\"whiteDeathCounter\", 0);\nglobal.set(\"blackDeathCounter\", 0);\nglobal.set(\"currentPlayer\", \"w\");\nglobal.set(\"currentMove\", \"-\");\nglobal.set(\"currentMoveType\", \"-\");\nglobal.set(\"enPassant\", \"-\");\nglobal.set(\"castlingRook\", [true,true,true,true]);\nglobal.set(\"castlingKing\", [true,true]);\nglobal.set(\"winner\", \"Unknown\");\nglobal.set(\"detectionStatus\", \"OK\");\nglobal.set(\"stockfishStatus\", \"IDLE\");\nglobal.set(\"expectedFEN\", \"-\");\nglobal.set(\"detectedFEN\", \"-\");\nglobal.set(\"RMQCommand\", \"-\");\n\n\n// !! !! UPDATEAT !! !! UPDATE YES","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":220,"wires":[[]]},{"id":"fe8ba303.28f66","type":"ui_table","z":"ee39c607.e74858","group":"7201c742.f8cbc8","name":"Move history list","order":20,"width":"19","height":"12","columns":[{"field":"Move number","title":"Move number","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"Player","title":"Player","width":"","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"Move type","title":"Move type","width":"","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"Figure 1","title":"Figure 1","width":"","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"Figure 2","title":"Figure 2","width":"","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"Move positions","title":"Move positions","width":"","align":"center","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":620,"y":820,"wires":[]},{"id":"44a3499f.a061c8","type":"ui_audio","z":"ee39c607.e74858","name":"Chat audio player","group":"620826c0.bc6a08","voice":"","always":"","x":1870,"y":540,"wires":[]},{"id":"3ee33b0a.5835e4","type":"file in","z":"ee39c607.e74858","name":"Chat sound loader","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":1670,"y":540,"wires":[["44a3499f.a061c8"]]},{"id":"4ecf10ea.362d2","type":"ui_table","z":"ee39c607.e74858","d":true,"group":"8585515b.c4b6d","name":"Chat history list","order":23,"width":"14","height":"12","columns":[{"field":"Player name","title":"Player name","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"Message","title":"Message","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":620,"y":860,"wires":[]},{"id":"9a5d63a1.5de","type":"function","z":"ee39c607.e74858","d":true,"name":"Chat history handler","func":"if(global.get(\"gameEnded\")==false)\n{\n    if(GetRandomNumber(0,10) <= 3)\n    {\n        var messageNumber = global.get(\"currentPlayer\") == \"w\" ? GetRandomNumber(0,50) :  GetRandomNumber(51,100);\n        var message = global.get(\"chatMessages\");\n        \n        var chatList = global.get(\"chatHistory\");\n        chatList.push({\"Player name\" : \"Chesster\", \"Message\" : message[messageNumber]});\n        global.set(\"chatHistory\", chatList);\n        \n        var newMsg = { payload: messageNumber, topic: \"Best move\"};\n        return newMsg;\n    }\n}\nfunction GetRandomNumber(min, max) {\n    return Math.round(Math.random() * (max - min) + min);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1240,"y":540,"wires":[["f7f81c46.dc12a"]]},{"id":"f7f81c46.dc12a","type":"function","z":"ee39c607.e74858","name":"Chat sound preparator","func":"var payload = msg.payload+1;\nvar string = \"/assets/\" + payload +\" chat message.mp3\";\nvar newMsg = { filename : string, topic: \"Chat sound\"};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1460,"y":540,"wires":[["3ee33b0a.5835e4"]]},{"id":"47d36255.70333c","type":"function","z":"ee39c607.e74858","name":"Detection busy","func":"global.set(\"detectionStatus\", \"BUSY\");\nreturn msg;    ","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":100,"wires":[["237afbdc.f4a834"]]},{"id":"185e231c.c2639d","type":"comment","z":"ee39c607.e74858","name":"AutoCHESS powered by Ocellus","info":"","x":170,"y":60,"wires":[]},{"id":"b83cd29a.e308f","type":"ui_chart","z":"ee39c607.e74858","d":true,"name":"Game stats","group":"c2823568.7aa0e8","order":0,"width":"14","height":"12","label":"(+) White player vs  (-) Black player","chartType":"bar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":true,"useUTC":false,"colors":["#37cde6","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":610,"y":900,"wires":[[]]},{"id":"dc52038a.99947","type":"ui_slider","z":"ee39c607.e74858","d":true,"name":"Detection precision","label":"Detection precision","tooltip":"Number of detection cycles","group":"cacd5ff7.bb2ba","order":5,"width":0,"height":0,"passthru":true,"outs":"end","topic":"precision","topicType":"msg","min":"1","max":10,"step":1,"x":810,"y":540,"wires":[["ba3821f8.ff742"]]},{"id":"ba3821f8.ff742","type":"function","z":"ee39c607.e74858","d":true,"name":"Detection precision set","func":"global.set(\"detectionPrecision\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":820,"y":580,"wires":[[]]},{"id":"363fa7a.c792958","type":"debug","z":"ee39c607.e74858","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1270,"y":60,"wires":[]},{"id":"c808b9b8.d44288","type":"function","z":"ee39c607.e74858","name":"Move Finder","func":"var msgPayload = msg.payload;\nif(msgPayload != \"DETECTION ERROR\" && global.get(\"humanFlag\") == true)\n{\n    var newMsg = {payload: MoveFinder(global.get(\"expectedFEN\"), msgPayload), topic: \"Detected move\"};\n    return newMsg;    \n}\n\nfunction MoveFinder(previousFEN, currentFEN)\n{\n    var moveInformation = FindChessPositions(previousFEN, currentFEN);\n    return moveInformation;\n}\n\nfunction FindChessPositions(previousFEN, currentFEN)\n{\n    var start = \"\";\n    var finish = \"\";\n    var moveType = \"\";\n    var moveFigure1 = \"\";\n    var moveFigure2 = \"\";\n\n    var previousSegments = previousFEN.toString().split(' ')[0].split(\"/\");\n    var currentSegments = currentFEN.toString().split(' ')[0].split(\"/\");\n\n    var difference = GetDifference(previousSegments, currentSegments);\n    //return [difference];\n    \n    if (difference.length != 0)\n    {\n        for(var i = 0; i < difference.length; i++)\n        {\n            // empty move | attack move\n            if (difference.length == 2 && difference[0][0] === difference[1][0])\n            {\n                moveFigure1 = FindFigure(difference[0][0]);\n                if(SumArray(previousFEN.toString().split(' ')[0].split(\"\")) === SumArray(currentFEN.toString().split(' ')[0].split(\"\")))\n                {\n                    moveType = \"Empty move\";\n                    moveFigure2 = \"Empty slot\";\n                }\n                else\n                {\n                    moveType = \"Attack move\";\n                    global.set(\"blackDeathCounter\", global.get(\"blackDeathCounter\")+1);\n                }\n\n                if(difference[i][3] == \"previous\")\n                {\n                    start = CalculateChessPosition(difference[i][1], difference[i][2]);\n                }\n                else\n                {\n                    finish = CalculateChessPosition(difference[i][1], difference[i][2]);\n                    moveFigure2 = global.get(\"expectedBoardPositions\")[difference[i][1] + (8 - difference[i][2] - 1) * 8];\n                }\n            }\n            // castling\n            if(difference.length == 4)\n            {\n                if(difference[i][0].toUpperCase() == \"K\" && difference[i][3] == \"previous\")\n                {\n                    start = CalculateChessPosition(difference[i][1], difference[i][2]);\n                }\n                else if(difference[i][0].toUpperCase() == \"K\" && difference[i][3] == \"current\")\n                {\n                    finish = CalculateChessPosition(difference[i][1], difference[i][2]);\n                }\n\n                if (start + finish == \"E1C1\" &&  difference[i][0] == \"K\")\n                {\n                    moveType = \"Castling Queenside\";\n                    moveFigure1 = FindFigure(\"K\");\n                    moveFigure2 = FindFigure(\"R\");\n                }\n                else if (start + finish == \"E1G1\" && difference[i][0] == \"K\")\n                {\n                    moveType = \"Castling Kingside\";\n                    moveFigure1 = FindFigure(\"K\");\n                    moveFigure2 = FindFigure(\"R\");\n                }\n                else if (start + finish == \"E8C8\" && difference[i][0] == \"k\")\n                {\n                    moveType = \"Castling Queenside\";\n                    moveFigure1 = FindFigure(\"k\");\n                    moveFigure2 = FindFigure(\"r\");\n                }\n                else if (start + finish == \"E8G8\" && moveInformation[1] == \"k\")\n                {\n                    moveType = \"Castling Kingside\";\n                    moveFigure1 = FindFigure(\"k\");\n                    moveFigure2 = FindFigure(\"r\");\n                }\n            }\n            // Pawn promotion\n            if (difference.length == 2 && difference[0][0] != difference[1][0])\n            {\n                if(difference[i][0].toUpperCase() == \"P\" && difference[i][3] == \"previous\")\n                {\n                    start = CalculateChessPosition(difference[i][1], difference[i][2]);\n                    moveFigure1 = FindFigure(difference[i][0]);\n                }\n                else if(difference[i][0].toUpperCase() == \"Q\" && difference[i][3] == \"current\")\n                {\n                    finish = CalculateChessPosition(difference[i][1], difference[i][2]) + \"q\";\n                    moveFigure2 = FindFigure(difference[i][0]);\n                }\n                if((start.split(\"\")[1]== 7 || start.split(\"\")[1]==2) && (finish.split(\"\")[1]==8 || finish.split(\"\")[1]==1) &&\n                    difference[i][0].toUpperCase() == \"P\")\n                {\n                    moveType = \"Pawn promotion\";\n                }\n            }\n            // En passant\n            if (difference.length == 3)\n            {\n                var temp = 0;\n                var pCount = 0;\n                var PCount = 0;\n                temp = difference[0][0] == \"p\" ? pCount+=1 : PCount+=1;\n                temp = difference[1][0] == \"p\" ? pCount+=1 : PCount+=1;\n                temp = difference[2][0] == \"p\" ? pCount+=1 : PCount+=1;\n                if(pCount+PCount == 3)\n                {\n                    moveType = \"En passant\";    \n                }\n                if(pCount > PCount)\n                {\n                    if(difference[i][0] == \"p\" && difference[i][3] == \"previous\")\n                    {\n                        start = CalculateChessPosition(difference[i][1], difference[i][2]);\n                    }\n                    else if(difference[i][0] == \"p\" && difference[i][3] == \"current\")\n                    {\n                        finish = CalculateChessPosition(difference[i][1], difference[i][2]);\n                    }\n                    moveFigure1 = FindFigure(\"p\");\n                    moveFigure2 = FindFigure(\"P\");\n                }\n                else\n                {\n                    if(difference[i][0] == \"P\" && difference[i][3] == \"previous\")\n                    {\n                        start = CalculateChessPosition(difference[i][1], difference[i][2]);\n                    }\n                    else if(difference[i][0] == \"P\" && difference[i][3] == \"current\")\n                    {\n                        finish = CalculateChessPosition(difference[i][1], difference[i][2]);\n                    }\n                    moveFigure1 = FindFigure(\"P\");\n                    moveFigure2 = FindFigure(\"p\");\n                }\n            }\n        }\n        if(start != \"\" && finish != \"\")\n        {\n            return [(start + finish).toLowerCase(), moveType];\n        }\n        else\n        {\n           return [\"ERROR2\"];\n        }\n    }\n    return [\"ERROR1\"];\n}\n\nfunction GetDifference(previousSegments, currentSegments)\n{\n    var differences = [];\n    \n    for (var z = 0; z < previousSegments.length; z++)\n    {\n       var i = 0;\n       var j = 0;\n       var a = previousSegments[z];\n       var b = currentSegments[z];\n       for(var x=0; x < a.length; x++)\n       {\n            if(isCharNumber(a[x]))\n            {\n                a = SwapChar(a, \"-\", x, parseInt(a[x]));\n            }\n       }\n       for(x = 0; x < b.length; x++)\n       {\n            if(isCharNumber(b[x]))\n            {\n                b = SwapChar(b, \"-\", x, parseInt(b[x]));\n            }\n       }        \n        while (j < b.length)\n        {\n            if(a[i] != \"-\" || b[j] != \"-\")\n            {\n                if (a[i] != b[j] || i == a.length)\n                {\n                    if(a[i] != \"-\" && b[j] == \"-\")\n                    {\n                        differences.push([a[i], i, z, \"previous\"]);\n                    }\n                    else if(a[i] == \"-\" && b[j] != \"-\")\n                    {\n                        differences.push([b[j], j, z, \"current\"]);\n                    }\n                    else\n                    {\n                        differences.push([b[j], j, z, \"current\"]);\n                    }\n                }\n            }\n            i++;\n            j++;\n        }\n    }\n    if(differences.length != 0)\n    {\n        return differences;\n    }\n    else\n   {\n      return [];\n   }\n}\n\nfunction FindFigure(character)\n{\n    switch (character)\n    {\n        case \"R\":\n            return \"White Rook\";\n        case \"N\":\n            return \"White Knight\";\n        case \"B\":\n            return \"White Bishop\";\n        case \"K\":\n            return \"White King\";\n        case \"Q\":\n            return \"White Queen\";\n        case \"P\":\n            return \"White Pawn\";\n        case \"r\":\n            return \"Black Rook\";\n        case \"n\":\n            return \"Black Knight\";\n        case \"b\":\n            return \"Black Bishop\";\n        case \"k\":\n            return \"Black King\";\n        case \"q\":\n            return \"Black Queen\";\n        case \"p\":\n            return \"Black Pawn\";\n    }\n}\n\nfunction CalculateChessPosition(column, row)\n{\n    return CalculateColumn(column) + (8 - row).toString();\n}\n\nfunction CalculateColumn(number)\n{\n    switch (number)\n    {\n        case 0:\n            return \"A\";\n        case 1:\n            return \"B\";\n        case 2:\n            return \"C\";\n        case 3:\n            return \"D\";\n        case 4:\n            return \"E\";\n        case 5:\n            return \"F\";\n        case 6:\n            return \"G\";\n        case 7:\n            return \"H\";\n    }\n}\n\nfunction CalculateReverseColumn(letter)\n{\n    switch (letter)\n    {\n        case \"A\":\n            return 1;\n        case \"B\":\n            return 2;\n        case \"C\":\n            return 3;\n        case \"D\":\n            return 4;\n        case \"E\":\n            return 5;\n        case \"F\":\n            return 6;\n        case \"G\":\n            return 7;\n        case \"H\":\n            return 8;\n    }\n}\n\nfunction SwapChar(string, char, position, length)\n{\n    var segment = string.substring(0, position) + string.substring(position+1);\n    for(var i = 0;i < length ;i++)\n    {\n        segment = segment.substring(0, position) + char + segment.substring(position);\n    }\n    return segment;\n}\n\n\nfunction isCharNumber(value)\n{\n    return value >= '0' && value <= '9';\n}\n\nfunction SumArray(array)\n{\n    var sum = 0;\n    for (var i = 0; i < array.length; i++)\n    {\n        if (isCharNumber(array[i]))\n        {\n            sum += parseInt(array[i]);\n        }\n    }\n    return sum;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":360,"wires":[["e709c362.cd452","f49680bb.c9b2"]]},{"id":"e709c362.cd452","type":"debug","z":"ee39c607.e74858","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":380,"wires":[]},{"id":"3e12c1.beaaad4","type":"debug","z":"ee39c607.e74858","name":"Human player","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1840,"y":180,"wires":[]},{"id":"375984d6.3579ec","type":"function","z":"ee39c607.e74858","name":"ABB RMQ Creation V2","func":"if(global.get(\"gameEnded\") == false)\n{\n    var incomingPayload = msg.payload;\n    var startPosition = new Array(incomingPayload[2][0], incomingPayload[2][1]);\n    var finishPosition = new Array(incomingPayload[3][0], incomingPayload[3][1]);\n    var originString = \"\";\n    var destinationString = \"\";\n    var robotString = \"\";\n    var row = 0;\n    var robotMessageList = [];\n    \n    var figureStart = global.get(\"expectedBoardPositions\")[GetLocation(startPosition)];\n    var figureFinish = global.get(\"expectedBoardPositions\")[GetLocation(finishPosition)];\n    \n    if(incomingPayload[0] !== \"(none)\")\n    {\n        switch(incomingPayload[1])\n        {\n            case \"EmptyMove\":\n                originString = String(startPosition[0] + startPosition[1]);\n                destinationString = String(finishPosition[0] + finishPosition[1]);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                break;\n            case \"AttackMove\":\n                originString = String(finishPosition[0] + finishPosition[1]);\n                destinationString = CalculateGraveyardPosition(\"w\", figureStart, figureFinish)\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                \n                originString = String(startPosition[0] + startPosition[1]);\n                destinationString = String(finishPosition[0] + finishPosition[1]);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                break;\n            case \"Castling_Queenside\":\n                row = global.get(\"currentPlayer\") == \"b\" ? 1 : 8;\n                \n                originString = String(startPosition[0] + startPosition[1]);\n                destinationString = String(finishPosition[0] + finishPosition[1]);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                \n                originString = \"A\" + String(row);\n                destinationString = \"D\" + String(row);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                break;\n            case \"Castling_Kingside\":\n                row = global.get(\"currentPlayer\") == \"b\" ? 1 : 8;\n                \n                originString = String(startPosition[0] + startPosition[1]);\n                destinationString = String(finishPosition[0] + finishPosition[1]);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                \n                originString = \"H\" + String(row);\n                destinationString = \"F\" + String(row);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                break;\n            case \"EnPassant\":\n                var killedFigure = String(finishPosition[0]) + String(startPosition[1]);\n                \n                originString = String(startPosition[0] + startPosition[1]);\n                destinationString = String(finishPosition[0] + finishPosition[1]);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                \n                originString = killedFigure;\n                destinationString = CalculateGraveyardPosition(\"w\",figureStart,figureFinish);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                break;\n            case \"PawnPromotion\":\n                originString = String(startPosition[0] + startPosition[1]);\n                destinationString = String(finishPosition[0] + finishPosition[1]);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                \n                originString = String(finishPosition[0] + finishPosition[1]);\n                destinationString = CalculateGraveyardPosition(\"w\", figureStart,figureFinish);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                \n                originString = CalculateGraveyardPosition(\"w\", figureStart,figureFinish);\n                destinationString = String(finishPosition[0] + finishPosition[1]);\n                robotString = CalculateRobotArm(originString);\n                robotMessageList.push(CreateMoveObject(originString, destinationString, robotString));\n                break;\n        }\n    }\n    return {payload : robotMessageList};\n}\n\nfunction CreateMoveObject(originString, destinationString, robotString)\n{\n    var msg = {origin: originString, destination : destinationString, robot : robotString};\n    return msg;\n}\n\nfunction CalculateRobotArm(origin)\n{\n    var leftLocations = [\"Y\",\"Z\",\"A\",\"B\",\"C\",\"D\"];\n    var rightLocations = [\"E\",\"F\",\"G\",\"H\",\"I\",\"J\"];\n    var column = origin.split(\"\")[0];\n    if(leftLocations.includes(column))\n    {\n        return \"T_ROB_R\";\n    }\n    else\n    {\n        return \"T_ROB_L\";\n    }\n}\n\nfunction CalculateGraveyardPosition(team, figure1, figure2)\n{\n    var horizontalPositions = [\"I\", \"J\"];\n    var startingVerticalPosition = 1;\n    var increment = 0;\n    var horizontal = 0;\n    var vertical = global.get(\"whiteVerticalGraveyardPosition\");\n    var counter = global.get(\"whiteDeathCounter\");\n    \n    if(vertical == 7)\n    {\n        increment = 1;\n    }\n    else\n    {\n        increment = vertical+1;\n    }\n    \n    global.set(\"whiteVerticalGraveyardPosition\", increment);\n    counter++;\n    global.set(\"whiteDeathCounter\", counter);\n    \n    if(counter / 7 == 0)\n    {\n        horizontal = 0;\n    }\n    else\n    {\n        horizontal = 1;\n    }\n\n    return (String(horizontalPositions[horizontal]) + (startingVerticalPosition * vertical).toString());\n}\n\n\n\nfunction GetLocation(position)\n{\n    return ((position[1] - 1)* 8 + (ChessColumn(position[0]) - 1));\n}\n\nfunction ChessColumn(letter)\n{\n switch (letter)\n    {\n        case \"A\":\n            return 1;\n        case \"B\":\n            return 2;\n        case \"C\":\n            return 3;\n        case \"D\":\n            return 4;\n        case \"E\":\n            return 5;\n        case \"F\":\n            return 6;\n        case \"G\":\n            return 7;\n        case \"H\":\n            return 8;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1460,"y":380,"wires":[["a0b59504.e48db8","f1bee362.324e98"]]},{"id":"f9ef357a.448238","type":"q-gate","z":"20360fb.e015af","name":"","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"storeName":"memory","x":710,"y":1560,"wires":[["56259652.84c388"]]},{"id":"56259652.84c388","type":"debug","z":"20360fb.e015af","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":900,"y":1560,"wires":[]},{"id":"20ed9fe4.be261","type":"change","z":"20360fb.e015af","name":"trigger","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"trigger","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":1580,"wires":[["f9ef357a.448238","ed178426.36de88"]]},{"id":"87758be3.f3fce8","type":"change","z":"20360fb.e015af","name":"Enqueue","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1540,"wires":[["f9ef357a.448238"]]},{"id":"357a7d26.8efb12","type":"inject","z":"20360fb.e015af","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":370,"y":1580,"wires":[["20ed9fe4.be261"]]},{"id":"95b2a4f3.de6828","type":"inject","z":"20360fb.e015af","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":370,"y":1540,"wires":[["87758be3.f3fce8"]]},{"id":"ed178426.36de88","type":"debug","z":"20360fb.e015af","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":690,"y":1660,"wires":[]},{"id":"4c4aafd6.00e4f","type":"change","z":"20360fb.e015af","name":"trigger","rules":[{"t":"set","p":"topic","pt":"msg","to":"Control Topic","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"peek","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":1620,"wires":[["f9ef357a.448238","ed178426.36de88"]]},{"id":"30bc0174.c92e0e","type":"inject","z":"20360fb.e015af","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":370,"y":1620,"wires":[["4c4aafd6.00e4f"]]},{"id":"a46ee04e.b1a9b8","type":"inject","z":"20360fb.e015af","name":"open","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"OPEN","payloadType":"str","x":830,"y":720,"wires":[["c54e919c.18d7f"]]},{"id":"c54e919c.18d7f","type":"q-gate","z":"20360fb.e015af","name":"q-gate demo","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":1070,"y":940,"wires":[["d2740316.7035c"]]},{"id":"c04db5ad.da76b8","type":"inject","z":"20360fb.e015af","name":"input","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":790,"y":940,"wires":[["c54e919c.18d7f"]]},{"id":"287fae2e.cb245a","type":"inject","z":"20360fb.e015af","name":"toggle","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"toggle","payloadType":"str","x":830,"y":800,"wires":[["c54e919c.18d7f"]]},{"id":"8fd8943b.e60c28","type":"inject","z":"20360fb.e015af","name":"close","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"close","payloadType":"str","x":830,"y":760,"wires":[["c54e919c.18d7f"]]},{"id":"44541499.4ac23c","type":"inject","z":"20360fb.e015af","name":"default","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"default","payloadType":"str","x":830,"y":840,"wires":[["c54e919c.18d7f"]]},{"id":"92b01a9d.669a58","type":"inject","z":"20360fb.e015af","name":"queue","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"queue","payloadType":"str","x":830,"y":1000,"wires":[["c54e919c.18d7f"]]},{"id":"5f8708d.abc59f8","type":"inject","z":"20360fb.e015af","name":"flush","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"flush","payloadType":"str","x":830,"y":1080,"wires":[["c54e919c.18d7f"]]},{"id":"fb8c7d0f.40eec","type":"inject","z":"20360fb.e015af","name":"trigger","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"trigger","payloadType":"str","x":830,"y":1040,"wires":[["c54e919c.18d7f"]]},{"id":"b7688480.6338","type":"inject","z":"20360fb.e015af","name":"reset","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"reset","payloadType":"str","x":830,"y":1120,"wires":[["c54e919c.18d7f"]]},{"id":"44127021.988758","type":"inject","z":"20360fb.e015af","name":"peek","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"peek","payloadType":"str","x":830,"y":1160,"wires":[["c54e919c.18d7f"]]},{"id":"cc39c2df.44d0b8","type":"inject","z":"20360fb.e015af","name":"drop","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"drop","payloadType":"str","x":830,"y":1200,"wires":[["c54e919c.18d7f"]]},{"id":"a94f3db7.55ae18","type":"inject","z":"20360fb.e015af","name":"status","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"status","payloadType":"str","x":830,"y":880,"wires":[["c54e919c.18d7f"]]},{"id":"d2740316.7035c","type":"debug","z":"20360fb.e015af","name":"output","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1230,"y":940,"wires":[]},{"id":"ae120d0f.ade318","type":"status","z":"20360fb.e015af","name":"q-gate status","scope":["c54e919c.18d7f"],"x":1070,"y":1000,"wires":[["ea4d90f9.61a5b"]]},{"id":"ea4d90f9.61a5b","type":"debug","z":"20360fb.e015af","name":"status text","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"status.text","targetType":"msg","statusVal":"","statusType":"auto","x":1230,"y":1000,"wires":[]},{"id":"86186e66.b8607","type":"abb-robot-rmq","z":"20360fb.e015af","name":"ABB Robot RMQ 2","sourceQueue":"RMQ_CARROT","configRef":"505dee9d.0ca44","x":1410,"y":140,"wires":[["2f8e5284.681d2e"]]},{"id":"47ce011d.1f475","type":"debug","z":"20360fb.e015af","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1770,"y":420,"wires":[]},{"id":"169f837e.ac3b1d","type":"comment","z":"20360fb.e015af","name":"Send RMQ command to robot","info":"","x":1820,"y":740,"wires":[]},{"id":"c736ec37.eb856","type":"debug","z":"20360fb.e015af","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1770,"y":380,"wires":[]},{"id":"080e55265518841a","type":"subflow:7fe2370ff54129e9","z":"d4cb3f70d0c4b27a","name":"","env":[{"name":"subscription","type":"bool","value":"true"},{"name":"configId","value":"configId","type":"env"}],"x":140,"y":160,"wires":[["a12a47d36e80a3f3"]]},{"id":"9a05e7de0807ddfb","type":"subflow:1c8b3f7678bc98b1","z":"d4cb3f70d0c4b27a","name":"","env":[{"name":"subscription","type":"bool","value":"true"},{"name":"configId","value":"configId","type":"env"}],"x":130,"y":120,"wires":[["d2fec027be15804e"]]},{"id":"80e34f9593b427b8","type":"subflow:d37ce6f5.a566d8","z":"d4cb3f70d0c4b27a","name":"","env":[{"name":"subscription","type":"bool","value":"true"},{"name":"configId","value":"configId","type":"env"},{"name":"motors_on_on_start","type":"bool","value":"false"}],"x":140,"y":80,"wires":[["dc9b03a1cd3c4bbb"],[]]},{"id":"dc9b03a1cd3c4bbb","type":"change","z":"d4cb3f70d0c4b27a","name":"topic = execution","rules":[{"t":"set","p":"topic","pt":"msg","to":"execution","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":80,"wires":[["a17a9d23fc505b92"]]},{"id":"d2fec027be15804e","type":"change","z":"d4cb3f70d0c4b27a","name":"topic = state","rules":[{"t":"set","p":"topic","pt":"msg","to":"state","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":120,"wires":[["a17a9d23fc505b92"]]},{"id":"a12a47d36e80a3f3","type":"change","z":"d4cb3f70d0c4b27a","name":"topic = opMode","rules":[{"t":"set","p":"topic","pt":"msg","to":"opMode","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":160,"wires":[["a17a9d23fc505b92"]]},{"id":"a17a9d23fc505b92","type":"join","z":"d4cb3f70d0c4b27a","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"4","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":510,"y":140,"wires":[["ca0c42a14d089699"]]},{"id":"95afeb42fe666867","type":"switch","z":"d4cb3f70d0c4b27a","name":"if state = emergencystop","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"emergencystop","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":170,"y":360,"wires":[["08db3d6fdf02beb9"],["9dfaf9a3ec6fec39"]]},{"id":"f0e7001f9fb5060b","type":"switch","z":"d4cb3f70d0c4b27a","name":"if state = emergencystopreset","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"emergencystopreset","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":190,"y":600,"wires":[["649236809239e4d0"],["93b9fad39ee28602"]]},{"id":"8bc475ebcf64a1ae","type":"switch","z":"d4cb3f70d0c4b27a","name":"if opMode = UNDEF","property":"payload.opMode","propertyType":"msg","rules":[{"t":"eq","v":"UNDEF","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":160,"y":440,"wires":[["d882460b12c2690a"],["f46b70a5bafece1c"]]},{"id":"f46b70a5bafece1c","type":"switch","z":"d4cb3f70d0c4b27a","name":"if opMode = INIT","property":"payload.opMode","propertyType":"msg","rules":[{"t":"eq","v":"INIT","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":150,"y":480,"wires":[["d882460b12c2690a"],["9ddd80dbe44ccf4d"]]},{"id":"9ddd80dbe44ccf4d","type":"switch","z":"d4cb3f70d0c4b27a","name":"if opMode = AUTO_CH","property":"payload.opMode","propertyType":"msg","rules":[{"t":"eq","v":"AUTO_CH","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":160,"y":520,"wires":[["4504b3e608143156"],["c8d89215395be03d"]]},{"id":"9dfaf9a3ec6fec39","type":"switch","z":"d4cb3f70d0c4b27a","name":"if state = init","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"init","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":400,"wires":[["d882460b12c2690a"],["8bc475ebcf64a1ae"]]},{"id":"c8d89215395be03d","type":"switch","z":"d4cb3f70d0c4b27a","name":"if opMode = MANF_CH","property":"payload.opMode","propertyType":"msg","rules":[{"t":"eq","v":"MANF_CH","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":170,"y":560,"wires":[["4504b3e608143156"],["f0e7001f9fb5060b"]]},{"id":"ad2d071e68d3df54","type":"switch","z":"d4cb3f70d0c4b27a","name":"if opMode = AUTO","property":"payload.opMode","propertyType":"msg","rules":[{"t":"eq","v":"AUTO","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":1240,"wires":[["10d81e36896f0fce","9b9e613fef7cd3c8","348c91469f189e90"],["bc45a69631422a3f"]]},{"id":"93b9fad39ee28602","type":"switch","z":"d4cb3f70d0c4b27a","name":"if opMode = MANF","property":"payload.opMode","propertyType":"msg","rules":[{"t":"eq","v":"MANF","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":780,"wires":[["a791df4744a98a8e","8dae4baad7851612","271b506bd1b85ea8"],["3a256e4a24da4e36"]]},{"id":"3a256e4a24da4e36","type":"switch","z":"d4cb3f70d0c4b27a","name":"if opMode = MANR","property":"payload.opMode","propertyType":"msg","rules":[{"t":"eq","v":"MANR","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":130,"y":1020,"wires":[["33b7a0b8cbefe2db","42f7a534c666abd6","5d70ff6e4bb74eef"],["ad2d071e68d3df54"]]},{"id":"a791df4744a98a8e","type":"switch","z":"d4cb3f70d0c4b27a","name":"state: motoroff","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"motoroff","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":740,"wires":[["d419c3da2e014ed9"]]},{"id":"ca0c42a14d089699","type":"switch","z":"d4cb3f70d0c4b27a","name":"if state = sysfail","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"sysfail","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":140,"y":320,"wires":[["66b31e13178249d4"],["95afeb42fe666867"]]},{"id":"8dae4baad7851612","type":"switch","z":"d4cb3f70d0c4b27a","name":"state: motoron","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"motoron","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":780,"wires":[["5a006bd23b815a6f","815b0d9b7bf4b9ac"]]},{"id":"271b506bd1b85ea8","type":"switch","z":"d4cb3f70d0c4b27a","name":"state: guardstop","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"guardstop","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":700,"wires":[["d419c3da2e014ed9"]]},{"id":"33b7a0b8cbefe2db","type":"switch","z":"d4cb3f70d0c4b27a","name":"state: motoroff","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"motoroff","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":980,"wires":[["69853b156e01a580"]]},{"id":"42f7a534c666abd6","type":"switch","z":"d4cb3f70d0c4b27a","name":"state: motoron","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"motoron","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":1020,"wires":[["747649e512fc65c5","9f3abae9777842ab"]]},{"id":"5d70ff6e4bb74eef","type":"switch","z":"d4cb3f70d0c4b27a","name":"state: guardstop","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"guardstop","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":940,"wires":[["69853b156e01a580"]]},{"id":"10d81e36896f0fce","type":"switch","z":"d4cb3f70d0c4b27a","name":"state: motoroff","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"motoroff","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":1200,"wires":[["62fc5354dcc1ed36"]]},{"id":"9b9e613fef7cd3c8","type":"switch","z":"d4cb3f70d0c4b27a","name":"state: motoron","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"motoron","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":1240,"wires":[["8d920d59d305dddc","948491b081a91688"]]},{"id":"348c91469f189e90","type":"switch","z":"d4cb3f70d0c4b27a","name":"state: guardstop","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"guardstop","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":1160,"wires":[["9f14cd5318e6da9e"]]},{"id":"8d920d59d305dddc","type":"switch","z":"d4cb3f70d0c4b27a","name":"exec: 1","property":"payload.execution","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":1260,"wires":[["c1b1a9e3cb5459dc"]]},{"id":"948491b081a91688","type":"switch","z":"d4cb3f70d0c4b27a","name":"exec: 0","property":"payload.execution","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":1220,"wires":[["62fc5354dcc1ed36"]]},{"id":"747649e512fc65c5","type":"switch","z":"d4cb3f70d0c4b27a","name":"exec: 1","property":"payload.execution","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":1040,"wires":[["9d2c3dc3a99aec9d"]]},{"id":"9f3abae9777842ab","type":"switch","z":"d4cb3f70d0c4b27a","name":"exec: 0","property":"payload.execution","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":1000,"wires":[["ac2991314b91a632"]]},{"id":"5a006bd23b815a6f","type":"switch","z":"d4cb3f70d0c4b27a","name":"exec: 1","property":"payload.execution","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":800,"wires":[["4a95867f913fec52"]]},{"id":"815b0d9b7bf4b9ac","type":"switch","z":"d4cb3f70d0c4b27a","name":"exec: 0","property":"payload.execution","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":760,"wires":[["bf9bbeda0193a68e"]]},{"id":"f1fc4a052d8dc8eb","type":"subflow:cd5b51ab.751ca","z":"d4cb3f70d0c4b27a","name":"","env":[{"name":"subscription","type":"bool","value":"true"},{"name":"configId","value":"configId","type":"env"}],"x":130,"y":200,"wires":[["91ab9f7f90f69bd0"]]},{"id":"91ab9f7f90f69bd0","type":"change","z":"d4cb3f70d0c4b27a","name":"topic = speed","rules":[{"t":"set","p":"topic","pt":"msg","to":"speed","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":200,"wires":[["a17a9d23fc505b92"]]},{"id":"4a95867f913fec52","type":"switch","z":"d4cb3f70d0c4b27a","name":"speed","property":"payload.speed","propertyType":"msg","rules":[{"t":"gte","v":"3","vt":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":650,"y":800,"wires":[["3e9799b282a1f2eb"],["bed247989f30d969"]]},{"id":"c1b1a9e3cb5459dc","type":"switch","z":"d4cb3f70d0c4b27a","name":"speed","property":"payload.speed","propertyType":"msg","rules":[{"t":"gte","v":"100","vt":"num"},{"t":"lte","v":"0","vt":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":650,"y":1260,"wires":[["3b742e1354531224"],["5746042a33048383"],["0eada67ddbb10bf7"]]},{"id":"649236809239e4d0","type":"switch","z":"d4cb3f70d0c4b27a","name":"if opMode = AUTO","property":"payload.opMode","propertyType":"msg","rules":[{"t":"eq","v":"AUTO","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":550,"y":600,"wires":[["29e414d4a87b7e53"],["d3abbed35bb6ec53"]]},{"id":"66b31e13178249d4","type":"change","z":"d4cb3f70d0c4b27a","name":"system failure -> slowly blink purple","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"system failure","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"red","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FF00FF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":300,"wires":[["7ca040ffb26f9f8f"]]},{"id":"08db3d6fdf02beb9","type":"change","z":"d4cb3f70d0c4b27a","name":"e-stop -> blink red","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"e-stop","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"red","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FF0000","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":340,"wires":[["7ca040ffb26f9f8f"]]},{"id":"29e414d4a87b7e53","type":"change","z":"d4cb3f70d0c4b27a","name":"e-stop reset -> yellow","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"e-stop reset","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"yellow","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FFFF00","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":580,"wires":[["7ca040ffb26f9f8f"]]},{"id":"d3abbed35bb6ec53","type":"change","z":"d4cb3f70d0c4b27a","name":"e-stop reset -> blink white","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"e-stop reset","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"grey","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FFFFFF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":620,"wires":[["7ca040ffb26f9f8f"]]},{"id":"d882460b12c2690a","type":"change","z":"d4cb3f70d0c4b27a","name":"undefined -> slowly blink red","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"undefined","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"red","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FF0000","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":440,"wires":[["7ca040ffb26f9f8f"]]},{"id":"bc45a69631422a3f","type":"change","z":"d4cb3f70d0c4b27a","name":"undefined -> slowly blink purple","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"undefined","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"red","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FF00FF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":1420,"wires":[["7ca040ffb26f9f8f"]]},{"id":"4504b3e608143156","type":"change","z":"d4cb3f70d0c4b27a","name":"Op-Mode change -> blink yellow","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Op-Mode change","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"yellow","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FFFF00","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":520,"wires":[["7ca040ffb26f9f8f"]]},{"id":"d419c3da2e014ed9","type":"change","z":"d4cb3f70d0c4b27a","name":"Manual off -> white","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Manual off","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"grey","tot":"str"},{"t":"set","p":"payload.color1","pt":"msg","to":"#FFFFFF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":700,"wires":[["7ca040ffb26f9f8f"]]},{"id":"b084f3094d794a31","type":"change","z":"d4cb3f70d0c4b27a","name":"Lead through -> white blinking","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Lead through","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"grey","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FFFFFF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":1220,"wires":[["7ca040ffb26f9f8f"]]},{"id":"f5f3f77a1d554a76","type":"change","z":"d4cb3f70d0c4b27a","name":"Lead through -> white blinking","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Lead through","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"white","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FFFFFF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":860,"wires":[["7ca040ffb26f9f8f"]]},{"id":"b1c3d77f8b19d870","type":"change","z":"d4cb3f70d0c4b27a","name":"Lead through -> white blinking","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Lead through","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"grey","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FFFFFF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":1060,"wires":[["7ca040ffb26f9f8f"]]},{"id":"bf9bbeda0193a68e","type":"change","z":"d4cb3f70d0c4b27a","name":"Manual ready -> blue","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Manual ready","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"blue","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#0000FF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":740,"wires":[["7ca040ffb26f9f8f"]]},{"id":"ac2991314b91a632","type":"change","z":"d4cb3f70d0c4b27a","name":"Manual ready -> blue","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Manual ready","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"blue","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#0000FF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":980,"wires":[["7ca040ffb26f9f8f"]]},{"id":"69853b156e01a580","type":"change","z":"d4cb3f70d0c4b27a","name":"Manual off -> white","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Manual off","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"grey","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FFFFFF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":940,"wires":[["7ca040ffb26f9f8f"]]},{"id":"3e9799b282a1f2eb","type":"change","z":"d4cb3f70d0c4b27a","name":"manual high speed -> blink purple quickly","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"manual high speed","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"red","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FF00FF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"1.5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":780,"wires":[["7ca040ffb26f9f8f"]]},{"id":"bed247989f30d969","type":"change","z":"d4cb3f70d0c4b27a","name":"Manual running -> blink blue","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Manual running","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"blue","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#0000FF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":820,"wires":[["7ca040ffb26f9f8f"]]},{"id":"9d2c3dc3a99aec9d","type":"change","z":"d4cb3f70d0c4b27a","name":"Manual running -> blink blue","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Manual running","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"blue","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#0000FF","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":1020,"wires":[["7ca040ffb26f9f8f"]]},{"id":"9f14cd5318e6da9e","type":"change","z":"d4cb3f70d0c4b27a","name":"Auto safety -> red","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Auto safety","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"red","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FF0000","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":1140,"wires":[["7ca040ffb26f9f8f"]]},{"id":"62fc5354dcc1ed36","type":"change","z":"d4cb3f70d0c4b27a","name":"Auto stopped -> yellow","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Auto stopped","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"yellow","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FFFF00","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":1180,"wires":[["7ca040ffb26f9f8f"]]},{"id":"3b742e1354531224","type":"change","z":"d4cb3f70d0c4b27a","name":"Auto running -> green","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Auto running","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"green","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#00FF00","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":1260,"wires":[["7ca040ffb26f9f8f"]]},{"id":"0eada67ddbb10bf7","type":"change","z":"d4cb3f70d0c4b27a","name":"Auto low speed -> blink green","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Auto low speed","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"green","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#00FF00","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":1300,"wires":[["7ca040ffb26f9f8f"]]},{"id":"5746042a33048383","type":"change","z":"d4cb3f70d0c4b27a","name":"Auto standstill -> yellow blink","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"Auto standstill","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"yellow","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#FFFF00","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":1340,"wires":[["7ca040ffb26f9f8f"]]},{"id":"7ca040ffb26f9f8f","type":"change","z":"d4cb3f70d0c4b27a","name":"","rules":[{"t":"set","p":"mainEffect","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1250,"y":820,"wires":[[]]},{"id":"782cecf01b0df6c3","type":"change","z":"d4cb3f70d0c4b27a","name":"set msg.payload to flow.mainEffect","rules":[{"t":"set","p":"payload","pt":"msg","to":"mainEffect","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":1700,"wires":[["67d914c1f7940f30"]]},{"id":"292d53fa64d617a7","type":"comment","z":"d4cb3f70d0c4b27a","name":"On","info":"","x":550,"y":1840,"wires":[]},{"id":"815cf5891635265f","type":"comment","z":"d4cb3f70d0c4b27a","name":"Off","info":"","x":550,"y":1960,"wires":[]},{"id":"67d914c1f7940f30","type":"change","z":"d4cb3f70d0c4b27a","name":"get timestamp","rules":[{"t":"set","p":"payload.time","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":1720,"wires":[["3ff3145415c92ef8"]]},{"id":"592a1aec7f84d96b","type":"switch","z":"d4cb3f70d0c4b27a","name":"if blink should be on","property":"(payload.time % (1000/payload.frequency))","propertyType":"jsonata","rules":[{"t":"gt","v":"(500/payload.frequency)","vt":"jsonata"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":240,"y":2000,"wires":[["4a259b8f79bdaa42","6b6232ccf5f6b46e"],["7f167b516823edcb","b2e76fe190077222"]]},{"id":"3ff3145415c92ef8","type":"switch","z":"d4cb3f70d0c4b27a","name":"if frequency is 0","property":"payload.frequency","propertyType":"msg","rules":[{"t":"lte","v":"0","vt":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":220,"y":1900,"wires":[["4a259b8f79bdaa42","6b6232ccf5f6b46e"],["592a1aec7f84d96b"]]},{"id":"6dac0ddc2702bf36","type":"inject","z":"d4cb3f70d0c4b27a","name":"","props":[],"repeat":"0.1","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":110,"y":1660,"wires":[["69af83c35d15fb15"]]},{"id":"4a259b8f79bdaa42","type":"change","z":"d4cb3f70d0c4b27a","name":"change nothing","rules":[],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":1880,"wires":[["959184afd97f5ce2"]]},{"id":"7f167b516823edcb","type":"change","z":"d4cb3f70d0c4b27a","name":"payload = status ","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.status","tot":"msg"},{"t":"set","p":"payload.shape","pt":"msg","to":"ring","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":2040,"wires":[[]]},{"id":"6b6232ccf5f6b46e","type":"change","z":"d4cb3f70d0c4b27a","name":"payload = status ","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.status","tot":"msg"},{"t":"set","p":"payload.shape","pt":"msg","to":"dot","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":1920,"wires":[[]]},{"id":"b2e76fe190077222","type":"change","z":"d4cb3f70d0c4b27a","name":"payload.color = #000000","rules":[{"t":"set","p":"payload.color","pt":"msg","to":"#000000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":2000,"wires":[["959184afd97f5ce2"]]},{"id":"959184afd97f5ce2","type":"rbe","z":"d4cb3f70d0c4b27a","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload.color","x":850,"y":1920,"wires":[[]]},{"id":"bb4c0fe702d6bcb1","type":"catch","z":"d4cb3f70d0c4b27a","name":"","scope":null,"uncaught":false,"x":670,"y":1460,"wires":[["bcf40e74868e98d4"]]},{"id":"bcf40e74868e98d4","type":"change","z":"d4cb3f70d0c4b27a","name":"ERROR -> slowly blink red","rules":[{"t":"set","p":"payload.status.text","pt":"msg","to":"ERROR","tot":"str"},{"t":"set","p":"payload.status.fill","pt":"msg","to":"illegal","tot":"str"},{"t":"set","p":"payload.color","pt":"msg","to":"#000000","tot":"str"},{"t":"set","p":"payload.frequency","pt":"msg","to":"0.2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":1460,"wires":[["7ca040ffb26f9f8f"]]},{"id":"b65ae2206bb2be2f","type":"comment","z":"d4cb3f70d0c4b27a","name":"Subscribe to required Robot resources","info":"","x":190,"y":40,"wires":[]},{"id":"328b102d7c3da5da","type":"comment","z":"d4cb3f70d0c4b27a","name":"Determine what colour to display","info":"","x":170,"y":280,"wires":[]},{"id":"cebe628c0f853fb2","type":"comment","z":"d4cb3f70d0c4b27a","name":"Colour and blinking circuit","info":"","x":130,"y":1620,"wires":[]},{"id":"a23e56ac8c83d0d0","type":"trigger","z":"d4cb3f70d0c4b27a","name":"","op1":"","op2":"{}","op1type":"nul","op2type":"json","duration":"2","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":200,"y":2240,"wires":[["1e1c12eaebdcf301"]]},{"id":"69af83c35d15fb15","type":"switch","z":"d4cb3f70d0c4b27a","name":"if flow.overrideEffect_Active = false","property":"overrideEffect_Active","propertyType":"flow","rules":[{"t":"false"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":260,"y":1720,"wires":[["782cecf01b0df6c3"],["3b392567983feb65"]]},{"id":"3b392567983feb65","type":"change","z":"d4cb3f70d0c4b27a","name":"set msg.payload to flow.overrideEffect","rules":[{"t":"set","p":"payload","pt":"msg","to":"overrideEffect","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1740,"wires":[["67d914c1f7940f30"]]},{"id":"035fa1e11e39e5d4","type":"change","z":"d4cb3f70d0c4b27a","name":"flow.overrideEffect = msg.payload","rules":[{"t":"set","p":"overrideEffect","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":2200,"wires":[["2023d6470ec7f5c8"]]},{"id":"1e1c12eaebdcf301","type":"change","z":"d4cb3f70d0c4b27a","name":"overrideEffect_Active = false","rules":[{"t":"set","p":"overrideEffect_Active","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":2240,"wires":[[]]},{"id":"b9baa6c100deb910","type":"comment","z":"d4cb3f70d0c4b27a","name":"Override flow","info":"","x":90,"y":2160,"wires":[]},{"id":"07d2cc9b81015a8f","type":"inject","z":"d4cb3f70d0c4b27a","name":"","props":[],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":370,"y":2280,"wires":[["1e1c12eaebdcf301"]]},{"id":"2023d6470ec7f5c8","type":"change","z":"d4cb3f70d0c4b27a","name":"overrideEffect_Active = true","rules":[{"t":"set","p":"overrideEffect_Active","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":2200,"wires":[[]]},{"id":"4faff9b7529ca09c","type":"trigger","z":"ce24bd14b3c41949","name":"","op1":"","op2":" ","op1type":"nul","op2type":"str","duration":"30","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":230,"y":240,"wires":[[]]},{"id":"bf7cd1cd167864c7","type":"inject","z":"ce24bd14b3c41949","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":250,"y":80,"wires":[[]]},{"id":"a7be49530f786260","type":"trigger","z":"ce24bd14b3c41949","name":"","op1":"","op2":"","op1type":"str","op2type":"str","duration":"0.2","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":230,"y":120,"wires":[[]]},{"id":"dc0be98d35cc1fbb","type":"trigger","z":"ce24bd14b3c41949","name":"","op1":"","op2":"","op1type":"str","op2type":"nul","duration":"1","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":240,"y":160,"wires":[[]]},{"id":"8dfabd9f2999c568","type":"delay","z":"ce24bd14b3c41949","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":155,"y":160,"wires":[["dc0be98d35cc1fbb"]],"l":false},{"id":"72eec61868e5a990","type":"trigger","z":"ce24bd14b3c41949","name":"","op1":"","op2":"","op1type":"nul","op2type":"str","duration":"1","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":240,"y":200,"wires":[[]]},{"id":"1afeb97b95a15176","type":"abb-robot-rmq","z":"990942449cfdbb29","name":"ABB Robot RMQ","sourceQueue":"rmq_robot_event_test","configRef":"173b45e8cc68049e","x":450,"y":540,"wires":[["44cbe85008a6f352"]]},{"id":"e4a00fd197bf17f0","type":"subflow:2f0cb7c7.dd9f18","z":"990942449cfdbb29","name":"","env":[{"name":"static_id","value":"999","type":"env"}],"x":260,"y":540,"wires":[["1afeb97b95a15176"]]},{"id":"44cbe85008a6f352","type":"subflow:2f0cb7c7.dd9f18","z":"990942449cfdbb29","name":"","env":[{"name":"override_metadata_mode","type":"bool","value":"false"},{"name":"metadata_instruiction","value":"2","type":"str"},{"name":"use_static_id","type":"bool","value":"false"}],"x":640,"y":540,"wires":[[]]},{"id":"c39c17778d0a2943","type":"comment","z":"990942449cfdbb29","name":"Subscribe to event on robot intializing","info":"","x":730,"y":320,"wires":[]},{"id":"2f57daa6b07c5c20","type":"comment","z":"990942449cfdbb29","name":"Trigger Event through RMQ","info":"","x":340,"y":400,"wires":[]},{"id":"6d4c9fbc9eb3f405","type":"subflow:2f0cb7c7.dd9f18","z":"990942449cfdbb29","name":"","env":[{"name":"metadata_instruiction","value":"2","type":"str"},{"name":"static_id","value":"999","type":"env"}],"x":240,"y":720,"wires":[[]]},{"id":"ccbb76f2133919b6","type":"comment","z":"6df522bdaa65197a","name":"/hd0a/360-103564_RW6_12/internal/FPSystem.xml","info":"","x":310,"y":260,"wires":[]},{"id":"4277024c429580ba","type":"comment","z":"6df522bdaa65197a","name":"1. Load each RNL file as a program file","info":"","x":230,"y":460,"wires":[]},{"id":"47c6f571c7ae874b","type":"comment","z":"6df522bdaa65197a","name":"2. Load config files, excluding auto load of RNL modules","info":"","x":280,"y":500,"wires":[]},{"id":"b6be9b102f6c80d0","type":"comment","z":"6df522bdaa65197a","name":"3. Order a warmstart","info":"","x":170,"y":540,"wires":[]},{"id":"c64957f2e7c920c7","type":"comment","z":"6df522bdaa65197a","name":"Open Install","info":"","x":150,"y":380,"wires":[]},{"id":"6c9c2b0a82170b9e","type":"comment","z":"6df522bdaa65197a","name":"1. Upload RNL files to HOME:/RNL/","info":"","x":660,"y":460,"wires":[]},{"id":"808bc970f287576a","type":"comment","z":"6df522bdaa65197a","name":"2. Load config files, including auto load of RNL modules","info":"","x":720,"y":500,"wires":[]},{"id":"e1ed88cb8ae8ad44","type":"comment","z":"6df522bdaa65197a","name":"3. Order a P-restart to load modules","info":"","x":660,"y":540,"wires":[]},{"id":"9d47b91a3c23a563","type":"comment","z":"6df522bdaa65197a","name":"Hidden Install","info":"","x":590,"y":380,"wires":[]},{"id":"63c198fe4d1086c3","type":"comment","z":"6df522bdaa65197a","name":"0. Take a backup of the robot, and save to the robot disk","info":"","x":720,"y":420,"wires":[]},{"id":"ea54dd4c3c55698b","type":"comment","z":"6df522bdaa65197a","name":"0. Take a backup of the robot, and save to the robot disk","info":"","x":280,"y":420,"wires":[]},{"id":"20692370.3f47dc","type":"json","z":"2f0cb7c7.dd9f18","name":"","property":"payload","action":"str","pretty":false,"x":670,"y":400,"wires":[["9914cca3.126b8"]]},{"id":"9914cca3.126b8","type":"change","z":"2f0cb7c7.dd9f18","name":"Add datatype based on topic","rules":[{"t":"set","p":"payload","pt":"msg","to":"msg.topic & \";\" & msg.payload","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":400,"wires":[["61d8be59.ea77e"]]},{"id":"76e7bfc8.07034","type":"comment","z":"2f0cb7c7.dd9f18","name":"Convert array, string, num and bool data to RMQ message format","info":"","x":790,"y":360,"wires":[]},{"id":"4bf4888c.f1cd68","type":"switch","z":"2f0cb7c7.dd9f18","name":"Filter Datatype","property":"payload","propertyType":"msg","rules":[{"t":"istype","v":"array","vt":"array"},{"t":"istype","v":"string","vt":"string"},{"t":"istype","v":"number","vt":"number"},{"t":"istype","v":"boolean","vt":"boolean"},{"t":"istype","v":"null","vt":"null"},{"t":"istype","v":"undefined","vt":"undefined"},{"t":"istype","v":"object","vt":"object"}],"checkall":"false","repair":false,"outputs":7,"x":220,"y":440,"wires":[["20692370.3f47dc"],["973af41c.991518"],["86e3fe59.73dcf"],["26cbedf0.d5caa2"],["808abbdd.a38c78"],["808abbdd.a38c78"],["609142c55875ea86"]]},{"id":"479ee0a1.fcbc8","type":"comment","z":"2f0cb7c7.dd9f18","name":"Convert RMQ data to java data","info":"","x":510,"y":80,"wires":[]},{"id":"17610101.6aa17f","type":"comment","z":"2f0cb7c7.dd9f18","name":"Convert null and undefined to empty string","info":"","x":540,"y":600,"wires":[]},{"id":"808abbdd.a38c78","type":"change","z":"2f0cb7c7.dd9f18","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"string;\"\"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":640,"wires":[["61d8be59.ea77e"]]},{"id":"8413cf3c.93c24","type":"json","z":"2f0cb7c7.dd9f18","name":"","property":"payload","action":"obj","pretty":false,"x":750,"y":240,"wires":[["dcc7079dfe859b60"]]},{"id":"86e3fe59.73dcf","type":"change","z":"2f0cb7c7.dd9f18","name":"num","rules":[{"t":"set","p":"topic","pt":"msg","to":"num","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":480,"wires":[["20692370.3f47dc"]]},{"id":"973af41c.991518","type":"change","z":"2f0cb7c7.dd9f18","name":"string","rules":[{"t":"set","p":"topic","pt":"msg","to":"string","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":440,"wires":[["5bab87a656ec38cd"]]},{"id":"26cbedf0.d5caa2","type":"change","z":"2f0cb7c7.dd9f18","name":"bool","rules":[{"t":"set","p":"topic","pt":"msg","to":"bool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":520,"wires":[["20692370.3f47dc"]]},{"id":"5797ff13.b1acf","type":"comment","z":"2f0cb7c7.dd9f18","name":"Set Topic","info":"","x":440,"y":360,"wires":[]},{"id":"9d553ed2.a6ff7","type":"comment","z":"2f0cb7c7.dd9f18","name":"arrays","info":"","x":430,"y":400,"wires":[]},{"id":"a48530c6.101df","type":"change","z":"2f0cb7c7.dd9f18","name":"Set msg.metadata based on parameters","rules":[{"t":"set","p":"metadata","pt":"msg","to":"($number($env('metadata_instruiction'))*8192)+($flowContext('dynamic_id') % 8192)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":980,"wires":[["bff857fd5c40f879"]]},{"id":"1ab0c31d.366aed","type":"switch","z":"2f0cb7c7.dd9f18","name":"If override_metadata_mode","property":"override_metadata_mode","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":220,"y":920,"wires":[["b2c6f332.ae4e"],["bff857fd5c40f879"]]},{"id":"18476799.ec7318","type":"comment","z":"2f0cb7c7.dd9f18","name":"8192","info":"","x":190,"y":1180,"wires":[]},{"id":"2bb0c41a.5b191c","type":"comment","z":"2f0cb7c7.dd9f18","name":"dataPointer:[\"\",\"\",0,\"\",\"\",0,\"\"]","info":"","x":390,"y":1180,"wires":[]},{"id":"c65b797e.3d0e38","type":"comment","z":"2f0cb7c7.dd9f18","name":"Add metadata","info":"","x":110,"y":880,"wires":[]},{"id":"b2c6f332.ae4e","type":"switch","z":"2f0cb7c7.dd9f18","name":"If use_static_id","property":"use_static_id","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":440,"y":880,"wires":[["c2f8e1df.0b2cc"],["fc444408.690508"]]},{"id":"c2f8e1df.0b2cc","type":"change","z":"2f0cb7c7.dd9f18","name":"Set msg.metadata based on parameters","rules":[{"t":"set","p":"metadata","pt":"msg","to":"($number($env('metadata_instruiction'))*8192)+$env('static_id')","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":860,"wires":[["bff857fd5c40f879"]]},{"id":"3330a4cd.16d64c","type":"link in","z":"2f0cb7c7.dd9f18","name":"","links":["61d8be59.ea77e"],"x":55,"y":920,"wires":[["1ab0c31d.366aed"]]},{"id":"61d8be59.ea77e","type":"link out","z":"2f0cb7c7.dd9f18","name":"","links":["3330a4cd.16d64c"],"x":1035,"y":400,"wires":[]},{"id":"fc444408.690508","type":"change","z":"2f0cb7c7.dd9f18","name":"dynamic_id += 1","rules":[{"t":"set","p":"dynamic_id","pt":"flow","to":"$flowContext('dynamic_id') + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":980,"wires":[["a48530c6.101df"]]},{"id":"48ba6634.709148","type":"change","z":"2f0cb7c7.dd9f18","name":"dynamic_id = 0","rules":[{"t":"set","p":"dynamic_id","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":1020,"wires":[[]]},{"id":"4a01fa05.9322e4","type":"inject","z":"2f0cb7c7.dd9f18","name":"","props":[],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":270,"y":1020,"wires":[["48ba6634.709148"]]},{"id":"dcc7079dfe859b60","type":"change","z":"2f0cb7c7.dd9f18","name":"","rules":[{"t":"set","p":"metadata","pt":"msg","to":"$number(msg.metadata)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":160,"wires":[[]]},{"id":"012cc1f71d0b561e","type":"comment","z":"2f0cb7c7.dd9f18","name":"objects can contain the type","info":"","x":500,"y":700,"wires":[]},{"id":"609142c55875ea86","type":"json","z":"2f0cb7c7.dd9f18","name":"","property":"payload","action":"str","pretty":false,"x":430,"y":740,"wires":[["84d9dd2c24865d58"]]},{"id":"84d9dd2c24865d58","type":"change","z":"2f0cb7c7.dd9f18","name":"remove json formatting details","rules":[{"t":"change","p":"payload","pt":"msg","from":":","fromt":"str","to":";","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"{","fromt":"str","to":"","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"}","fromt":"str","to":"","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"\"","fromt":"str","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":740,"wires":[["61d8be59.ea77e"]]},{"id":"25b19ba509396416","type":"change","z":"2f0cb7c7.dd9f18","d":true,"name":"Split at \";\" and set topic and payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"$split(msg.payload, \";\")","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"payload[0]","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"msg.payload[1]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":280,"wires":[[]]},{"id":"956aadb4eb9fcfef","type":"change","z":"2f0cb7c7.dd9f18","name":"add json formatting details for objects","rules":[{"t":"set","p":"payload","pt":"msg","to":"$split(msg.payload, \";\")","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"payload[0]","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"'{\"' & msg.payload[0] & '\":' & msg.payload[1] & '}'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":240,"wires":[["8413cf3c.93c24"]]},{"id":"198c8b8f65b54bde","type":"switch","z":"2f0cb7c7.dd9f18","name":"filter datatype","property":"$split(msg.payload, \";\")[0]","propertyType":"jsonata","rules":[{"t":"eq","v":"string","vt":"str"},{"t":"eq","v":"num","vt":"str"},{"t":"eq","v":"bool","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":220,"y":180,"wires":[["57b1f2b16c19bbba"],["02ee7cede976aefd"],["4f7e58fb51a4609b"],["956aadb4eb9fcfef"]]},{"id":"57b1f2b16c19bbba","type":"change","z":"2f0cb7c7.dd9f18","name":"format as string","rules":[{"t":"set","p":"payload","pt":"msg","to":"$split(msg.payload, \";\")","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"payload[0]","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"msg.payload[1]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":120,"wires":[["4e1ace0562733171"]]},{"id":"02ee7cede976aefd","type":"change","z":"2f0cb7c7.dd9f18","name":"format as num","rules":[{"t":"set","p":"payload","pt":"msg","to":"$split(msg.payload, \";\")","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"payload[0]","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"$number(msg.payload[1])","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":160,"wires":[["dcc7079dfe859b60"]]},{"id":"4f7e58fb51a4609b","type":"change","z":"2f0cb7c7.dd9f18","name":"format as bool","rules":[{"t":"set","p":"payload","pt":"msg","to":"$split(msg.payload, \";\")","tot":"jsonata"},{"t":"set","p":"topic","pt":"msg","to":"payload[0]","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"$boolean(msg.payload[1])","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":200,"wires":[["dcc7079dfe859b60"]]},{"id":"46abdc85c6e20c98","type":"switch","z":"2f0cb7c7.dd9f18","name":"is data RMQ or Java?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":";","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":180,"y":300,"wires":[["198c8b8f65b54bde"],["4bf4888c.f1cd68"]]},{"id":"f223cf737ba0210c","type":"link in","z":"2f0cb7c7.dd9f18","name":"","links":["bff857fd5c40f879"],"x":1075,"y":400,"wires":[[]]},{"id":"bff857fd5c40f879","type":"link out","z":"2f0cb7c7.dd9f18","name":"","links":["f223cf737ba0210c"],"x":955,"y":920,"wires":[]},{"id":"39e93b0b775b7be3","type":"comment","z":"2f0cb7c7.dd9f18","name":"Convert java data to RMQ data","info":"","x":510,"y":320,"wires":[]},{"id":"4e1ace0562733171","type":"change","z":"2f0cb7c7.dd9f18","name":"remove \" \"","rules":[{"t":"change","p":"payload","pt":"msg","from":"\"","fromt":"str","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":120,"wires":[["dcc7079dfe859b60"]]},{"id":"5bab87a656ec38cd","type":"change","z":"2f0cb7c7.dd9f18","name":"add \" \"","rules":[{"t":"set","p":"payload","pt":"msg","to":"'\"' & msg.payload & '\"'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":440,"wires":[["20692370.3f47dc"]]},{"id":"d9f7bb2ee2d93843","type":"change","z":"1c8b3f7678bc98b1","name":"get current state","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/panel/ctrlstate","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"GET","tot":"str"},{"t":"set","p":"payload.request.params.json","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":200,"wires":[["10342ef6852cf03a"]]},{"id":"79c2080c8eb9086f","type":"change","z":"1c8b3f7678bc98b1","name":"filter state","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.response.data._embedded._state[0].ctrlstate","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":300,"wires":[[]]},{"id":"1b8354385d0eb8a9","type":"abb-robot-webservice","z":"1c8b3f7678bc98b1","name":"ABB Robot WebService","configRef":"","override":"{\"service\":\"\",\"data\":{}}","x":790,"y":220,"wires":[["79c2080c8eb9086f"]]},{"id":"b5e7d56788ff1244","type":"switch","z":"1c8b3f7678bc98b1","name":"if subscribed","property":"subscription","propertyType":"env","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":300,"wires":[["41efd04b4a563754"]]},{"id":"10342ef6852cf03a","type":"change","z":"1c8b3f7678bc98b1","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":180,"wires":[["1b8354385d0eb8a9"]]},{"id":"24ddda4abcd03fa6","type":"catch","z":"1c8b3f7678bc98b1","name":"","scope":null,"uncaught":true,"x":680,"y":440,"wires":[[]]},{"id":"c45d9fed07dc92f3","type":"abb-robot-subscription","z":"1c8b3f7678bc98b1","name":"","configRef":"","configId":"configId","configIdType":"env","resource":"/rw/panel/ctrlstate","priority":"1","x":100,"y":300,"wires":[["b5e7d56788ff1244"]]},{"id":"41efd04b4a563754","type":"xml","z":"1c8b3f7678bc98b1","name":"","property":"payload","attr":"","chr":"","x":270,"y":340,"wires":[["e7308e2d3994bdc9"]]},{"id":"e7308e2d3994bdc9","type":"change","z":"1c8b3f7678bc98b1","name":"filter state","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.html.body[0].div[0].ul[0].li[0].span[0]._","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":340,"wires":[[]]},{"id":"291ebc5fd6d7650d","type":"inject","z":"1c8b3f7678bc98b1","name":"init","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","x":130,"y":200,"wires":[["edb167069513a91b"]]},{"id":"edb167069513a91b","type":"switch","z":"1c8b3f7678bc98b1","name":"if subscribed","property":"subscription","propertyType":"env","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":200,"wires":[["d9f7bb2ee2d93843"]]},{"id":"0b45999415b64c1e","type":"abb-robot-webservice","z":"48c858d0b6016e60","name":"ABB Robot WebService","encrypt":false,"configRef":"","override":"{\"service\":\"\",\"data\":{},\"api\":\"\",\"method\":\"\",\"Orginalpath\":\"\",\"webServicePs\":{},\"webServiceQs\":{}}","x":370,"y":100,"wires":[["472610e3ddceee1f"]]},{"id":"27b18c84d6e5d31b","type":"change","z":"48c858d0b6016e60","name":"Warmstart","rules":[{"t":"set","p":"payload.request.url","pt":"msg","to":"/ctrl","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload.request.data.restart-mode","pt":"msg","to":"restart","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":170,"y":60,"wires":[["523abdf8309e5c45"]]},{"id":"472610e3ddceee1f","type":"change","z":"48c858d0b6016e60","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":60,"wires":[[]]},{"id":"f8c50eb5746df5df","type":"catch","z":"48c858d0b6016e60","name":"","scope":null,"uncaught":true,"x":580,"y":120,"wires":[[]]},{"id":"523abdf8309e5c45","type":"change","z":"48c858d0b6016e60","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":60,"wires":[["0b45999415b64c1e"]]},{"id":"d4d443cd40661af8","type":"change","z":"983802a68453d50b","name":"get the backup name","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.request.data.backup","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":300,"wires":[[]]},{"id":"bf78ea39064eb1d9","type":"abb-robot-webservice","z":"983802a68453d50b","name":"ABB Robot WebService","configRef":"","override":"{\"service\":\"\",\"data\":{}}","x":790,"y":220,"wires":[["d4d443cd40661af8"]]},{"id":"bc5fe32b5716384c","type":"change","z":"983802a68453d50b","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":180,"wires":[["bf78ea39064eb1d9"]]},{"id":"492109ce6710d666","type":"change","z":"983802a68453d50b","name":"save backup","rules":[{"t":"set","p":"payload.request.url","pt":"msg","to":"/ctrl/backup","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload.request.params.action","pt":"msg","to":"backup","tot":"str"},{"t":"set","p":"backup_name","pt":"msg","to":"backup_name","tot":"env"},{"t":"set","p":"payload.request.data.backup","pt":"msg","to":"\"/fileservice/$syspar/\" & msg.backup_name & \"-\" & $replace($now(),\":\",\"-\")","tot":"jsonata"},{"t":"delete","p":"backup_name","pt":"msg"},{"t":"set","p":"payload.request.data.archive","pt":"msg","to":"TRUE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":200,"wires":[["bc5fe32b5716384c"]]},{"id":"85df18514b0ef9b0","type":"catch","z":"983802a68453d50b","name":"","scope":null,"uncaught":true,"x":680,"y":440,"wires":[[]]},{"id":"8fa40c4515a0dfdd","type":"change","z":"7fe2370ff54129e9","name":"get current state","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/panel/opmode","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"GET","tot":"str"},{"t":"set","p":"payload.request.params.json","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":200,"wires":[["85a0894917897546"]]},{"id":"0cebc7758b8292c5","type":"change","z":"7fe2370ff54129e9","name":"filter state","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.response.data._embedded._state[0].opmode","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":300,"wires":[[]]},{"id":"7696ac351c37e994","type":"abb-robot-webservice","z":"7fe2370ff54129e9","name":"ABB Robot WebService","configRef":"","override":"{\"service\":\"\",\"data\":{}}","x":790,"y":220,"wires":[["0cebc7758b8292c5"]]},{"id":"85a0894917897546","type":"change","z":"7fe2370ff54129e9","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":180,"wires":[["7696ac351c37e994"]]},{"id":"d295312c4486de77","type":"catch","z":"7fe2370ff54129e9","name":"","scope":null,"uncaught":true,"x":680,"y":440,"wires":[[]]},{"id":"9f8de4ccf5e36824","type":"switch","z":"7fe2370ff54129e9","name":"if subscribed","property":"subscription","propertyType":"env","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":300,"wires":[["43e84d529709979b"]]},{"id":"d6b10ee86782234f","type":"abb-robot-subscription","z":"7fe2370ff54129e9","name":"","configRef":"","configId":"configId","configIdType":"env","resource":"/rw/panel/opmode","priority":"1","x":100,"y":300,"wires":[["9f8de4ccf5e36824"]]},{"id":"43e84d529709979b","type":"xml","z":"7fe2370ff54129e9","name":"","property":"payload","attr":"","chr":"","x":270,"y":340,"wires":[["a424bd858110d648"]]},{"id":"3857eff799fa7ced","type":"inject","z":"7fe2370ff54129e9","name":"init","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","x":130,"y":200,"wires":[["0b9046205197b897"]]},{"id":"0b9046205197b897","type":"switch","z":"7fe2370ff54129e9","name":"if subscribed","property":"subscription","propertyType":"env","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":200,"wires":[["8fa40c4515a0dfdd"]]},{"id":"a424bd858110d648","type":"change","z":"7fe2370ff54129e9","name":"filter state","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.html.body[0].div[0].ul[0].li[0].span[0]._","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":340,"wires":[[]]},{"id":"681a2ab5.0fdb54","type":"abb-robot-webservice","z":"cd5b51ab.751ca","name":"ABB Robot WebService","configRef":"","override":"{\"service\":\"\",\"data\":{}}","x":790,"y":100,"wires":[["47ebeba0.db5df4"]]},{"id":"e7f965a6.4e7728","type":"switch","z":"cd5b51ab.751ca","name":"","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":350,"y":80,"wires":[["b7ef219d.ed4c9"],["47ebeba0.db5df4"]]},{"id":"bf34d969.193668","type":"change","z":"cd5b51ab.751ca","name":"convert to number","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(msg.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":380,"wires":[[]]},{"id":"2f1f6e89.3021b2","type":"abb-robot-webservice","z":"cd5b51ab.751ca","name":"ABB Robot WebService","configRef":"","override":"{\"service\":\"\",\"data\":{}}","x":790,"y":220,"wires":[["55403892.eeb378"]]},{"id":"1b35f84a.d54708","type":"switch","z":"cd5b51ab.751ca","name":"if subscribed","property":"subscription","propertyType":"env","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":200,"wires":[["47ebeba0.db5df4"]]},{"id":"f1e6d7f0.3479b8","type":"change","z":"cd5b51ab.751ca","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":60,"wires":[["681a2ab5.0fdb54"]]},{"id":"112b64fa.51544b","type":"change","z":"cd5b51ab.751ca","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":180,"wires":[["2f1f6e89.3021b2"]]},{"id":"b7ef219d.ed4c9","type":"change","z":"cd5b51ab.751ca","name":"if number: 0-100 \\n set speed","rules":[{"t":"set","p":"TEMP","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/panel/speedratio","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload.request.params.action","pt":"msg","to":"setspeedratio","tot":"str"},{"t":"set","p":"payload.request.data.speed-ratio","pt":"msg","to":"TEMP","tot":"msg"},{"t":"delete","p":"TEMP","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":60,"wires":[["f1e6d7f0.3479b8"]]},{"id":"47ebeba0.db5df4","type":"change","z":"cd5b51ab.751ca","name":"get current speed","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/panel/speedratio","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"GET","tot":"str"},{"t":"set","p":"payload.request.params.json","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":200,"wires":[["112b64fa.51544b"]]},{"id":"55403892.eeb378","type":"change","z":"cd5b51ab.751ca","name":"filter state","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.response.data._embedded._state[0].speedratio","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":300,"wires":[["bf34d969.193668"]]},{"id":"94994803884054bd","type":"catch","z":"cd5b51ab.751ca","name":"","scope":null,"uncaught":true,"x":680,"y":440,"wires":[[]]},{"id":"c5091610b596b534","type":"switch","z":"cd5b51ab.751ca","name":"if subscribed","property":"subscription","propertyType":"env","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":300,"wires":[["266003d2b41ab26d"]]},{"id":"3389b4fa62930659","type":"abb-robot-subscription","z":"cd5b51ab.751ca","name":"","configRef":"","configId":"configId","configIdType":"env","resource":"/rw/panel/speedratio","priority":"1","x":100,"y":300,"wires":[["c5091610b596b534"]]},{"id":"266003d2b41ab26d","type":"xml","z":"cd5b51ab.751ca","name":"","property":"payload","attr":"","chr":"","x":270,"y":340,"wires":[["85389bbc67b245e0"]]},{"id":"85389bbc67b245e0","type":"change","z":"cd5b51ab.751ca","name":"filter state","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.html.body[0].div[0].ul[0].li[0].span[0]._","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":340,"wires":[["bf34d969.193668"]]},{"id":"09da3c6f5a675152","type":"inject","z":"cd5b51ab.751ca","name":"init","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","x":130,"y":200,"wires":[["1b35f84a.d54708"]]},{"id":"c78be928e4f90622","type":"change","z":"8771dc9f224e185f","name":"Restore Message","rules":[{"t":"move","p":"payload_robot_version_switch","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":520,"wires":[[]]},{"id":"6c89d28282f94923","type":"switch","z":"8771dc9f224e185f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"7","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":110,"y":500,"wires":[["77c744d110220ae5"],["c78be928e4f90622"]]},{"id":"4a0a7c6006eec31c","type":"change","z":"8771dc9f224e185f","name":"get RW version","rules":[{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/system/products?json=1","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"GET","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":240,"wires":[["88055868a37659ac"]]},{"id":"ee0807de573526cc","type":"abb-robot-webservice","z":"8771dc9f224e185f","name":"ABB Robot WebService","configRef":"","override":"","x":270,"y":320,"wires":[["cfa5915fcbea5f00"]]},{"id":"88055868a37659ac","type":"change","z":"8771dc9f224e185f","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":280,"wires":[["ee0807de573526cc"]]},{"id":"169d6c95eebaa638","type":"change","z":"8771dc9f224e185f","name":"Buffer message","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload_robot_version_switch","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":100,"wires":[["4a0a7c6006eec31c"]]},{"id":"06f35a2c431a3906","type":"comment","z":"8771dc9f224e185f","name":"Save the message for later","info":"","x":200,"y":60,"wires":[]},{"id":"05fd0650ef81eed0","type":"comment","z":"8771dc9f224e185f","name":"Route based on version, and restore message","info":"","x":250,"y":440,"wires":[]},{"id":"f4186c838c780633","type":"comment","z":"8771dc9f224e185f","name":"Get the RW version from the robot","info":"","x":220,"y":200,"wires":[]},{"id":"77c744d110220ae5","type":"change","z":"8771dc9f224e185f","name":"Restore Message","rules":[{"t":"move","p":"payload_robot_version_switch","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":480,"wires":[[]]},{"id":"cfa5915fcbea5f00","type":"change","z":"8771dc9f224e185f","name":"filter major version (6 or 7)","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.response.data.state[0][\"version-name\"]","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"$substring(msg.payload, 0, 1)\t","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":360,"wires":[["6c89d28282f94923"]]},{"id":"ef206b14256acc9d","type":"catch","z":"8771dc9f224e185f","name":"","scope":null,"uncaught":true,"x":300,"y":560,"wires":[[]]},{"id":"45357dad.003364","type":"abb-robot-webservice","z":"d37ce6f5.a566d8","name":"ABB Robot WebService","configRef":"","override":"{\"service\":\"\",\"data\":{}}","x":790,"y":220,"wires":[["ecf90557.850f18"]]},{"id":"ecf90557.850f18","type":"change","z":"d37ce6f5.a566d8","name":"get current state","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/rapid/execution","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"GET","tot":"str"},{"t":"set","p":"payload.request.params.json","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":320,"wires":[["309b1d79.804fe2"]]},{"id":"2124cef7.e52282","type":"switch","z":"d37ce6f5.a566d8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"true"},{"t":"eq","v":"0","vt":"num"},{"t":"false"},{"t":"else"}],"checkall":"false","repair":false,"outputs":5,"x":250,"y":200,"wires":[["31297334c20aa008"],["31297334c20aa008"],["7ccf64488a3858fc"],["7ccf64488a3858fc"],["ecf90557.850f18"]]},{"id":"bacad977.00e8a8","type":"change","z":"d37ce6f5.a566d8","name":"filter state","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.response.data._embedded._state[0].ctrlexecstate","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":420,"wires":[["e9109b03.104a28"]]},{"id":"e75577c2.46ef08","type":"change","z":"d37ce6f5.a566d8","name":"if running 1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":480,"wires":[[]]},{"id":"f171c06e.73e2d","type":"change","z":"d37ce6f5.a566d8","name":"else 0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":520,"wires":[[]]},{"id":"e9109b03.104a28","type":"switch","z":"d37ce6f5.a566d8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"running","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":510,"y":500,"wires":[["e75577c2.46ef08"],["f171c06e.73e2d"]]},{"id":"e06ea291.2b6be","type":"abb-robot-webservice","z":"d37ce6f5.a566d8","name":"ABB Robot WebService","configRef":"","override":"{\"service\":\"\",\"data\":{}}","x":790,"y":340,"wires":[["bacad977.00e8a8"]]},{"id":"b4434602.b34138","type":"change","z":"d37ce6f5.a566d8","name":"start","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/rapid/execution","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload.request.params.action","pt":"msg","to":"start","tot":"str"},{"t":"set","p":"payload.request.data.regain","pt":"msg","to":"continue","tot":"str"},{"t":"set","p":"payload.request.data.execmode","pt":"msg","to":"continue","tot":"str"},{"t":"set","p":"payload.request.data.cycle","pt":"msg","to":"forever","tot":"str"},{"t":"set","p":"payload.request.data.condition","pt":"msg","to":"none","tot":"str"},{"t":"set","p":"payload.request.data.stopatbp","pt":"msg","to":"disabled","tot":"str"},{"t":"set","p":"payload.request.data.alltaskbytsp","pt":"msg","to":"false","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":180,"wires":[["f18b1bd.7658de8"]]},{"id":"f18b1bd.7658de8","type":"change","z":"d37ce6f5.a566d8","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":180,"wires":[["45357dad.003364"]]},{"id":"309b1d79.804fe2","type":"change","z":"d37ce6f5.a566d8","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":300,"wires":[["e06ea291.2b6be"]]},{"id":"ba308448e35bf2fa","type":"abb-robot-webservice","z":"d37ce6f5.a566d8","name":"ABB Robot WebService","configRef":"","override":"{\"service\":\"\",\"data\":{}}","x":210,"y":820,"wires":[["8825112cacc4a170"]]},{"id":"00f3a688676718ab","type":"change","z":"d37ce6f5.a566d8","name":"keyless motors on","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/cfg","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload.request.params.action","pt":"msg","to":"keyless","tot":"str"},{"t":"set","p":"payload.request.data.state","pt":"msg","to":"run","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":190,"y":740,"wires":[["b2a360603ec828f1"]]},{"id":"b60b3cbba4a14ecf","type":"comment","z":"d37ce6f5.a566d8","name":"Motors on","info":"","x":100,"y":640,"wires":[]},{"id":"8489f8abb1e2d99c","type":"comment","z":"d37ce6f5.a566d8","name":"PP To Main","info":"","x":110,"y":920,"wires":[]},{"id":"f170906e162b89c7","type":"link in","z":"d37ce6f5.a566d8","name":"","links":["31297334c20aa008"],"x":55,"y":680,"wires":[["fff2a6dddc7c50eb"]]},{"id":"31297334c20aa008","type":"link out","z":"d37ce6f5.a566d8","name":"","links":["f170906e162b89c7"],"x":375,"y":180,"wires":[]},{"id":"e1e41977fe58b245","type":"link out","z":"d37ce6f5.a566d8","name":"","links":["c93b0769beb580b3"],"x":555,"y":1100,"wires":[]},{"id":"c93b0769beb580b3","type":"link in","z":"d37ce6f5.a566d8","name":"","links":["e1e41977fe58b245"],"x":415,"y":180,"wires":[["b4434602.b34138"]]},{"id":"7ccf64488a3858fc","type":"switch","z":"d37ce6f5.a566d8","name":"","property":"stop_at_end_of_cycle","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":395,"y":240,"wires":[["dd4d04e7.ea6888"],["39d7a9b828b844ce"]],"l":false},{"id":"dd4d04e7.ea6888","type":"change","z":"d37ce6f5.a566d8","name":"stop now","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/rapid/execution","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload.request.params.action","pt":"msg","to":"stop","tot":"str"},{"t":"set","p":"payload.request.params.json","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"payload.request.data.stopmode","pt":"msg","to":"stop ","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":220,"wires":[["f18b1bd.7658de8"]]},{"id":"39d7a9b828b844ce","type":"change","z":"d37ce6f5.a566d8","name":"stop cycle","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/rapid/execution","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload.request.params.action","pt":"msg","to":"stop","tot":"str"},{"t":"set","p":"payload.request.params.json","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"payload.request.data.stopmode","pt":"msg","to":"cycle ","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":260,"wires":[["f18b1bd.7658de8"]]},{"id":"fff2a6dddc7c50eb","type":"switch","z":"d37ce6f5.a566d8","name":"If motors_on_on_start is true","property":"motors_on_on_start","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":220,"y":680,"wires":[["00f3a688676718ab"],["a5172da7865a129f"]]},{"id":"d9bf907d9388d362","type":"link in","z":"d37ce6f5.a566d8","name":"","links":["a5172da7865a129f"],"x":55,"y":960,"wires":[["40d7069adee9f1c7"]]},{"id":"a5172da7865a129f","type":"link out","z":"d37ce6f5.a566d8","name":"","links":["d9bf907d9388d362"],"x":555,"y":820,"wires":[]},{"id":"40d7069adee9f1c7","type":"switch","z":"d37ce6f5.a566d8","name":"If pp_to_main_on_start is true","property":"pp_to_main_on_start","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":230,"y":960,"wires":[["6008a7c42b438d61"],["e1e41977fe58b245"]]},{"id":"b2a360603ec828f1","type":"change","z":"d37ce6f5.a566d8","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":780,"wires":[["ba308448e35bf2fa"]]},{"id":"341d03320e0b6451","type":"abb-robot-webservice","z":"d37ce6f5.a566d8","name":"ABB Robot WebService","configRef":"","override":"{\"service\":\"\",\"data\":{}}","x":210,"y":1100,"wires":[["e1e41977fe58b245"]]},{"id":"6008a7c42b438d61","type":"change","z":"d37ce6f5.a566d8","name":"PP to Main","rules":[{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.request.url","pt":"msg","to":"/rw/rapid/execution","tot":"str"},{"t":"set","p":"payload.request.method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload.request.params.action","pt":"msg","to":"resetpp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":170,"y":1020,"wires":[["bf69b3b08b15e9c8"]]},{"id":"bf69b3b08b15e9c8","type":"change","z":"d37ce6f5.a566d8","name":"set conf node id","rules":[{"t":"set","p":"payload.configId","pt":"msg","to":"configId","tot":"env"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":1060,"wires":[["341d03320e0b6451"]]},{"id":"8825112cacc4a170","type":"delay","z":"d37ce6f5.a566d8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":820,"wires":[["a5172da7865a129f"]]},{"id":"4c1c2680a0223274","type":"catch","z":"d37ce6f5.a566d8","name":"","scope":null,"uncaught":true,"x":680,"y":560,"wires":[[]]},{"id":"8cc8582d0338bc30","type":"subflow:8771dc9f224e185f","z":"d37ce6f5.a566d8","name":"","env":[{"name":"configid","value":"configid","type":"env"}],"x":200,"y":80,"wires":[["8cc555a60ed2f9bf"],["2124cef7.e52282"]]},{"id":"31bb49085fa9a495","type":"debug","z":"d37ce6f5.a566d8","name":"","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"error","targetType":"msg","statusVal":"","statusType":"auto","x":1430,"y":80,"wires":[]},{"id":"8cc555a60ed2f9bf","type":"change","z":"d37ce6f5.a566d8","name":"RW7 not yet supported","rules":[{"t":"set","p":"payload","pt":"msg","to":"RW7 not yet supported","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1200,"y":80,"wires":[["31bb49085fa9a495"]]},{"id":"1399baf73ed34903","type":"comment","z":"d37ce6f5.a566d8","name":"RW6 (webservice version 1) implementation","info":"","x":220,"y":140,"wires":[]},{"id":"9d090c4cba603c85","type":"comment","z":"d37ce6f5.a566d8","name":"RW7 (webservice version 2) implementation","info":"","x":1270,"y":40,"wires":[]},{"id":"824a18629a653844","type":"switch","z":"d37ce6f5.a566d8","name":"if subscribed","property":"subscription","propertyType":"env","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":320,"wires":[["ecf90557.850f18"]]},{"id":"3129b0d0623bd4ca","type":"switch","z":"d37ce6f5.a566d8","name":"if subscribed","property":"subscription","propertyType":"env","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":420,"wires":[["5cbb047996e303fa"]]},{"id":"d54c9c030fb2aa09","type":"abb-robot-subscription","z":"d37ce6f5.a566d8","name":"","configRef":"","configId":"configId","configIdType":"env","resource":"/rw/rapid/execution;ctrlexecstate","priority":"1","x":120,"y":420,"wires":[["3129b0d0623bd4ca"]]},{"id":"5cbb047996e303fa","type":"xml","z":"d37ce6f5.a566d8","name":"","property":"payload","attr":"","chr":"","x":310,"y":460,"wires":[["6c789922693132ac"]]},{"id":"078643714411d170","type":"inject","z":"d37ce6f5.a566d8","name":"init","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","x":170,"y":320,"wires":[["824a18629a653844"]]},{"id":"6c789922693132ac","type":"change","z":"d37ce6f5.a566d8","name":"filter state","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.html.body[0].div[0].ul[0].li[0].span[0]._","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":460,"wires":[["e9109b03.104a28"]]},{"id":"bf1285bff85c44e8","type":"comment","z":"d37ce6f5.a566d8","name":"Output 2 for outputting ppToMain Events","info":"","x":200,"y":1280,"wires":[]},{"id":"eefddad4d23e65a2","type":"rbe","z":"d37ce6f5.a566d8","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":110,"y":1420,"wires":[["0b3b495dd259812a"]]},{"id":"0b3b495dd259812a","type":"switch","z":"d37ce6f5.a566d8","name":"if not 0","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":1420,"wires":[["4727dca0ea9aafe6"]]},{"id":"6f6fd2a8823755e5","type":"abb-robot-subscription","z":"d37ce6f5.a566d8","name":"RNL_ppToMain_counter","configRef":"","configId":"configId","configIdType":"env","resource":"/rw/iosystem/signals/RNL_ppToMain_counter;state","priority":"1","x":150,"y":1340,"wires":[["c970381c0af38e85"]]},{"id":"c970381c0af38e85","type":"xml","z":"d37ce6f5.a566d8","name":"","property":"payload","attr":"","chr":"","x":350,"y":1340,"wires":[["e3b3e859de173ebf"]]},{"id":"e3b3e859de173ebf","type":"change","z":"d37ce6f5.a566d8","name":"filter io value","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.html.body[0].div[0].ul[0].li[0].span[0]._","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"$number(msg.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":1340,"wires":[["eefddad4d23e65a2"]]},{"id":"4727dca0ea9aafe6","type":"change","z":"d37ce6f5.a566d8","name":"topic = ppToMain","rules":[{"t":"set","p":"topic","pt":"msg","to":"ppToMain","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":1420,"wires":[[]]},{"id":"4667fa00a3ca6f42","type":"subflow:d37ce6f5.a566d8","z":"9ee8ce904a653061","name":"","env":[{"name":"subscription","type":"bool","value":"true"},{"name":"configId","value":"da1abbd0.b34a88","type":"str"},{"name":"pp_to_main_on_start","type":"bool","value":"true"},{"name":"stop_at_end_of_cycle","type":"bool","value":"true"}],"x":320,"y":140,"wires":[["89220a5ed9e2ece0"],["f01c7c1a2b20e494"]]},{"id":"113435011dd29af5","type":"inject","z":"9ee8ce904a653061","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":110,"y":100,"wires":[["4667fa00a3ca6f42"]]},{"id":"0e8dd80269ebf25c","type":"inject","z":"9ee8ce904a653061","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":110,"y":140,"wires":[["4667fa00a3ca6f42"]]},{"id":"1dfa8d8fbbd62ffa","type":"subflow:cd5b51ab.751ca","z":"9ee8ce904a653061","name":"","env":[{"name":"subscription","type":"bool","value":"true"},{"name":"configId","value":"da1abbd0.b34a88","type":"str"}],"x":310,"y":380,"wires":[["3b9076cea1c907aa"]]},{"id":"33d6e9b67f406552","type":"inject","z":"9ee8ce904a653061","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":110,"y":260,"wires":[["1dfa8d8fbbd62ffa"]]},{"id":"ea096753482f6b8d","type":"inject","z":"9ee8ce904a653061","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"20","payloadType":"num","x":110,"y":300,"wires":[["1dfa8d8fbbd62ffa"]]},{"id":"7ec1a31baf3c8ab1","type":"inject","z":"9ee8ce904a653061","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"40","payloadType":"num","x":110,"y":340,"wires":[["1dfa8d8fbbd62ffa"]]},{"id":"09381486abb16dea","type":"inject","z":"9ee8ce904a653061","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"60","payloadType":"num","x":110,"y":380,"wires":[["1dfa8d8fbbd62ffa"]]},{"id":"f7ba0c5ae250fb6a","type":"inject","z":"9ee8ce904a653061","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"80","payloadType":"num","x":110,"y":420,"wires":[["1dfa8d8fbbd62ffa"]]},{"id":"c62ed48bad63b33f","type":"inject","z":"9ee8ce904a653061","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"100","payloadType":"num","x":110,"y":460,"wires":[["1dfa8d8fbbd62ffa"]]},{"id":"ca1661bf2621c927","type":"subflow:7fe2370ff54129e9","z":"9ee8ce904a653061","name":"","env":[{"name":"subscription","type":"bool","value":"true"},{"name":"configId","value":"da1abbd0.b34a88","type":"str"}],"x":320,"y":580,"wires":[["7e666407d99b5587","02424d4ef27f0117","9eeface07a391df5","2e95d961b54c2831","f8f788e204c466e5","2f644e3a11bd80cc","7d03e6b763132cd5","193a8e473e7a1534"]]},{"id":"46592cac39a78034","type":"inject","z":"9ee8ce904a653061","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":110,"y":580,"wires":[["ca1661bf2621c927"]]},{"id":"9543e54d74e11bfa","type":"subflow:983802a68453d50b","z":"9ee8ce904a653061","name":"","env":[{"name":"configId","value":"da1abbd0.b34a88","type":"str"}],"x":310,"y":940,"wires":[["ef445e0ee7276fcc"]]},{"id":"367aa25a02f32e2e","type":"inject","z":"9ee8ce904a653061","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":110,"y":940,"wires":[["9543e54d74e11bfa"]]},{"id":"9a3a5ab679b0be96","type":"subflow:48c858d0b6016e60","z":"9ee8ce904a653061","name":"","env":[{"name":"configId","value":"da1abbd0.b34a88","type":"str"}],"x":320,"y":1000,"wires":[["fac3453c21be04c4"]]},{"id":"81ae64ce9dbce631","type":"inject","z":"9ee8ce904a653061","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":110,"y":1000,"wires":[["9a3a5ab679b0be96"]]},{"id":"89220a5ed9e2ece0","type":"debug","z":"9ee8ce904a653061","name":"start/stop","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":560,"y":120,"wires":[]},{"id":"3b9076cea1c907aa","type":"debug","z":"9ee8ce904a653061","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":550,"y":380,"wires":[]},{"id":"193a8e473e7a1534","type":"debug","z":"9ee8ce904a653061","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":550,"y":460,"wires":[]},{"id":"ef445e0ee7276fcc","type":"debug","z":"9ee8ce904a653061","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":550,"y":940,"wires":[]},{"id":"fac3453c21be04c4","type":"debug","z":"9ee8ce904a653061","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":550,"y":1000,"wires":[]},{"id":"d41f28440f4a0127","type":"abb-robot-webservice","z":"9ee8ce904a653061","name":"ABB Robot WebService","encrypt":false,"configRef":"da1abbd0.b34a88","override":"{\"service\":\"\",\"data\":{},\"api\":\"\",\"method\":\"\",\"Orginalpath\":\"\",\"webServicePs\":{},\"webServiceQs\":{}}","x":310,"y":60,"wires":[[]]},{"id":"ea39d06073573775","type":"subflow:1c8b3f7678bc98b1","z":"9ee8ce904a653061","name":"","env":[{"name":"subscription","type":"bool","value":"true"},{"name":"configId","value":"da1abbd0.b34a88","type":"str"}],"x":310,"y":820,"wires":[["f556d956bdd88cb6","4d705cbc545e5d4b","6c1e438ee4f4ee86","84f295e8be6c5aae","6ad8318773119368","b1c7c3a03e2f3764","5b4959c665fe5ffc","1dcaf929215cf65d"]]},{"id":"c69a898215e72485","type":"inject","z":"9ee8ce904a653061","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":110,"y":820,"wires":[["ea39d06073573775"]]},{"id":"1dcaf929215cf65d","type":"debug","z":"9ee8ce904a653061","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":550,"y":700,"wires":[]},{"id":"f556d956bdd88cb6","type":"switch","z":"9ee8ce904a653061","name":"init","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"init","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":760,"wires":[[]],"outputLabels":["The robot is starting up. It will shift to state motors off when it has started."],"info":"The robot is starting up. It will shift to state motors off when it has started.\r\n\r\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_ctrlstate_get_page.html"},{"id":"7e666407d99b5587","type":"switch","z":"9ee8ce904a653061","name":"INIT","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"INIT","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":520,"wires":[[]],"outputLabels":["State init"],"info":"State init\n\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_opmode_get_page.html"},{"id":"02424d4ef27f0117","type":"switch","z":"9ee8ce904a653061","name":"AUTO_CH","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"AUTO_CH","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":540,"wires":[[]],"outputLabels":["State change request for automatic mode"],"info":"State change request for automatic mode\n\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_opmode_get_page.html"},{"id":"9eeface07a391df5","type":"switch","z":"9ee8ce904a653061","name":"MANF_CH","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"MANF_CH","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":560,"wires":[[]],"outputLabels":["State change request for manual mode & full speed"],"info":"State change request for manual mode & full speed\n\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_opmode_get_page.html"},{"id":"2e95d961b54c2831","type":"switch","z":"9ee8ce904a653061","name":"MANR","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"MANR","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":580,"wires":[[]],"outputLabels":["State manual mode & reduced speed"],"info":"State manual mode & reduced speed\n\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_opmode_get_page.html"},{"id":"f8f788e204c466e5","type":"switch","z":"9ee8ce904a653061","name":"MANF","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"MANF","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":600,"wires":[[]],"outputLabels":["State manual mode & full speed"],"info":"State manual mode & full speed\n\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_opmode_get_page.html"},{"id":"2f644e3a11bd80cc","type":"switch","z":"9ee8ce904a653061","name":"AUTO","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"AUTO","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":620,"wires":[[]],"outputLabels":["State automatic mode"],"info":"State automatic mode\n\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_opmode_get_page.html"},{"id":"7d03e6b763132cd5","type":"switch","z":"9ee8ce904a653061","name":"UNDEF","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"UNDEF","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":560,"y":640,"wires":[[]],"outputLabels":["Undefined"],"info":"Undefined\n\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_opmode_get_page.html"},{"id":"4d705cbc545e5d4b","type":"switch","z":"9ee8ce904a653061","name":"motoroff","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"motoroff","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":560,"y":780,"wires":[[]],"outputLabels":["The robot is in a standby state where there is no power to the robot's motors. The state has to be shifted to motors on before the robot can move."],"info":"The robot is in a standby state where there is no power to the robot's motors. The state has to be shifted to motors on before the robot can move.\r\n\r\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_ctrlstate_get_page.html"},{"id":"6c1e438ee4f4ee86","type":"switch","z":"9ee8ce904a653061","name":"motoron","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"motoron","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":560,"y":800,"wires":[[]],"outputLabels":["The robot is ready to move, either by jogging or by running programs."],"info":"The robot is ready to move, either by jogging or by running programs.\r\n\r\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_ctrlstate_get_page.html"},{"id":"84f295e8be6c5aae","type":"switch","z":"9ee8ce904a653061","name":"guardstop","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"guardstop","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":560,"y":820,"wires":[[]],"outputLabels":["The robot is stopped because the safety runchain is opened. For instance, a door to the robot's cell might be open."],"info":"The robot is stopped because the safety runchain is opened. For instance, a door to the robot's cell might be open.\n\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_ctrlstate_get_page.html"},{"id":"6ad8318773119368","type":"switch","z":"9ee8ce904a653061","name":"emergencystop","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"emergencystop","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":580,"y":840,"wires":[[]],"outputLabels":["The robot is stopped because emergency stop was activated."],"info":"The robot is stopped because emergency stop was activated.\r\n\r\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_ctrlstate_get_page.html"},{"id":"b1c7c3a03e2f3764","type":"switch","z":"9ee8ce904a653061","name":"emergencystopreset","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"emergencystopreset","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":600,"y":860,"wires":[[]],"outputLabels":["The robot is ready to leave emergency stop state. The emergency stop is no longer activated, but the state transition isn't yet confirmed."],"info":"The robot is ready to leave emergency stop state. The emergency stop is no longer activated, but the state transition isn't yet confirmed.\r\n\r\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_ctrlstate_get_page.html"},{"id":"5b4959c665fe5ffc","type":"switch","z":"9ee8ce904a653061","name":"sysfail","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"sysfail","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":880,"wires":[[]],"outputLabels":["The robot is in a system failure state. Restart required."],"info":"The robot is in a system failure state. Restart required.\r\n\r\nhttps://developercenter.robotstudio.com/api/rwsApi/panel_ctrlstate_get_page.html"},{"id":"f2cc718a8276805f","type":"subflow:8771dc9f224e185f","z":"9ee8ce904a653061","name":"","env":[{"name":"configid","value":"da1abbd0.b34a88","type":"str"}],"x":340,"y":1100,"wires":[["0011f6d685ab45ac"],["ff1deb0e954a5c55"]]},{"id":"0011f6d685ab45ac","type":"debug","z":"9ee8ce904a653061","name":"RW7","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":550,"y":1080,"wires":[]},{"id":"ff1deb0e954a5c55","type":"debug","z":"9ee8ce904a653061","name":"RW6","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":550,"y":1120,"wires":[]},{"id":"61313f3954c5972f","type":"inject","z":"9ee8ce904a653061","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":110,"y":1100,"wires":[["f2cc718a8276805f"]]},{"id":"460b18018bf93bcb","type":"inject","z":"9ee8ce904a653061","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":110,"y":180,"wires":[["4667fa00a3ca6f42"]]},{"id":"c7b0aff1576b11a8","type":"inject","z":"9ee8ce904a653061","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":110,"y":500,"wires":[["1dfa8d8fbbd62ffa"]]},{"id":"586fa85c818e6d5e","type":"subflow:2f0cb7c7.dd9f18","z":"9ee8ce904a653061","name":"","env":[],"x":780,"y":1240,"wires":[[]]},{"id":"df368158de64882d","type":"subflow:6df522bdaa65197a","z":"9ee8ce904a653061","name":"","env":[],"x":190,"y":1480,"wires":[]},{"id":"7bec53bf7c9b6745","type":"subflow:64cf9052855ab599","z":"9ee8ce904a653061","name":"","env":[],"x":430,"y":1480,"wires":[[]]},{"id":"a3b6dd4d0f27f815","type":"subflow:990942449cfdbb29","z":"9ee8ce904a653061","name":"","env":[],"x":180,"y":1540,"wires":[[]]},{"id":"7e0865c5f759bc10","type":"subflow:ce24bd14b3c41949","z":"9ee8ce904a653061","name":"","env":[],"x":245,"y":1580,"wires":[[]],"l":false},{"id":"1321c382dd92514e","type":"debug","z":"9ee8ce904a653061","name":"pp to main","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":570,"y":180,"wires":[]},{"id":"f01c7c1a2b20e494","type":"subflow:ce24bd14b3c41949","z":"9ee8ce904a653061","name":"","env":[],"x":455,"y":180,"wires":[["1321c382dd92514e"]],"l":false},{"id":"40edd521c5976937","type":"subflow:d37ce6f5.a566d8","z":"9ee8ce904a653061","name":"","env":[{"name":"subscription","type":"bool","value":"true"},{"name":"configId","value":"da1abbd0.b34a88","type":"str"},{"name":"pp_to_main_on_start","type":"bool","value":"true"},{"name":"stop_at_end_of_cycle","type":"bool","value":"true"}],"x":320,"y":280,"wires":[[],["7274f04b7658b32d"]]},{"id":"f99d290fb37195bf","type":"debug","z":"9ee8ce904a653061","name":"pp to main","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":570,"y":280,"wires":[]},{"id":"7274f04b7658b32d","type":"subflow:ce24bd14b3c41949","z":"9ee8ce904a653061","name":"","env":[],"x":455,"y":280,"wires":[["f99d290fb37195bf"]],"l":false},{"id":"a4a42cfd4ee6f077","type":"subflow:d4cb3f70d0c4b27a","z":"9ee8ce904a653061","name":"","env":[{"name":"configId","value":"402fec382b9de7df","type":"str"}],"x":340,"y":1340,"wires":[["6cc97843f3821c00"]]},{"id":"6cc97843f3821c00","type":"debug","z":"9ee8ce904a653061","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload.color","targetType":"msg","statusVal":"payload.color","statusType":"msg","x":590,"y":1340,"wires":[]},{"id":"083b65cf1a7303bb","type":"change","z":"9ee8ce904a653061","name":"","rules":[{"t":"set","p":"payload.frequency","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"payload.color","pt":"msg","to":"#666666","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":1600,"wires":[[]]},{"id":"c00fa1afc0d43391","type":"inject","z":"9ee8ce904a653061","name":"Purple","props":[{"p":"payload.frequency","v":"0","vt":"num"},{"p":"payload.color","v":"#FF00FF","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":110,"y":1320,"wires":[["a4a42cfd4ee6f077"]]},{"id":"3a40281b99f2079f","type":"inject","z":"9ee8ce904a653061","name":"Purple, blink","props":[{"p":"payload.frequency","v":"2","vt":"num"},{"p":"payload.color","v":"#FF00FF","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":130,"y":1360,"wires":[["a4a42cfd4ee6f077"]]},{"id":"7910f53158a03517","type":"abb-robot-command-builder","z":"9ee8ce904a653061","tasks":"T_ROB1","modules":"RNL_B_ping","hiddenProcedures":"","hiddenResult":"{\"name\":\"ping\",\"args\":[],\"comment\":\"    !This module implements ping procedures for pinging a robot through RMQ\",\"inValid\":false}","configRef":"402fec382b9de7df","include":true,"x":360,"y":1240,"wires":[["f28bced411470c8b"]]},{"id":"99e90bb7ecd76fbd","type":"inject","z":"9ee8ce904a653061","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":110,"y":1240,"wires":[["7910f53158a03517"]]},{"id":"ce471e2c6b8d6b02","type":"debug","z":"9ee8ce904a653061","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":170,"y":1640,"wires":[]},{"id":"f868878b11a85eba","type":"debug","z":"9ee8ce904a653061","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":380,"y":1680,"wires":[]},{"id":"f28bced411470c8b","type":"abb-robot-rmq","z":"9ee8ce904a653061","name":"ABB Robot RMQ","sourceQueue":"RMQ_PS_TEST_QUEUE","configRef":"402fec382b9de7df","x":590,"y":1240,"wires":[["586fa85c818e6d5e"]]},{"id":"94f60386ba5869b4","type":"abb-robot-io","z":"9ee8ce904a653061","name":"ABB Robot IO","configRef":"402fec382b9de7df","subscribe":true,"x":750,"y":1680,"wires":[[]]},{"id":"6186ebc5421eeca8","type":"abb-robot-webservice","z":"9ee8ce904a653061","name":"ABB Robot WebService","encrypt":true,"configRef":"173b45e8cc68049e","override":"{\"service\":\"RAPID_Service.yaml\",\"data\":{},\"api\":\"/rw/rapid/tasks/activate#post\",\"method\":\"post\",\"Orginalpath\":\"/rw/rapid/tasks/activate#post\",\"webServicePs\":{},\"webServiceQs\":{}}","x":620,"y":1860,"wires":[[]]},{"id":"219f18749f85381e","type":"abb-robot-command-builder","z":"9ee8ce904a653061","tasks":"T_ROB1","modules":"mainModule","hiddenProcedures":"on_exampleEvent","hiddenResult":"{\"name\":\"on_exampleEvent\",\"args\":[\"dataPointer einfo\"],\"comment\":\"    !===========================================================================\",\"argList\":[{\"error\":false,\"type\":\"dataPointer\",\"name\":\"einfo\"}],\"inValid\":false}","configRef":"173b45e8cc68049e","include":false,"x":750,"y":1520,"wires":[[]]},{"id":"af2b508d.54765","type":"abb-robot-rmq","z":"20360fb.e015af","name":"ABB Robot RMQ 2","sourceQueue":"RMQ_CARROT","configRef":"505dee9d.0ca44","x":1410,"y":180,"wires":[["2f8e5284.681d2e"]]},{"id":"14d195cd.29289a","type":"change","z":"20360fb.e015af","name":"T_ROB_L .","rules":[{"t":"set","p":"topic","pt":"msg","to":"T_ROB_L","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":100,"wires":[["4f45ec6f.c198c4"]]},{"id":"42284f9b.a7cea","type":"change","z":"20360fb.e015af","name":"T_ROB_R .","rules":[{"t":"set","p":"topic","pt":"msg","to":"T_ROB_R","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":140,"wires":[["4f45ec6f.c198c4"]]},{"id":"b1e0bdbd.eddbe","type":"abb-robot-io","z":"20360fb.e015af","name":"ABB Robot IO","configRef":"173b45e8cc68049e","subscribe":true,"x":280,"y":560,"wires":[["513b6121.d9038"]]},{"id":"513b6121.d9038","type":"change","z":"20360fb.e015af","name":"trigger","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"trigger","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":560,"wires":[["b7f578ae.a5b318"]]},{"id":"b7f578ae.a5b318","type":"q-gate","z":"20360fb.e015af","name":"robot queue","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"storeName":"memory","x":550,"y":540,"wires":[["de18269e.743a18"]]},{"id":"26c43f80.ede64","type":"abb-robot-rmq","z":"20360fb.e015af","name":"Left Arm","sourceQueue":"RMQ_CARROT","configRef":"505dee9d.0ca44","x":620,"y":440,"wires":[[]]},{"id":"de18269e.743a18","type":"abb-robot-command-builder","z":"20360fb.e015af","tasks":"T_ROB_L","modules":"board","hiddenProcedures":"","hiddenResult":"{\"name\":\"board_move_\",\"args\":[\"dataPointer origin\",\"dataPointer destination\"],\"argList\":[{\"error\":false,\"type\":\"dataPointer\",\"name\":\"origin\"},{\"error\":false,\"type\":\"dataPointer\",\"name\":\"destination\"}],\"inValid\":false}","configRef":"da1abbd0.b34a88","include":false,"x":620,"y":400,"wires":[["26c43f80.ede64"]]},{"id":"96dcbfb1.41b47","type":"abb-robot-io","z":"20360fb.e015af","name":"ABB Robot IO","configRef":"173b45e8cc68049e","subscribe":true,"x":980,"y":560,"wires":[["ca447a0f.700cb8"]]},{"id":"ca447a0f.700cb8","type":"change","z":"20360fb.e015af","name":"trigger","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"trigger","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":560,"wires":[["3e1174c5.d52c8c"]]},{"id":"3e1174c5.d52c8c","type":"q-gate","z":"20360fb.e015af","name":"robot queue","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"storeName":"memory","x":1270,"y":540,"wires":[["e0e8d629.9a5ca8"]]},{"id":"e0e8d629.9a5ca8","type":"abb-robot-rmq","z":"20360fb.e015af","name":"ABB Robot RMQ 2","sourceQueue":"RMQ_CARROT","configRef":"505dee9d.0ca44","x":1450,"y":540,"wires":[[]]},{"id":"9f9bc083.247e9","type":"abb-robot-command-builder","z":"20360fb.e015af","tasks":"T_ROB_L","modules":"board","hiddenProcedures":"","hiddenResult":"{\"name\":\"board_move_\",\"args\":[\"dataPointer origin\",\"dataPointer destination\"],\"argList\":[{\"error\":false,\"type\":\"dataPointer\",\"name\":\"origin\"},{\"error\":false,\"type\":\"dataPointer\",\"name\":\"destination\"}],\"inValid\":false}","configRef":"da1abbd0.b34a88","include":false,"x":1060,"y":520,"wires":[["3e1174c5.d52c8c"]]},{"id":"faf847e.5c0a7b8","type":"abb-robot-rmq","z":"20360fb.e015af","name":"Left Arm","sourceQueue":"RMQ_CARROT","configRef":"505dee9d.0ca44","x":260,"y":720,"wires":[[]]},{"id":"9026c52e.e667e8","type":"abb-robot-command-builder","z":"20360fb.e015af","tasks":"T_ROB_L","modules":"board","hiddenProcedures":"","hiddenResult":"{\"name\":\"board_move_\",\"args\":[\"dataPointer origin\",\"dataPointer destination\"],\"argList\":[{\"error\":false,\"type\":\"dataPointer\",\"name\":\"origin\"},{\"error\":false,\"type\":\"dataPointer\",\"name\":\"destination\"}],\"inValid\":false}","configRef":"da1abbd0.b34a88","include":false,"x":175,"y":720,"wires":[["faf847e.5c0a7b8"]],"l":false},{"id":"45270cbd.a1fc94","type":"abb-robot-rmq","z":"20360fb.e015af","name":"Right Arm","sourceQueue":"RMQ_CARROT","configRef":"505dee9d.0ca44","x":260,"y":820,"wires":[[]]},{"id":"b6bd648c.a49d98","type":"abb-robot-command-builder","z":"20360fb.e015af","tasks":"T_ROB_L","modules":"board","hiddenProcedures":"","hiddenResult":"{\"name\":\"board_move_\",\"args\":[\"dataPointer origin\",\"dataPointer destination\"],\"argList\":[{\"error\":false,\"type\":\"dataPointer\",\"name\":\"origin\"},{\"error\":false,\"type\":\"dataPointer\",\"name\":\"destination\"}],\"inValid\":false}","configRef":"da1abbd0.b34a88","include":false,"x":175,"y":820,"wires":[["45270cbd.a1fc94"]],"l":false},{"id":"5d5cee7a.521f9","type":"split","z":"20360fb.e015af","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":410,"y":120,"wires":[["f0774f2d.03855"]]},{"id":"758ce21.2dbb81c","type":"switch","z":"20360fb.e015af","name":"Robot L or R","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"","vt":"str"},{"t":"eq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":655,"y":120,"wires":[["14d195cd.29289a"],["42284f9b.a7cea"]],"l":false},{"id":"a7d45487.74dce8","type":"abb-robot-command-builder","z":"20360fb.e015af","tasks":"T_ROB_L","modules":"board","hiddenProcedures":"","hiddenResult":"{\"name\":\"board_move_\",\"args\":[\"dataPointer origin\",\"dataPointer destination\"],\"argList\":[{\"error\":false,\"type\":\"dataPointer\",\"name\":\"origin\"},{\"error\":false,\"type\":\"dataPointer\",\"name\":\"destination\"}],\"inValid\":false}","configRef":"da1abbd0.b34a88","include":false,"x":1295,"y":140,"wires":[["86186e66.b8607"]],"l":false},{"id":"2e17d24d.e27e7e","type":"abb-robot-command-builder","z":"20360fb.e015af","tasks":"T_ROB_L","modules":"board","hiddenProcedures":"","hiddenResult":"{\"name\":\"board_move_\",\"args\":[\"dataPointer origin\",\"dataPointer destination\"],\"argList\":[{\"error\":false,\"type\":\"dataPointer\",\"name\":\"origin\"},{\"error\":false,\"type\":\"dataPointer\",\"name\":\"destination\"}],\"inValid\":false}","configRef":"da1abbd0.b34a88","include":false,"x":1295,"y":180,"wires":[["af2b508d.54765"]],"l":false},{"id":"1e9a3e37.ad88b2","type":"link in","z":"20360fb.e015af","name":"","links":["2f8e5284.681d2e"],"x":395,"y":200,"wires":[["79fb7a61.f8e454"]]},{"id":"2f8e5284.681d2e","type":"link out","z":"20360fb.e015af","name":"","links":["1e9a3e37.ad88b2"],"x":1535,"y":160,"wires":[]},{"id":"f0774f2d.03855","type":"delay","z":"20360fb.e015af","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":550,"y":120,"wires":[["758ce21.2dbb81c"]]},{"id":"3223e328.0db65c","type":"switch","z":"20360fb.e015af","name":" T_ROB_L \\n  T_ROB_R","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"T_ROB_L","vt":"str"},{"t":"eq","v":"T_ROB_R","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1190,"y":160,"wires":[["a7d45487.74dce8"],["2e17d24d.e27e7e"]]},{"id":"caca866f.fb3878","type":"inject","z":"20360fb.e015af","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":290,"y":500,"wires":[[]]},{"id":"2b477c05.219ff4","type":"inject","z":"20360fb.e015af","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":890,"y":420,"wires":[[]]},{"id":"4f45ec6f.c198c4","type":"q-gate","z":"20360fb.e015af","name":"Command Queue","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"storeName":"memory","x":990,"y":160,"wires":[["1711b44c.97a6dc","3223e328.0db65c"]]},{"id":"7b54c17d.86755","type":"delay","z":"20360fb.e015af","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":160,"y":460,"wires":[[]]},{"id":"98d022b5.57e19","type":"status","z":"20360fb.e015af","name":"q-gate status","scope":["c54e919c.18d7f","4f45ec6f.c198c4"],"x":970,"y":220,"wires":[["8b4138fe.040e38"]]},{"id":"8b4138fe.040e38","type":"change","z":"20360fb.e015af","name":"find queue lenght","rules":[{"t":"set","p":"payload","pt":"msg","to":"status.text","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1010,"y":260,"wires":[["745bf727.7d8938"]]},{"id":"745bf727.7d8938","type":"change","z":"20360fb.e015af","name":"set flow.robotQueueLenght","rules":[{"t":"set","p":"robotQueueLenght","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":300,"wires":[[]]},{"id":"79fb7a61.f8e454","type":"switch","z":"20360fb.e015af","name":"use flow.robotQueueLenght \\n if queue is empty, open gate, \\n other wise trigger next element","property":"robotQueueLenght","propertyType":"flow","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":570,"y":200,"wires":[["eec8d6ab.cc2ad8"],["3e9d36aa.96785a"]]},{"id":"eec8d6ab.cc2ad8","type":"change","z":"20360fb.e015af","name":"trigger","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"trigger","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":180,"wires":[["4f45ec6f.c198c4"]]},{"id":"3e9d36aa.96785a","type":"change","z":"20360fb.e015af","name":"open","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":220,"wires":[["4f45ec6f.c198c4"]]},{"id":"1711b44c.97a6dc","type":"change","z":"20360fb.e015af","name":"close/queue","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"queue","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":120,"wires":[["4f45ec6f.c198c4"]]},{"id":"b5f3f5c1.022a28","type":"abb-robot-rmq","z":"665b6023.30434","name":"ABB Robot RMQ L","sourceQueue":"RMQ_CARROT","configRef":"da1abbd0.b34a88","x":1430,"y":220,"wires":[["6a48cc8f.d7c9a4"]]},{"id":"c7aa0428.3e4658","type":"abb-robot-rmq","z":"665b6023.30434","name":"ABB Robot RMQ R","sourceQueue":"RMQ_CARROT","configRef":"aecec50a.75023","x":1430,"y":260,"wires":[["6a48cc8f.d7c9a4"]]},{"id":"6d4ec23e.c0c6cc","type":"change","z":"665b6023.30434","name":"T_ROB_L .","rules":[{"t":"set","p":"topic","pt":"msg","to":"T_ROB_L","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":180,"wires":[["e414f09f.76046"]]},{"id":"acf9a60c.8d7138","type":"change","z":"665b6023.30434","name":"T_ROB_R .","rules":[{"t":"set","p":"topic","pt":"msg","to":"T_ROB_R","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":220,"wires":[["e414f09f.76046"]]},{"id":"49653f12.5b126","type":"split","z":"665b6023.30434","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":430,"y":200,"wires":[["7038f85f.884d58"]]},{"id":"920a72ef.9b27e","type":"switch","z":"665b6023.30434","name":"Robot L or R","property":"payload.robot","propertyType":"msg","rules":[{"t":"eq","v":"T_ROB_L","vt":"str"},{"t":"eq","v":"T_ROB_R","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":675,"y":200,"wires":[["6d4ec23e.c0c6cc"],["acf9a60c.8d7138"]],"l":false},{"id":"ee417ac.078b688","type":"abb-robot-command-builder","z":"665b6023.30434","tasks":"T_ROB_L","modules":"board","hiddenProcedures":"board_move_","hiddenResult":"{\"name\":\"board_move_\",\"args\":[\"dataPointer origin\",\"dataPointer destination\"],\"argList\":[{\"error\":false,\"type\":\"dataPointer\",\"name\":\"origin\"},{\"error\":false,\"type\":\"dataPointer\",\"name\":\"destination\"}],\"inValid\":false}","configRef":"da1abbd0.b34a88","include":false,"x":1315,"y":220,"wires":[["b5f3f5c1.022a28","b534c592.e90458"]],"l":false},{"id":"18e58b08.fe5ae5","type":"abb-robot-command-builder","z":"665b6023.30434","tasks":"T_ROB_L","modules":"board","hiddenProcedures":"","hiddenResult":"{\"name\":\"board_move_\",\"args\":[\"dataPointer origin\",\"dataPointer destination\"],\"argList\":[{\"error\":false,\"type\":\"dataPointer\",\"name\":\"origin\"},{\"error\":false,\"type\":\"dataPointer\",\"name\":\"destination\"}],\"inValid\":false}","configRef":"da1abbd0.b34a88","include":false,"x":1315,"y":260,"wires":[["c7aa0428.3e4658"]],"l":false},{"id":"350c5846.e69368","type":"link in","z":"665b6023.30434","name":"","links":["6a48cc8f.d7c9a4"],"x":415,"y":280,"wires":[["5103a58c.47afac"]]},{"id":"6a48cc8f.d7c9a4","type":"link out","z":"665b6023.30434","name":"","links":["350c5846.e69368"],"x":1575,"y":240,"wires":[]},{"id":"7038f85f.884d58","type":"delay","z":"665b6023.30434","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":570,"y":200,"wires":[["920a72ef.9b27e"]]},{"id":"db815184.074f9","type":"switch","z":"665b6023.30434","name":" T_ROB_L \\n  T_ROB_R","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"T_ROB_L","vt":"str"},{"t":"eq","v":"T_ROB_R","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1210,"y":240,"wires":[["ee417ac.078b688"],["18e58b08.fe5ae5"]]},{"id":"e414f09f.76046","type":"q-gate","z":"665b6023.30434","name":"Command Queue","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"storeName":"memory","x":1010,"y":240,"wires":[["7b3718e7.5a3b48","db815184.074f9","123a1bc1.708384"]]},{"id":"c28b7ffa.7af6a","type":"status","z":"665b6023.30434","name":"q-gate status","scope":["c54e919c.18d7f","e414f09f.76046"],"x":990,"y":300,"wires":[["4bd078db.53f908"]]},{"id":"4bd078db.53f908","type":"change","z":"665b6023.30434","name":"find queue lenght","rules":[{"t":"set","p":"payload","pt":"msg","to":"$substring(msg.status.text,9)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":340,"wires":[["85159eb9.a6f858"]]},{"id":"df1fceac.a9fa9","type":"change","z":"665b6023.30434","name":"set flow.robotQueueLenght","rules":[{"t":"set","p":"robotQueueLenght","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1280,"y":380,"wires":[[]]},{"id":"5103a58c.47afac","type":"switch","z":"665b6023.30434","name":"use flow.robotQueueLenght \\n if queue is empty, open gate, \\n other wise trigger next element","property":"robotQueueLenght","propertyType":"flow","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":280,"wires":[["2f894343.fb55ac"],["27d4e6b3.94a97a"]]},{"id":"2f894343.fb55ac","type":"change","z":"665b6023.30434","name":"trigger","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"trigger","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":260,"wires":[["e414f09f.76046"]]},{"id":"27d4e6b3.94a97a","type":"change","z":"665b6023.30434","name":"open","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":300,"wires":[["e414f09f.76046"]]},{"id":"7b3718e7.5a3b48","type":"change","z":"665b6023.30434","name":"close/queue","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"queue","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1010,"y":200,"wires":[["e414f09f.76046"]]},{"id":"a4c17bf0.a09618","type":"link in","z":"665b6023.30434","name":"Input","links":["a0b59504.e48db8"],"x":290,"y":200,"wires":[["49653f12.5b126"]],"l":true},{"id":"a0b59504.e48db8","type":"link out","z":"ee39c607.e74858","name":"Send to Robot","links":["a4c17bf0.a09618"],"x":1740,"y":380,"wires":[],"l":true},{"id":"94519772.587148","type":"inject","z":"665b6023.30434","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":250,"y":440,"wires":[["e414f09f.76046"]]},{"id":"10ba612.37abe1f","type":"inject","z":"665b6023.30434","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":230,"y":400,"wires":[["5103a58c.47afac"]]},{"id":"85159eb9.a6f858","type":"switch","z":"665b6023.30434","name":"is number?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":1210,"y":340,"wires":[["d9badf17.58f1e"]]},{"id":"d9badf17.58f1e","type":"change","z":"665b6023.30434","name":"convert to number","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(msg.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":380,"wires":[["df1fceac.a9fa9"]]},{"id":"123a1bc1.708384","type":"debug","z":"665b6023.30434","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1220,"y":160,"wires":[]},{"id":"b534c592.e90458","type":"debug","z":"665b6023.30434","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1440,"y":160,"wires":[]},{"id":"42efd9a9.8f2878","type":"function","z":"ee39c607.e74858","name":"Chessboard Visualizer V2","func":"var positions = msg.payload;\n\nvar messageArray = [];\nvar boardArray = new Array(\n\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"h7\",\"h8\",\n\"g1\",\"g2\",\"g3\",\"g4\",\"g5\",\"g6\",\"g7\",\"g8\",\n\"f1\",\"f2\",\"f3\",\"f4\",\"f5\",\"f6\",\"f7\",\"f8\",\n\"e1\",\"e2\",\"e3\",\"e4\",\"e5\",\"e6\",\"e7\",\"e8\",\n\"d1\",\"d2\",\"d3\",\"d4\",\"d5\",\"d6\",\"d7\",\"d8\",\n\"c1\",\"c2\",\"c3\",\"c4\",\"c5\",\"c6\",\"c7\",\"c8\",\n\"b1\",\"b2\",\"b3\",\"b4\",\"b5\",\"b6\",\"b7\",\"b8\",\n\"a1\",\"a2\",\"a3\",\"a4\",\"a5\",\"a6\",\"a7\",\"a8\",);\n\nfor(var i = 0; i < 64; i++)\n{\n    var path = \"/assets/\" + positions[i] + \".png\";\n    var topicString = \".chess-board .\" + boardArray[i].toString();\n    messageArray.push({filename: path, topic : topicString});\n}\n\nreturn [messageArray];","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":210,"y":900,"wires":[["1d4ce299.bec34d"]]},{"id":"1ede199d.f08406","type":"template","z":"ee39c607.e74858","name":"Image in","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<img src='data:image/png;base64, {{payload}}' width = \"70\" height = \"70\"/>","output":"str","x":160,"y":1020,"wires":[["51065ea3.078848"]]},{"id":"c026d0c5.596058","type":"base64","z":"ee39c607.e74858","name":"Base64 converter","action":"","property":"payload","x":190,"y":980,"wires":[["1ede199d.f08406"]]},{"id":"51065ea3.078848","type":"ui_template","z":"ee39c607.e74858","group":"bd4d1aa4.f3c048","name":"Chessboard table","order":1,"width":"12","height":"12","format":"<style>\n    table.chess-board {\n        border-spacing: 0px;\n        border-width: 1px;\n    }\n    table.chess-board td {\n        border: 1px solid black;\n        padding: 0px;\n        width: 55px;\n        height: 55px;\n        font-size: 30px;\n        text-align: center;\n        vertical-align: middle;\n    }\n    .chess-board td.light {\n        background-color: #f5f5f5;\n    }\n    .chess-board td.dark {\n        background-color: #7d4b00;\n    }\n</style>\n\n<table class=\"chess-board\">\n    <tr class=\"a\">\n        <td class=\"a1 light\"></td> <td class=\"a2 dark\"></td>\n        <td class=\"a3 light\"></td> <td class=\"a4 dark\"></td>\n        <td class=\"a5 light\"></td> <td class=\"a6 dark\"></td>\n        <td class=\"a7 light\"></td> <td class=\"a8 dark\"></td>\n    </tr>\n    <tr class=\"b\">\n        <td class=\"b1 dark\"></td> <td class=\"b2 light\"></td>\n        <td class=\"b3 dark\"></td> <td class=\"b4 light\"></td>\n        <td class=\"b5 dark\"></td> <td class=\"b6 light\"></td>\n        <td class=\"b7 dark\"></td> <td class=\"b8 light\"></td>\n    </tr>\n    <tr class=\"c\">\n        <td class=\"c1 light\"></td> <td class=\"c2 dark\"></td>\n        <td class=\"c3 light\"></td> <td class=\"c4 dark\"></td>\n        <td class=\"c5 light\"></td> <td class=\"c6 dark\"></td>\n        <td class=\"c7 light\"></td> <td class=\"c8 dark\"></td>\n    </tr>\n    <tr class=\"d\">\n        <td class=\"d1 dark\"></td> <td class=\"d2 light\"></td>\n        <td class=\"d3 dark\"></td> <td class=\"d4 light\"></td> \n        <td class=\"d5 dark\"></td> <td class=\"d6 light\"></td>\n        <td class=\"d7 dark\"></td> <td class=\"d8 light\"></td>\n    </tr>\n    <tr class=\"e\">\n        <td class=\"e1 light\"></td> <td class=\"e2 dark\"></td>\n        <td class=\"e3 light\"></td> <td class=\"e4 dark\"></td>\n        <td class=\"e5 light\"></td> <td class=\"e6 dark\"></td>\n        <td class=\"e7 light\"></td> <td class=\"e8 dark\"></td>\n    </tr>\n    <tr class=\"f\">\n        <td class=\"f1 dark\"></td> <td class=\"f2 light\"></td>\n        <td class=\"f3 dark\"></td> <td class=\"f4 light\"></td>\n        <td class=\"f5 dark\"></td> <td class=\"f6 light\"></td>\n        <td class=\"f7 dark\"></td> <td class=\"f8 light\"></td>\n    </tr>\n    <tr class=\"g\">\n        <td class=\"g1 light\"></td> <td class=\"g2 dark\"></td>\n        <td class=\"g3 light\"></td> <td class=\"g4 dark\"></td>\n        <td class=\"g5 light\"></td> <td class=\"g6 dark\"></td>\n        <td class=\"g7 light\"></td> <td class=\"g8 dark\"></td>\n    </tr>\n    <tr class=\"h\">\n        <td class=\"h1 dark\"></td> <td class=\"h2 light\"></td>\n        <td class=\"h3 dark\"></td> <td class=\"h4 light\"></td>\n        <td class=\"h5 dark\"></td> <td class=\"h6 light\"></td>\n        <td class=\"h7 dark\"></td> <td class=\"h8 light\"></td>\n    </tr>\n</table>\n\n<script type=\"text/javascript\">\n    (function(scope) {\n        const _scope = scope;\n        scope.$watch('msg', function(msg) {\n            if(msg && msg.topic && msg.payload) {\n                var el = $(msg.topic);\n                el.find('img').remove();\n                el.append(msg.payload);\n            }\n        });\n    })(scope);\n</script>\n\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":630,"y":940,"wires":[[]]},{"id":"1d4ce299.bec34d","type":"file in","z":"ee39c607.e74858","name":"Image loader","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":170,"y":940,"wires":[["c026d0c5.596058"]]},{"id":"73940e94.50af38","type":"ocellus","z":"ee39c607.e74858","d":true,"name":"Ocellus","pipeline":"1","address":"localhost:50052","itemTypeFilter":"","dataTypeFilter":"","moduleIdFilter":"","async":false,"sendPreEvent":false,"x":3080,"y":760,"wires":[["599fc1a7.d0c2e8","41359e99.af6d78"]]},{"id":"13a3812.8b3c8ff","type":"debug","z":"ee39c607.e74858","name":"Board visualization","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3830,"y":760,"wires":[]},{"id":"599fc1a7.d0c2e8","type":"debug","z":"ee39c607.e74858","name":"Ocellus message","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3270,"y":760,"wires":[]},{"id":"6090e1f9.cf15b","type":"function","z":"ee39c607.e74858","name":"Board print","func":"var payload = msg.payload;\n\nvar newMsg = { payload:PrintBoard(payload), topic: \"Best move\"};\nreturn newMsg;\n\nfunction PrintBoard(boardPositions)\n{\n    var exportString = \"OCELLUS 2\\n\";\n    var tempString = \"\";\n    for (var i = 7; i >= 0; i--)\n    {\n        for (var j = 0; j <= 7; j++)\n        {\n            if(j==0)\n            {\n                exportString += \"| \";    \n            }\n            \n            tempString = boardPositions[i*8+j].name;\n            if (tempString == \"Empty_Slot\")\n            {\n                exportString += \"------------\";\n            }\n            else\n            {\n                if(tempString.split(\"_\")[1] == \"Queen\")\n                {\n                    exportString += tempString + \" \";\n                }\n                else if(tempString.split(\"_\")[1] != \"Knight\" || tempString.split(\"_\")[1] != \"Bishop\")\n                {\n                    exportString += \" \" + tempString + \" \";\n                }\n            }\n            exportString += \" | \";\n        }\n        exportString += \"\\n\";\n    }\n    return exportString;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3650,"y":760,"wires":[["13a3812.8b3c8ff"]]},{"id":"37b29673.a7cbaa","type":"debug","z":"ee39c607.e74858","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3470,"y":760,"wires":[]},{"id":"7414a7a9.58cc68","type":"inject","z":"ee39c607.e74858","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[{\"origin\":\"G8\",\"destination\":\"B8\",\"robot\":\"T_ROB_R\"}]","payloadType":"json","x":1430,"y":460,"wires":[["a0b59504.e48db8"]]},{"id":"41359e99.af6d78","type":"function","z":"ee39c607.e74858","name":"Chessboard creation","func":"if(msg.topic != \"Dashboard\")\n{\n    var data = msg.payload;\n    \n    var startingPosition = 0.0275;\n    var tolerance = 0.015;\n    var nextPosition = 0.055;\n    \n    var counterX = 0;\n    var counterY = 0;\n    \n    if(data.dataflowevent){\n\n        var boardPositions = new Array(64);\n        var cameraPosition = data.dataflowevent.data.camerasMap[0][1].position;\n        var objectArray = data.dataflowevent.data.itemsMap[0][1].dataList\n        \n        for(var k=0 ; k< objectArray.length;k++)\n        {\n            for(var i=-startingPosition ; i > -startingPosition-nextPosition * 7 ; i-=nextPosition)\n            {\n                for(var j=startingPosition; j < startingPosition+nextPosition * 7 ; j+=nextPosition)\n                {\n                    if(IsBetween(j,i,objectArray[k].position))\n                    { \n                        boardPositions[counterY*8+counterX] = objectArray[k];\n                    }\n                    counterX++;\n                }\n                counterY++;\n                counterX = 0;\n            }\n            counterX = 0;\n            counterY = 0;\n        }\n        CreateEmptyFigures(boardPositions);\n    }\n    var newMsg = {payload : boardPositions, topic : \"Chess_quadrants\"};\n    global.set(\"globalBoardPositions\", boardPositions);\n    return newMsg;\n}\n\nfunction CreateEmptyFigures(boardPositions)\n{\n    for(var i = 0; i < boardPositions.length; i++)\n    {\n        if(boardPositions[i] == undefined)\n        {\n            boardPositions[i] = {name:\"Empty_Slot\", position:{x : CalculateX(i), y : CalculateY(i), z : 0.04}};\n        }\n    }\n}\n\nfunction CalculateX(index)\n{\n    return ((index % 8) * nextPosition + startingPosition);\n}\n\nfunction CalculateY(index)\n{\n    return (-Math.floor( index / 8 ) * nextPosition - startingPosition);\n}\n\nfunction IsBetween(x, y, position) \n{\n    if(position.x < x+tolerance && position.x > x-tolerance && position.y < y+tolerance && position.y > y-tolerance)\n    {\n        return true;\n    }\n    return false;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3280,"y":720,"wires":[["37b29673.a7cbaa","26ea3991.dc7e6e","a05e5d37.e2f188"]]},{"id":"9e96b888.8a25","type":"function","z":"ee39c607.e74858","name":"Calculate average figure detection","func":"var payload = msg.payload\nvar emptySlotString = \"Empty_Slot\";\nvar boardList = [];\n\nfor(var i = 0 ;i < 64;i++)\n{\n    var figure1 = payload.Ocellus1[i].name;\n    var figure2 = payload.Ocellus2[i].name;\n\n    if(figure1 == figure2)\n    {\n        boardList[i] = figure1;\n    }\n    else if(figure1 == emptySlotString && figure2 != emptySlotString)\n    {\n        boardList[i] = figure2;\n    }\n    else if(figure1 != emptySlotString && figure2 == emptySlotString)\n    {\n        boardList[i] = figure1;\n    }\n    /*else if (figure1 != figure2)\n    {\n        boardList[i] = FindClosestCamera(figure1,figure2);\n    }*/\n    else\n    {\n        boardList[i] = figure1;\n    }\n}\nreturn {payload: boardList};\n\n//y = x - 0.4\nfunction FindClosestCamera(figure1, figure2)\n{\n    if(figure1.position.y > figure1.position.x - 0.4)\n    {\n        return figure1; \n    }\n    else\n    {\n        return figure2;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3800,"y":720,"wires":[[]]},{"id":"b6d2a5f0.feaf68","type":"join","z":"ee39c607.e74858","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":3590,"y":720,"wires":[["9e96b888.8a25"]]},{"id":"26ea3991.dc7e6e","type":"change","z":"ee39c607.e74858","name":"Ocellus2","rules":[{"t":"set","p":"topic","pt":"msg","to":"Ocellus2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3460,"y":720,"wires":[["b6d2a5f0.feaf68"]]},{"id":"a05e5d37.e2f188","type":"change","z":"ee39c607.e74858","name":"Ocellus1","rules":[{"t":"set","p":"topic","pt":"msg","to":"Ocellus1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3460,"y":720,"wires":[["6090e1f9.cf15b"]]},{"id":"1e0c65c3.31c2c2","type":"function","z":"ee39c607.e74858","name":"Chessboard creation","func":"if(msg.topic != \"Dashboard\")\n{\n    var data = msg.payload;\n    \n    var startingPosition = 0.0275;\n    var tolerance = 0.015;\n    var nextPosition = 0.055;\n    \n    var counterX = 0;\n    var counterY = 0;\n    \n    if(data.dataflowevent){\n\n        var boardPositions = new Array(64);\n        var cameraPosition = data.dataflowevent.data.camerasMap[0][1].position;\n        var objectArray = data.dataflowevent.data.itemsMap[0][1].dataList\n        \n        for(var k=0 ; k< objectArray.length;k++)\n        {\n            for(var i=-startingPosition ; i > -startingPosition-nextPosition * 7 ; i-=nextPosition)\n            {\n                for(var j=startingPosition; j < startingPosition+nextPosition * 7 ; j+=nextPosition)\n                {\n                    if(IsBetween(j,i,objectArray[k].position))\n                    { \n                        boardPositions[counterY*8+counterX] = objectArray[k];\n                    }\n                    counterX++;\n                }\n                counterY++;\n                counterX = 0;\n            }\n            counterX = 0;\n            counterY = 0;\n        }\n        CreateEmptyFigures(boardPositions);\n    }\n    var newMsg = {payload : boardPositions, topic : \"Chess_quadrants\"};\n    global.set(\"globalBoardPositions\", boardPositions);\n    return newMsg;\n}\n\nfunction CreateEmptyFigures(boardPositions)\n{\n    for(var i = 0; i < boardPositions.length; i++)\n    {\n        if(boardPositions[i] == undefined)\n        {\n            boardPositions[i] = {name:\"Empty_Slot\", position:{x : CalculateX(i), y : CalculateY(i), z : 0.04}};\n        }\n    }\n}\n\nfunction CalculateX(index)\n{\n    return ((index % 8) * nextPosition + startingPosition);\n}\n\nfunction CalculateY(index)\n{\n    return (-Math.floor( index / 8 ) * nextPosition - startingPosition);\n}\n\nfunction IsBetween(x, y, position) \n{\n    if(position.x < x+tolerance && position.x > x-tolerance && position.y < y+tolerance && position.y > y-tolerance)\n    {\n        return true;\n    }\n    return false;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1080,"y":100,"wires":[["72c905c7.4b974c","363fa7a.c792958","587bc91a.febc18","dfc8e744.dbfb3"]]},{"id":"67e4b311.75f23c","type":"subflow:ce24bd14b3c41949","z":"ee39c607.e74858","name":"Chesster","env":[],"x":540,"y":100,"wires":[["661257bd.34c658"]]},{"id":"3f646617.268e22","type":"link out","z":"ee39c607.e74858","name":"","links":["b2966a2a.aeb6a8"],"x":1815,"y":420,"wires":[]},{"id":"b2966a2a.aeb6a8","type":"link in","z":"ee39c607.e74858","name":"","links":["3f646617.268e22"],"x":155,"y":100,"wires":[["47d36255.70333c"]]},{"id":"20f23282.6604c6","type":"delay","z":"ee39c607.e74858","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1720,"y":420,"wires":[["3f646617.268e22"]]},{"id":"95f1b0f0.23295","type":"trigger","z":"f45cb214.37ef8","name":"","op1":"","op2":" ","op1type":"nul","op2type":"str","duration":"30","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":230,"y":240,"wires":[[]]},{"id":"fbd1ab9c.da1068","type":"inject","z":"f45cb214.37ef8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":250,"y":80,"wires":[[]]},{"id":"ee0ce0c5.3466a","type":"trigger","z":"f45cb214.37ef8","name":"","op1":"","op2":"","op1type":"str","op2type":"str","duration":"0.2","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":230,"y":120,"wires":[[]]},{"id":"42010304.08c304","type":"trigger","z":"f45cb214.37ef8","name":"","op1":"","op2":"","op1type":"str","op2type":"nul","duration":"1","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":240,"y":160,"wires":[[]]},{"id":"66588225.f3b504","type":"delay","z":"f45cb214.37ef8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":155,"y":160,"wires":[["42010304.08c304"]],"l":false},{"id":"afb14558.6beba8","type":"trigger","z":"f45cb214.37ef8","name":"","op1":"","op2":"","op1type":"nul","op2type":"str","duration":"1","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":240,"y":200,"wires":[[]]},{"id":"d69b9e6a.2b57c8","type":"subflow:f45cb214.37ef8","z":"ee39c607.e74858","name":"","env":[],"x":1455,"y":860,"wires":[[]],"l":false},{"id":"ec611d6.0b8986","type":"subflow:f45cb214.37ef8","z":"ee39c607.e74858","name":"","env":[],"x":1235,"y":800,"wires":[[]],"l":false},{"id":"6f2b2b2f.b04144","type":"subflow:f45cb214.37ef8","z":"ee39c607.e74858","name":"","env":[],"x":1235,"y":740,"wires":[["b810bdd0.91aa7"]],"l":false},{"id":"2eb8e143.c0a296","type":"hue-switch","z":"ee39c607.e74858","name":"","bridge":"72d94061.53986","sensorid":"2","skipevents":false,"universalevents":true,"x":1130,"y":800,"wires":[["ec611d6.0b8986"]]},{"id":"43d1a616.ab70f","type":"hue-switch","z":"ee39c607.e74858","name":":)","bridge":"72d94061.53986","sensorid":"3","skipevents":false,"universalevents":true,"x":1110,"y":740,"wires":[["6f2b2b2f.b04144"]]},{"id":"94501d8c.5ccc8","type":"hue-motion","z":"ee39c607.e74858","name":"Hue motion sensor 1","bridge":"72d94061.53986","sensorid":"4","skipevents":false,"universalevents":false,"x":1320,"y":860,"wires":[["d69b9e6a.2b57c8"]]},{"id":"8f1a7837.27abb8","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"Short","op1type":"nul","op2type":"str","duration":"1750","extend":true,"overrideDelay":false,"units":"ms","reset":"false","bytopic":"all","topic":"topic","outputs":1,"x":1080,"y":200,"wires":[["c2483621.ea9ec8"]]},{"id":"82fa83c9.f4d57","type":"function","z":"f1058aa9.7a7698","name":"Set","func":"msg = { payload: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":200,"wires":[["8f1a7837.27abb8"]]},{"id":"3451a274.2e6d0e","type":"function","z":"f1058aa9.7a7698","name":"Reset","func":"msg = { payload: false };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":240,"wires":[["8f1a7837.27abb8"]]},{"id":"e6cf8ea0.e318f","type":"function","z":"f1058aa9.7a7698","name":"On - Long","func":"msg = { payload: {name:\"On\",action:\"Long\"} };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":300,"wires":[[]]},{"id":"c2483621.ea9ec8","type":"function","z":"f1058aa9.7a7698","name":"On - Short","func":"msg = { payload: {name:\"On\",action:\"Short\"} };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":180,"wires":[[]]},{"id":"98b29778.d1c878","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"Short","op1type":"nul","op2type":"str","duration":"1750","extend":true,"overrideDelay":false,"units":"ms","reset":"false","bytopic":"all","topic":"topic","outputs":1,"x":1060,"y":260,"wires":[["f76e5a22.466e08"]]},{"id":"7ec25048.f2f64","type":"function","z":"f1058aa9.7a7698","name":"Set","func":"msg = { payload: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":300,"wires":[["98b29778.d1c878","62c917d7.67e988"]]},{"id":"f76e5a22.466e08","type":"function","z":"f1058aa9.7a7698","name":"Reset","func":"msg = { reset: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":260,"wires":[["62c917d7.67e988"]]},{"id":"62c917d7.67e988","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1080,"y":300,"wires":[["e6cf8ea0.e318f"]]},{"id":"3ea51d56.c58fb2","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"Short","op1type":"nul","op2type":"str","duration":"1750","extend":true,"overrideDelay":false,"units":"ms","reset":"false","bytopic":"all","topic":"topic","outputs":1,"x":1080,"y":400,"wires":[["3e7be69e.59725a"]]},{"id":"64596a71.064424","type":"function","z":"f1058aa9.7a7698","name":"Set","func":"msg = { payload: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":400,"wires":[["3ea51d56.c58fb2"]]},{"id":"a784b3fb.4a4ec","type":"function","z":"f1058aa9.7a7698","name":"Reset","func":"msg = { payload: false };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":440,"wires":[["3ea51d56.c58fb2"]]},{"id":"d7349a29.fb1028","type":"function","z":"f1058aa9.7a7698","name":"Dim Up - Long","func":"msg = { payload: {name:\"Dim Up\",action:\"Long\"} };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":500,"wires":[[]]},{"id":"3e7be69e.59725a","type":"function","z":"f1058aa9.7a7698","name":"Dim Up - Short","func":"msg = { payload: {name:\"Dim Up\",action:\"Short\"} };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":380,"wires":[[]]},{"id":"a6d0a69f.988c58","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"Short","op1type":"nul","op2type":"str","duration":"1750","extend":true,"overrideDelay":false,"units":"ms","reset":"false","bytopic":"all","topic":"topic","outputs":1,"x":1060,"y":460,"wires":[["2e70f88c.a4f988"]]},{"id":"cd49deab.f85bc","type":"function","z":"f1058aa9.7a7698","name":"Set","func":"msg = { payload: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":500,"wires":[["a6d0a69f.988c58","9ef082fb.f4ba1"]]},{"id":"2e70f88c.a4f988","type":"function","z":"f1058aa9.7a7698","name":"Reset","func":"msg = { reset: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":460,"wires":[["9ef082fb.f4ba1"]]},{"id":"9ef082fb.f4ba1","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1080,"y":500,"wires":[["d7349a29.fb1028"]]},{"id":"6f4557c0.1ba5f8","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"Short","op1type":"nul","op2type":"str","duration":"1750","extend":true,"overrideDelay":false,"units":"ms","reset":"false","bytopic":"all","topic":"topic","outputs":1,"x":1080,"y":600,"wires":[["f36c1cea.538ec"]]},{"id":"997246d1.f66458","type":"function","z":"f1058aa9.7a7698","name":"Set","func":"msg = { payload: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":600,"wires":[["6f4557c0.1ba5f8"]]},{"id":"b132688e.58d348","type":"function","z":"f1058aa9.7a7698","name":"Reset","func":"msg = { payload: false };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":640,"wires":[["6f4557c0.1ba5f8"]]},{"id":"377d4a3f.436386","type":"function","z":"f1058aa9.7a7698","name":"Dim Down - Long","func":"msg = { payload: {name:\"Dim Down\",action:\"Long\"} };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":700,"wires":[[]]},{"id":"f36c1cea.538ec","type":"function","z":"f1058aa9.7a7698","name":"Dim Down - Short","func":"msg = { payload: {name:\"Dim Down\",action:\"Short\"} };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":580,"wires":[[]]},{"id":"fbddc27f.9e0f7","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"Short","op1type":"nul","op2type":"str","duration":"1750","extend":true,"overrideDelay":false,"units":"ms","reset":"false","bytopic":"all","topic":"topic","outputs":1,"x":1060,"y":660,"wires":[["282df615.2733fa"]]},{"id":"d9d795a2.f2c708","type":"function","z":"f1058aa9.7a7698","name":"Set","func":"msg = { payload: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":700,"wires":[["fbddc27f.9e0f7","d57a8a49.2ba788"]]},{"id":"282df615.2733fa","type":"function","z":"f1058aa9.7a7698","name":"Reset","func":"msg = { reset: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":660,"wires":[["d57a8a49.2ba788"]]},{"id":"d57a8a49.2ba788","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1080,"y":700,"wires":[["377d4a3f.436386"]]},{"id":"b35b829c.65a53","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"Short","op1type":"nul","op2type":"str","duration":"1750","extend":true,"overrideDelay":false,"units":"ms","reset":"false","bytopic":"all","topic":"topic","outputs":1,"x":1080,"y":800,"wires":[["10d29cf2.8f23a3"]]},{"id":"3aa9a0b9.d68d","type":"function","z":"f1058aa9.7a7698","name":"Set","func":"msg = { payload: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":800,"wires":[["b35b829c.65a53"]]},{"id":"3ee87d6e.f54ef2","type":"function","z":"f1058aa9.7a7698","name":"Reset","func":"msg = { payload: false };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":840,"wires":[["b35b829c.65a53"]]},{"id":"56f52ea6.12ed8","type":"function","z":"f1058aa9.7a7698","name":"Off  - Long","func":"msg = { payload: {name:\"Off \",action:\"Long\"} };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":900,"wires":[[]]},{"id":"10d29cf2.8f23a3","type":"function","z":"f1058aa9.7a7698","name":"Off  - Short","func":"msg = { payload: {name:\"Off \",action:\"Short\"} };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":780,"wires":[[]]},{"id":"7793d863.f0fe68","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"Short","op1type":"nul","op2type":"str","duration":"1750","extend":true,"overrideDelay":false,"units":"ms","reset":"false","bytopic":"all","topic":"topic","outputs":1,"x":1060,"y":860,"wires":[["b125ec8b.d350f"]]},{"id":"837475c8.e69148","type":"function","z":"f1058aa9.7a7698","name":"Set","func":"msg = { payload: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":900,"wires":[["7793d863.f0fe68","ff86159b.afa598"]]},{"id":"b125ec8b.d350f","type":"function","z":"f1058aa9.7a7698","name":"Reset","func":"msg = { reset: true };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":860,"wires":[["ff86159b.afa598"]]},{"id":"ff86159b.afa598","type":"trigger","z":"f1058aa9.7a7698","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1080,"y":900,"wires":[["56f52ea6.12ed8"]]},{"id":"bb0b2deb.96dbf","type":"function","z":"f1058aa9.7a7698","name":"Off - short released","func":"if (\n    (msg.payload.name==\"Off\") && ( (msg.payload.action==\"short released\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":780,"wires":[["10d29cf2.8f23a3","3ee87d6e.f54ef2"]]},{"id":"a49fdfc0.80ebd","type":"function","z":"f1058aa9.7a7698","name":"Off - pressed","func":"if (\n    (msg.payload.name==\"Off\") && ( (msg.payload.action==\"pressed\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":820,"wires":[["3aa9a0b9.d68d"]]},{"id":"24df8277.721fee","type":"function","z":"f1058aa9.7a7698","name":"Off - holded","func":"if (\n    (msg.payload.name==\"Off\") && ( (msg.payload.action==\"holded\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":860,"wires":[["3ee87d6e.f54ef2","837475c8.e69148"]]},{"id":"aab0b056.36aae","type":"function","z":"f1058aa9.7a7698","name":"Off - long released","func":"if (\n    (msg.payload.name==\"Off\") && ( (msg.payload.action==\"long released\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":900,"wires":[["3ee87d6e.f54ef2","837475c8.e69148"]]},{"id":"e24b7ed8.65cc4","type":"function","z":"f1058aa9.7a7698","name":"On - short released","func":"if (\n    (msg.payload.name==\"On\") && ( (msg.payload.action==\"short released\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":180,"wires":[["c2483621.ea9ec8","3451a274.2e6d0e"]]},{"id":"cee7d10c.698fb","type":"function","z":"f1058aa9.7a7698","name":"On - pressed","func":"if ((msg.payload.name==\"On\") && (msg.payload.action==\"pressed\")) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":220,"wires":[["82fa83c9.f4d57"]]},{"id":"c763dfd7.d768e","type":"function","z":"f1058aa9.7a7698","name":"On - holded","func":"if (\n    (msg.payload.name==\"On\") && ( (msg.payload.action==\"holded\") ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":260,"wires":[["3451a274.2e6d0e","7ec25048.f2f64"]]},{"id":"3ed5e66f.65029a","type":"function","z":"f1058aa9.7a7698","name":"On - long released","func":"if (\n    (msg.payload.name==\"On\") && ( (msg.payload.action==\"long released\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":300,"wires":[["3451a274.2e6d0e","7ec25048.f2f64"]]},{"id":"8cbbe8ea.8e9f18","type":"function","z":"f1058aa9.7a7698","name":"Dim Up - short released","func":"if (\n    (msg.payload.name==\"Dim Up\") && ( (msg.payload.action==\"short released\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":380,"wires":[["3e7be69e.59725a","a784b3fb.4a4ec"]]},{"id":"3938f64.f81e50a","type":"function","z":"f1058aa9.7a7698","name":"Dim Up - pressed","func":"if (\n    (msg.payload.name==\"Dim Up\") && ( (msg.payload.action==\"pressed\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":420,"wires":[["64596a71.064424"]]},{"id":"6f66a3c1.2da10c","type":"function","z":"f1058aa9.7a7698","name":"Dim Up - holded","func":"if (\n    (msg.payload.name==\"Dim Up\") && ( (msg.payload.action==\"holded\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":460,"wires":[["a784b3fb.4a4ec","cd49deab.f85bc"]]},{"id":"e0cda518.90b208","type":"function","z":"f1058aa9.7a7698","name":"Dim Up - long released","func":"if (\n    (msg.payload.name==\"Dim Up\") && ( (msg.payload.action==\"long released\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":500,"wires":[["a784b3fb.4a4ec","cd49deab.f85bc"]]},{"id":"e887c4ce.708428","type":"function","z":"f1058aa9.7a7698","name":"Dim Down - short released","func":"if (\n    (msg.payload.name==\"Dim Down\") && ( (msg.payload.action==\"short released\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":580,"wires":[["f36c1cea.538ec","b132688e.58d348"]]},{"id":"97ec953f.b5f548","type":"function","z":"f1058aa9.7a7698","name":"Dim Down - pressed","func":"if (\n    (msg.payload.name==\"Dim Down\") && ( (msg.payload.action==\"pressed\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":620,"wires":[["997246d1.f66458"]]},{"id":"29d86817.199478","type":"function","z":"f1058aa9.7a7698","name":"Dim Down - holded","func":"if (\n    (msg.payload.name==\"Dim Down\") && ( (msg.payload.action==\"holded\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":660,"wires":[["b132688e.58d348","d9d795a2.f2c708"]]},{"id":"ce6bde8f.15b02","type":"function","z":"f1058aa9.7a7698","name":"Dim Down - long released","func":"if (\n    (msg.payload.name==\"Dim Down\") && ( (msg.payload.action==\"long released\")  ) ) {\nreturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":700,"wires":[["b132688e.58d348","d9d795a2.f2c708"]]},{"id":"b810bdd0.91aa7","type":"subflow:f1058aa9.7a7698","z":"ee39c607.e74858","name":"","env":[],"x":1380,"y":780,"wires":[["89afd160.51904","2865ab3a.51586c"],["2865ab3a.51586c","89afd160.51904"],[],[],[],[],[],[]]},{"id":"89afd160.51904","type":"debug","z":"ee39c607.e74858","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1650,"y":760,"wires":[]},{"id":"2865ab3a.51586c","type":"link out","z":"ee39c607.e74858","name":"","links":["3853ee84.53f9f2"],"x":1595,"y":720,"wires":[]},{"id":"3853ee84.53f9f2","type":"link in","z":"ee39c607.e74858","name":"","links":["2865ab3a.51586c"],"x":55,"y":100,"wires":[["47d36255.70333c"]]},{"id":"63a8b7ca.65af9","type":"ui_text_input","z":"ee39c607.e74858","d":true,"name":"Manual FEN input","label":"Manual FEN input","tooltip":"","group":"cacd5ff7.bb2ba","order":6,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"topic","topicType":"msg","x":810,"y":620,"wires":[["57ed7b0a.1ccf04"]]},{"id":"15bf2ce4.d39e4b","type":"link in","z":"ee39c607.e74858","name":"","links":["57ed7b0a.1ccf04"],"x":795,"y":300,"wires":[["c808b9b8.d44288","f074d13a.c432d"]]},{"id":"57ed7b0a.1ccf04","type":"link out","z":"ee39c607.e74858","name":"","links":["15bf2ce4.d39e4b"],"x":935,"y":620,"wires":[]},{"id":"69db0271.43531c","type":"ui_text_input","z":"ee39c607.e74858","d":true,"name":"Manual move input","label":"Manual move input","tooltip":"","group":"cacd5ff7.bb2ba","order":8,"width":0,"height":0,"passthru":true,"mode":"text","delay":"1000","topic":"topic","topicType":"msg","x":810,"y":660,"wires":[["a5959d64.1472f8"]]},{"id":"a5959d64.1472f8","type":"function","z":"ee39c607.e74858","name":"Manual move creation","func":"var payload = msg.payload.split(\"\");\nif(payload[0]!=undefined && payload[1]!=undefined && payload[2]!=undefined && \n   payload[3]!=undefined && payload[4]!=undefined)\n{\n    var newPayload = '[{\"origin\":\"' + payload[0].toUpperCase()+ payload[1].toUpperCase() + \n    '\",\"destination\":\"' + payload[2].toUpperCase() + payload[3].toUpperCase()+'\",\"robot\":\"T_ROB_'+ payload[4].toUpperCase() + '\"}]';\n    return {payload : newPayload};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":820,"y":700,"wires":[["3c397cea.768294"]]},{"id":"3c397cea.768294","type":"json","z":"ee39c607.e74858","name":"JSON parser","property":"payload","action":"obj","pretty":false,"x":790,"y":740,"wires":[["2ef0c3af.caa0ec","7567a0ef.75b9e8"]]},{"id":"396587a8.28fe78","type":"link out","z":"ee39c607.e74858","name":"","links":["893e9e0f.534b7"],"x":1155,"y":260,"wires":[]},{"id":"893e9e0f.534b7","type":"link in","z":"ee39c607.e74858","name":"","links":["396587a8.28fe78"],"x":1075,"y":540,"wires":[["9a5d63a1.5de"]]},{"id":"13a6218e.46ebd6","type":"link in","z":"ee39c607.e74858","name":"","links":["a20ecb0b.c890a8"],"x":1075,"y":640,"wires":[["ba1ee31.a8ec72"]]},{"id":"a20ecb0b.c890a8","type":"link out","z":"ee39c607.e74858","name":"","links":["13a6218e.46ebd6"],"x":1375,"y":340,"wires":[]},{"id":"46c090c6.0622f","type":"link in","z":"ee39c607.e74858","name":"","links":["2ef0c3af.caa0ec"],"x":1595,"y":380,"wires":[["a0b59504.e48db8"]]},{"id":"2ef0c3af.caa0ec","type":"link out","z":"ee39c607.e74858","name":"","links":["46c090c6.0622f"],"x":935,"y":740,"wires":[]},{"id":"ba1ee31.a8ec72","type":"function","z":"ee39c607.e74858","name":"Move sound preparator V2","func":"if(global.get(\"gameEnded\") == false)\n{\n    if(msg.topic != \"playSounds\")\n    {\n        var returnMessage = SetMoveSounds();\n        return returnMessage;\n    }\n    else\n    {\n        var moveSoundList = global.get(\"moveSoundList\"); \n        if(msg.payload != moveSoundList.length - 1)\n        {\n            var moveSound = moveSoundList[msg.payload+1];\n            var newMsg = {payload : msg.payload +=1 ,filename : moveSound[\"soundName\"], topic : \"playSounds\", delay : moveSound[\"nextDelay\"]};\n            return newMsg;    \n        }\n    }\n}\n\nfunction SetMoveSounds()\n{\n    var object = global.get(\"moveAudioObject\");\n    \n    var string1 = object[\"Figure 1\"].split(\" \");\n    var string2 = \"/assets/\"+ string1[0] + \" \" + string1[1].toLowerCase() + \".mp3\";\n    \n    var string3 = object[\"Move type\"];\n    var string4 = \"\";\n    \n    switch(string3)\n    {\n        case \"EmptyMove\":\n            string4 = \"/assets/\"+ \"moves\" + \".mp3\";\n            break;\n        case \"AttackMove\":\n            string4 = \"/assets/\"+ \"attacks\" + \".mp3\";\n            break;\n        case \"Castling_Queenside\":\n            string4 = \"/assets/\"+ \"castles\" + \".mp3\";\n            break;\n        case \"Castling_Kingside\":\n            string4 = \"/assets/\"+ \"castles\" + \".mp3\";\n            break;\n        case \"EnPassant\":\n            string4 = \"/assets/\"+ \"attacks in passing\" + \".mp3\";\n            break;\n        case \"PawnPromotion\":\n            string4 = \"/assets/\" + \"promotes\" + \".mp3\";\n            break;\n    }\n    \n    var string5 = \"/assets/\"+ \"from\" + \".mp3\";\n    \n    var string6 = object[\"Move positions\"].split(\"\");\n    var string7 = \"/assets/\"+ string6[0].toUpperCase() + \".mp3\";\n    \n    var string8 = \"/assets/\"+ string6[1].toUpperCase() + \".mp3\";\n    \n    var string9 = \"/assets/\"+ \"to\" + \".mp3\";\n    \n    var string10 = \"/assets/\"+ string6[2].toUpperCase() + \".mp3\";\n    \n    var string11 = \"/assets/\"+ string6[3].toUpperCase() + \".mp3\";\n    \n    var moveSoundList = \n    [\n        {\"soundName\" : string2, \"nextDelay\" : 1000}, {\"soundName\" : string4, \"nextDelay\" : 800 }, {\"soundName\" : string5, \"nextDelay\" : 650},\n        {\"soundName\" : string7, \"nextDelay\" : 500}, {\"soundName\" : string8, \"nextDelay\" : 500}, {\"soundName\" : string9, \"nextDelay\" : 500},\n        {\"soundName\" : string10, \"nextDelay\" : 500}, {\"soundName\" : string11, \"nextDelay\" : 0}\n    ];\n    \n    global.set(\"moveSoundList\", moveSoundList);\n    return {payload : 0 ,filename : moveSoundList[0][\"soundName\"], topic : \"playSounds\", delay : moveSoundList[0][\"nextDelay\"]};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1260,"y":640,"wires":[["82db4e6e.e589a","b8dae4e2.049f9"]]},{"id":"dfc8e744.dbfb3","type":"function","z":"ee39c607.e74858","name":"Board print","func":"var payload = msg.payload;\n\nvar newMsg = { payload:PrintBoard(payload), topic: \"Best move\"};\nreturn newMsg;\n\nfunction PrintBoard(boardPositions)\n{\n    var exportString=\"\";\n    var tempString = \"\";\n    for (var i = 7; i >= 0; i--)\n    {\n        for (var j = 0; j <= 7; j++)\n        {\n            if(j==0)\n            {\n                exportString += \"| \";    \n            }\n            \n            tempString = boardPositions[i*8+j].name;\n            if (tempString == \"Empty_Slot\")\n            {\n                exportString += \"------------\";\n            }\n            else\n            {\n                if(tempString.split(\"_\")[1] == \"Queen\")\n                {\n                    exportString += tempString + \" \";\n                }\n                else if(tempString.split(\"_\")[1] != \"Knight\" || tempString.split(\"_\")[1] != \"Bishop\")\n                {\n                    exportString += \" \" + tempString + \" \";\n                }\n            }\n            exportString += \" | \";\n        }\n        exportString += \"\\n\";\n    }\n    return exportString;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2050,"y":120,"wires":[["8118a7af.a672f8"]]},{"id":"8118a7af.a672f8","type":"debug","z":"ee39c607.e74858","name":"Board visualization","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2230,"y":120,"wires":[]},{"id":"82db4e6e.e589a","type":"file in","z":"ee39c607.e74858","name":"Chat sound loader","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":1490,"y":640,"wires":[["f898c2a5.f9f21"]]},{"id":"f898c2a5.f9f21","type":"ui_audio","z":"ee39c607.e74858","name":"Chat audio player","group":"620826c0.bc6a08","voice":"","always":"","x":1690,"y":640,"wires":[]},{"id":"b8dae4e2.049f9","type":"delay","z":"ee39c607.e74858","name":"Delay input","pauseType":"delayv","timeout":"0","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1270,"y":600,"wires":[["ba1ee31.a8ec72"]]},{"id":"7567a0ef.75b9e8","type":"debug","z":"ee39c607.e74858","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":780,"wires":[]},{"id":"c6b66212.4f254","type":"link out","z":"ee39c607.e74858","name":"","links":["362e2309.d173d4"],"x":2055,"y":160,"wires":[]},{"id":"5f8c01b2.c73a7","type":"link out","z":"ee39c607.e74858","name":"","links":["2bcc68e3.d875f"],"x":2055,"y":80,"wires":[]},{"id":"2bcc68e3.d875f","type":"link in","z":"ee39c607.e74858","name":"","links":["5f8c01b2.c73a7"],"x":795,"y":260,"wires":[["f074d13a.c432d"]]},{"id":"362e2309.d173d4","type":"link in","z":"ee39c607.e74858","name":"","links":["c6b66212.4f254"],"x":795,"y":340,"wires":[["c808b9b8.d44288"]]},{"id":"5eb8809d.be2418","type":"trigger","z":"ee39c607.e74858","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":860,"y":100,"wires":[["1e0c65c3.31c2c2"]]},{"id":"f1bee362.324e98","type":"debug","z":"ee39c607.e74858","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1930,"y":380,"wires":[]}]